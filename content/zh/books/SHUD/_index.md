---
# Page title
title: 非结构域水文模拟器( The Simulator for Hydrologic Unstructured Domains, SHUD)

# Title for the menu link if you wish to use a shorter link title, otherwise remove this option.
linktitle: 1. SHUD

# Page summary for search engines.
summary: Introduction of the SHUD Model

# Date page published
date: 2020-11-23

# Academic page type (do not modify).
type: book

# Position of this page in the menu. Remove this option to sort alphabetically.
weight: 10

---

![](/media/shud_show.png)

SHUD模型采用有限体积法求解流域水文学常微分方程，获得空间上的水储量和流量。它是一种分布式、地表-地下全耦合、多尺度、多过程、数值方法的水文模型。

基于Duffy（1996）提出的Two-state integral-balance (TSIB)认知模型，并吸取了Penn State Integrated Hydrologic Model (PIHM)模型的应用经验，SHUD模型成为全新的数值水文模型。在导师Christopher Duffy和Paul Ullrich的建议下，此独立开发的水文模型被命名为SHUD (the Simulator for Hydrologic Unstructured Domains)，强调了模型的非结构化特征在水文模拟中的优势。

SHUD模型说明书见：[https://www.shud.xyz/book_cn/](https://www.shud.xyz/book_cn/)

##	SHUD模型的基本结构
SHUD模型使用非结构化三角网格来表达模拟区域的水平方向空间异质性，同时支持规则三角形和Delaunay不规则三角形（Triangular Irregulate Network, TIN）。由于流域空间的不规则特点，Delaunay不规则三角形更方便表达。每个三角形单元在空间上被视为最小坡面水文计算单元（Hydrological Computing Unit, HCU），其中单元内水文参数具有一致性。

坡面单元在垂直方向上分为三层：地表层、未饱和层和饱和层。其中，地表层用于计算植被截留、积雪、下渗和径流等。

基于Duffy（1996）的“两态耦合平衡”认知模型，SHUD模型将土壤水层分为未饱和层和饱和层，并使用局部平衡公式计算水的流动。

-	

## SHUD模型具有以下特征和优势：

- SHUD模型是一个物理性分布式水文模型，可准确描述流域水文物理过程。该模型可用于模拟无观测流域的研究。
- SHUD能够很好地表达流域中的空间异质性。水文空间异质性的表达有利于多模型耦合研究，例如详细描述了山坡回流的水流路径，有利于生物化学、污染物运移、地貌变迁、湖泊生态等耦合研究。
- SHUD是全耦合模型，在每一时间步长，所有水文状态量都要满足基本求解器的收敛性要求，保证了水文变量在空间上的连续性、一致性和收敛性。
- SHUD模型使用CVODE 5.0+（Hindmarsh et al.，2005）作为常微分方程求解器。该求解器由劳伦斯利弗莫尔国家实验室开发和维护。
- SHUD可使用灵活的时间和空间步长，适应多种尺度的模拟需求。
- SHUD支持高空间时间分辨率的洪水模拟，同时也支持长时间序列的气候和土地利用变化研究。
- SHUD是一个开源模型，任何人（非商业用途）都可以使用和修改该模型。

## 站在巨人肩上

SHUD的源代码是全新开发的，但其基本认知模型是基于Duffy（1996）提出的“两态耦合平衡”模型，并在数学模型中借鉴了Penn State Integrated Hydrologic Model（PIHM）的经验。SHUD模型的出现得益于PIHM模型的突破和经验积累。

### PIHM模型简史

在1996年，Duffy构建了“二态耦合平衡”模型来计算土壤水和地下水动态(Duffy, 1996)。该模型包括饱和和非饱和土壤层并计算它们之间的水的交换，以简化水文动态，同时保留自然中时空尺度对产流的响应。之后，Brandes和Duffy (1998) 沿用了“二态耦合平衡”模型，并利用FEMWATER实现了山坡-河流尺度上的双向水交互。在此基础上，Qu (2004) 将蒸散发过程和河道计算纳入到模型算法中，发布了Penn State Integrated Hydrologic Model (PIHM)的第一个版本——PIHM v1.0。自此以后，PIHM在不同尺度的流域中成为流域模拟通用研究工具的应用。

随后， Kumar、Bhartt和Duffy (Kumar et al., 2009; Kumar and Duffy, 2009) 分别开发了PIHM v2.0 和 PIHMgis。PIHM v2.0 增强了模型中陆面过程和土地利用对水文过程的影响，并且Gopal Bhartt开发了PIHMgis软件以生成PIHM的输入数据、读取输出数据和分析结果。PIHMgis有两个常用版本: PIHMgis v2.3 和 PIHMgis v3.0。 PIHMgis v2.3由于采用的是QGIS内核，在一些平台上很难更新，而PIHMgis v3.0 的支持性更好，可支持Mac或Windows操作系统。HydroTerre平台是由Leonard (2013) 所开发，它为PIHM和其他水文模型提供了基础的空间和时间数据，有利于推进PIHM模型的应用全球化。

PIHM模型的优势激发了相关研究者的兴趣，各种耦合模型都应运而生，如Flux-PIHM模型将NOAH陆面过程模型与PIHM模型耦合，实现更精确的陆面与大气的能量交换、蒸散发和积雪(SHI等人，2015年，2014年)。 张宇等开发了LE-PIHM，模型考虑了由水文过程造就的地形地貌变化的万年尺度的变化(Zhang et al.，2016)。 RT-PIHM 和 RT-Flux-PIHM (Bao, 2016；Bao et al.，2017 )则实现了化学反应与PIHM水文过程的耦合。但石宇宁领导的研究以及试图将所有与PIHM相关的模型作为模块统一建立多模块PIHM系统，即Multi-Module PIHM (MM-PIHM) (https://github.com/PSUmodeling/MM-PIHM)。除了上述模型，与PIHM相关的研究还包括与湖泊、农业和经济的耦合方法。

在PIHM模型快速发展的同时，Kumar (2009) 在PIHM v2.0的基础上，设计了一个名为FInite volume-based Integrated Hydrologic Modeling (FIHM)模型，它使用二阶精度和三维流动来模拟水文过程。

下图为PIHM模型的发展与分支。

![Figure_tree](/media/Figure_tree.png)
Figure 1: PIHM和SHUD模型的发展和分支。 PIHMgis和rSHUD分别是支持PIHM和SHUD的数据前后处理工具。 PIHMgis使用C++写成，rSHUD使用R.

### SHUD与PIHM的区别

SHUD模型是继承自PIHM的模型，基于Duffy在1996年提出的二相耦合概念模型，同时融合了PIHM 1.0和2.0的应用经验。但后来，作者经过对模型的空间结构、物理过程、算法以及编程语言的修改，导致SHUD模型已经不再和PIHM在模型物理结构、文件格式和计算方法上兼容。因此，作者使用了一个新名称来命名该模型，以体现其独特特点。

SHUD与PIHM的区别：

1. SHUD使用C++的面向对象编程方法，将计算过程进行了封装，避免了PIHM中常见的问题，例如内存泄漏。
2. SHUD采用不同的坡面和河道交互方式。相比PIHM中，河道连接着两个三角形坡面，SHUD在河道覆盖在三角形单元之上，从而避免了PIHM中四个问题：1. 河道的长度对计算单元数量的影响导致用户需要做出取舍。2. 平原地区河道的多个弯曲和微小三角形导致模型计算缓慢。3. 容易出现局部积水问题，导致模型解决整个流域问题的时间变慢。4. 用户不得不手动修改河流形状，致使原本具有的模型可重复性和效率降低。
3. SHUD中，对于入渗、地下水补给和河流交互的公式与PIHM采用的不同。公式的选择依据经验和模型设计时效需求。未来研究将会就此进行模型对比，展示两种计算方法的异同之处。
4. SHUD模型保证了计算中的水量平衡。

在技术层面，SHUD模型：

- 支持CVODE 5.0及以上版本。
- 支持OpenMP并行计算。
- 采用不同于PIHM的数据结构和算法。
- 输入和输出文件具有可读性。
- 对时间序列数据进行统一的操作。
- 输出模型状态并指定步长，用作后续模型运行的初始条件。
- 自动检查模型输入数据和参数的有效性。
- 具备模型调试选项，可以监控每一步长内的非法值和内存操作。

## SHUD对比性优势

### 与非数值方法模型（SWAT和TopModel为代表）对比:

与非数值方法模型相比，物理性分布式水文模型基于物理公式（如达西定律、理查德方程、简化圣维南方程等）来描述流域水文过程。它使用基本原理来求解整体流域响应，属于自下而上的方法，更能客观地模拟。因此，物理性模型优于概念模型和集总式模型。此外，物理性模型还可用于无观测流域的模拟研究。为了提高模型的可读性，可以采用分解长句、减少重复等方式。您可以考虑在文中增加一些连接词，以使得段落更加流畅和连贯。

- SHUD模型具有超高时间分辨率，可将时间分辨率提高至秒至分钟级，从而在描述流域变化的快过程，例如洪水过境、洪水淹没以及水化学过程等方面具有显著优势。模型内的自适应时间步长根据变化速度自动调整，既提高了模型整体运行效率，又满足了数值计算的收敛性要求。与之相比，以SWAT为代表的模型通常计算时间分辨率为天。

- SHUD模型的空间连续性有利于耦合研究。例如，模型可详细描述水从山坡汇流的路径，进而有利于生物化学、污染物运动、湖泊、生态以及地貌变迁等方面的模型耦合。而SWAT模型以HRU为单元来计算水的产汇流，但无法描述水从HRU最远点到河流的过程，因而也无法描述污染物在HRU内的传播路径。

- SHUD模型具有地表-地下全耦合，比传统模型更真实地表述了地表地下水的交互过程，并增强了模型在不同流域的通用性。例如，传统模型固定了地下水向河流的流向，而SHUD模型的地表地下紧耦合方法中，地下水与河流交互方向由实时水力梯度决定，即水可以双向流动。在干旱地区，SHUD模型也可用于表达河流渗漏补给地下水的过程。

- SHUD模型通过蒸发、地表径流、植被物候规律以及土壤特性变化等四个方面来体现土地利用，从而有效地表达了土地利用的水力学特征。相比之下，SWAT模型的土地利用特征则通过CN值表达，CN值难以测量并且缺乏足够的物理性。同时，CN值还包括土壤透水性、土地利用导致的粗糙度与不透水面积，并且难以表达物候特征，因此模型的不确定性较大。


### 与其他数值方法水文模型（以ParFlow、SHE、PAWS为代表）对比:

表1总结了SHUD模型与国际相似数值方法水文模型的区别。

- SHUD模型具备非结构化空间分割能力，相比于矩形网格的结构化网格，非结构网格更有利于表达流域边界、河流和空间特征。对于数值理论，非结构化网格的边界条件控制更为符合(来自Beven，2012)。

- 非结构化网格的操作可以实现局部加密或局部疏松，有效控制了数值方法的计算规模，并且保证了模型的数值计算稳定性。

- SHUD采用全局隐式求解方法同时求解流域快过程（例如地表径流）与慢过程（例如地下水流动）。模型保证了每一步长水文状态变量都满足收敛性要求，并确保了水文变量的连续性、一致性和收敛性。

- 模型使用有限体积法和程序内算法实现了局地和全局水量平衡。

- SHUD模型具备灵活的空间分辨率。现有研究结果表明，该模型可在厘米至公里级别的分辨率范围内运行，并取得预期的模拟效果。厘米级分辨率已应用于水槽箱试验模拟，公里级分辨率已应用于实际流域研究。

- 非结构网格中的河道经常与三角形单元相邻，由于河道自身的曲线，该模型会遇到四个问题：(1)其需要大量微小三角形单元来描述河道；(2)河道附近的三角形单元出现大钝角影响模拟精度；(3)河道起始点容易出现异常积水单元；(4)通过简化河道后，出现负值的河道坡度。SHUD模型引入了结构网络常用的交叉拓扑关系以解决这些问题，显著提高了数据制备和模拟效率。

- SHUD模型是一款开源模型，可以促进其自身的快速发展，同时有效支撑相关学科的耦合研究。




| 模型名称       | 求解方式     | 耦合方式   | 空间网格 | 数值方法 | 河道与坡面单元关系 | 开源 | 文献                                               |
| -------------- | ------------ | ---------- | -------- | -------- | ------------------ | ---- | -------------------------------------------------- |
| SHUD           | 一阶精度     | 全局隐式   | 非结构   | 有限体积 | 交叉               | 是   | Shu et al. (2020)                                  |
| PIHM           | 一阶精度     | 全局隐式   | 非结构   | 有限体积 | 相邻               | 是   | Qu and Duffy (2007)                                |
| CATHY          | 边界条件交互 | 次序迭代   | 非结构   | 有限元   | 无显式河道单元     |      | Aquanty Inc. (2013)                                |
| HydroGeoSphere | 一阶精度     | 全局隐式   | 非结构   | 有限元   |                    | 否   | Bixio et al. (2002); Camporese et al. (2010)       |
| OpenGeoSys     | 一阶精度     | 次序迭代   | 非结构   | 有限元   | 相邻               | 是   | Delfs et al., (2009, 2012)                         |
| ParFlow        | 压力连续     | 全局隐式   | 结    构 | 有限差分 | 交叉               | 是   | Kollet and Maxwell, (2006); Kollet et al., (2010); |
| PAWS           | 一阶精度     | 非同步连接 | 结构     | 有限差分 | 交叉               | 否   | Shen and Phanikumar, (2010)                        |
| tRIBS          | 一阶精度     | 非同步连接 | 非结构   | 有限元   | 相邻               | 否   | Ivanov et al. (2004)                               |
| MIKE SHE       | 边界条件交互 | 非同步连接 | 结构     | 有限差分 | 交叉               | 否   | Hansen et al. (2013)                               |
