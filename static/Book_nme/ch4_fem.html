<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 4 有限元法 | 数值地球</title>
  <meta name="description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="第 4 有限元法 | 数值地球" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://shud.xyz/Book_NME/image/Cover.jpg" />
  <meta property="og:description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 4 有限元法 | 数值地球" />
  
  <meta name="twitter:description" content="这是一本有关数值方法在地球科学应用的书，可以作为数值方法在大气、水文、地貌、地址和环境科学等方面的应用的入门教科书。" />
  <meta name="twitter:image" content="https://shud.xyz/Book_NME/image/Cover.jpg" />

<meta name="author" content="舒乐乐，孟宪红" />


<meta name="date" content="2025-09-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch3_fdm.html"/>
<link rel="next" href="ch5_fvm.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数值地球</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>绪论</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#数值方法在地球科学中的重要性"><i class="fa fa-check"></i><b>0.1</b> 数值方法在地球科学中的重要性</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#本书的目标与特色"><i class="fa fa-check"></i><b>0.2</b> 本书的目标与特色</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#主要内容概览"><i class="fa fa-check"></i><b>0.3</b> 主要内容概览</a>
<ul>
<li class="chapter" data-level="0.3.1" data-path="index.html"><a href="index.html#第一章建模基本方法论"><i class="fa fa-check"></i><b>0.3.1</b> 第一章：建模基本方法论</a></li>
<li class="chapter" data-level="0.3.2" data-path="index.html"><a href="index.html#第二章数值方法基础"><i class="fa fa-check"></i><b>0.3.2</b> 第二章：数值方法基础</a></li>
<li class="chapter" data-level="0.3.3" data-path="index.html"><a href="index.html#第三章有限差分法"><i class="fa fa-check"></i><b>0.3.3</b> 第三章：有限差分法</a></li>
<li class="chapter" data-level="0.3.4" data-path="index.html"><a href="index.html#第四章有限元法"><i class="fa fa-check"></i><b>0.3.4</b> 第四章：有限元法</a></li>
<li class="chapter" data-level="0.3.5" data-path="index.html"><a href="index.html#第五章有限体积法"><i class="fa fa-check"></i><b>0.3.5</b> 第五章：有限体积法</a></li>
<li class="chapter" data-level="0.3.6" data-path="index.html"><a href="index.html#第六章应用案例"><i class="fa fa-check"></i><b>0.3.6</b> 第六章：应用案例</a></li>
</ul></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#学习建议"><i class="fa fa-check"></i><b>0.4</b> 学习建议</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#代码示例简单的数值积分"><i class="fa fa-check"></i><b>0.5</b> 代码示例：简单的数值积分</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#结语"><i class="fa fa-check"></i><b>0.6</b> 结语</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch1_modeling.html"><a href="ch1_modeling.html"><i class="fa fa-check"></i><b>1</b> 建模基本方法论</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ch1_modeling.html"><a href="ch1_modeling.html#建模基本思路"><i class="fa fa-check"></i><b>1.1</b> 建模基本思路</a>
<ul>
<li class="chapter" data-level="" data-path="ch1_modeling.html"><a href="ch1_modeling.html#clams方法应用案例落体运动"><i class="fa fa-check"></i>CLAMS方法应用案例：<strong>落体运动</strong></a></li>
<li class="chapter" data-level="1.1.1" data-path="ch1_modeling.html"><a href="ch1_modeling.html#落体运动的数值求解方法"><i class="fa fa-check"></i><b>1.1.1</b> 落体运动的数值求解方法</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ch1_modeling.html"><a href="ch1_modeling.html#解析解与数值解"><i class="fa fa-check"></i><b>1.2</b> 解析解与数值解</a></li>
<li class="chapter" data-level="1.3" data-path="ch1_modeling.html"><a href="ch1_modeling.html#典型控制方程"><i class="fa fa-check"></i><b>1.3</b> 典型控制方程</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="ch1_modeling.html"><a href="ch1_modeling.html#一维承压地下水运动"><i class="fa fa-check"></i><b>1.3.1</b> 一维承压地下水运动</a></li>
<li class="chapter" data-level="1.3.2" data-path="ch1_modeling.html"><a href="ch1_modeling.html#二维承压地下水运动"><i class="fa fa-check"></i><b>1.3.2</b> 二维承压地下水运动</a></li>
<li class="chapter" data-level="1.3.3" data-path="ch1_modeling.html"><a href="ch1_modeling.html#一维非承压地下水运动"><i class="fa fa-check"></i><b>1.3.3</b> 一维非承压地下水运动</a></li>
<li class="chapter" data-level="1.3.4" data-path="ch1_modeling.html"><a href="ch1_modeling.html#二维非承压地下水运动"><i class="fa fa-check"></i><b>1.3.4</b> 二维非承压地下水运动</a></li>
<li class="chapter" data-level="1.3.5" data-path="ch1_modeling.html"><a href="ch1_modeling.html#三维非承压地下水运动"><i class="fa fa-check"></i><b>1.3.5</b> 三维非承压地下水运动</a></li>
<li class="chapter" data-level="1.3.6" data-path="ch1_modeling.html"><a href="ch1_modeling.html#一维热传导方程"><i class="fa fa-check"></i><b>1.3.6</b> 一维热传导方程</a></li>
<li class="chapter" data-level="1.3.7" data-path="ch1_modeling.html"><a href="ch1_modeling.html#一维溶质运移-扩散方程"><i class="fa fa-check"></i><b>1.3.7</b> 一维溶质运移-扩散方程</a></li>
<li class="chapter" data-level="1.3.8" data-path="ch1_modeling.html"><a href="ch1_modeling.html#二维溶质运移-扩散方程"><i class="fa fa-check"></i><b>1.3.8</b> 二维溶质运移-扩散方程</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch2_nm.html"><a href="ch2_nm.html"><i class="fa fa-check"></i><b>2</b> 数值方法基础</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch2_nm.html"><a href="ch2_nm.html#隐式与显式求解法"><i class="fa fa-check"></i><b>2.1</b> 隐式与显式求解法</a></li>
<li class="chapter" data-level="2.2" data-path="ch2_nm.html"><a href="ch2_nm.html#数值迭代方法"><i class="fa fa-check"></i><b>2.2</b> 数值迭代方法</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch2_nm.html"><a href="ch2_nm.html#牛顿迭代newton-iteration"><i class="fa fa-check"></i><b>2.2.1</b> 牛顿迭代(Newton Iteration)</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch2_nm.html"><a href="ch2_nm.html#欧拉方法euler-method"><i class="fa fa-check"></i><b>2.2.2</b> 欧拉方法(Euler Method)</a></li>
<li class="chapter" data-level="2.2.3" data-path="ch2_nm.html"><a href="ch2_nm.html#龙格-库塔方法runge-kutta-method"><i class="fa fa-check"></i><b>2.2.3</b> 龙格-库塔方法(Runge-Kutta Method)</a></li>
<li class="chapter" data-level="2.2.4" data-path="ch2_nm.html"><a href="ch2_nm.html#皮卡法picard-method"><i class="fa fa-check"></i><b>2.2.4</b> 皮卡法(Picard Method)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch2_nm.html"><a href="ch2_nm.html#有限元-有限差分-有限体积"><i class="fa fa-check"></i><b>2.3</b> 有限元, 有限差分 ,有限体积</a></li>
<li class="chapter" data-level="2.4" data-path="ch2_nm.html"><a href="ch2_nm.html#cfl条件约束"><i class="fa fa-check"></i><b>2.4</b> CFL条件约束</a></li>
<li class="chapter" data-level="2.5" data-path="ch2_nm.html"><a href="ch2_nm.html#时空离散化"><i class="fa fa-check"></i><b>2.5</b> 时空离散化</a></li>
<li class="chapter" data-level="2.6" data-path="ch2_nm.html"><a href="ch2_nm.html#初始条件"><i class="fa fa-check"></i><b>2.6</b> 初始条件</a></li>
<li class="chapter" data-level="2.7" data-path="ch2_nm.html"><a href="ch2_nm.html#边界条件"><i class="fa fa-check"></i><b>2.7</b> 边界条件</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch3_fdm.html"><a href="ch3_fdm.html"><i class="fa fa-check"></i><b>3</b> 有限差分法</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch3_fdm.html"><a href="ch3_fdm.html#泰勒级数taylor-series"><i class="fa fa-check"></i><b>3.1</b> 泰勒级数(Taylor Series)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ch3_fdm.html"><a href="ch3_fdm.html#截断误差"><i class="fa fa-check"></i><b>3.1.1</b> 截断误差</a></li>
<li class="chapter" data-level="3.1.2" data-path="ch3_fdm.html"><a href="ch3_fdm.html#一阶导数"><i class="fa fa-check"></i><b>3.1.2</b> 一阶导数</a></li>
<li class="chapter" data-level="3.1.3" data-path="ch3_fdm.html"><a href="ch3_fdm.html#二阶导数"><i class="fa fa-check"></i><b>3.1.3</b> 二阶导数</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ch3_fdm.html"><a href="ch3_fdm.html#构建数值方法"><i class="fa fa-check"></i><b>3.2</b> 构建数值方法</a></li>
<li class="chapter" data-level="3.3" data-path="ch3_fdm.html"><a href="ch3_fdm.html#显式求解法"><i class="fa fa-check"></i><b>3.3</b> 显式求解法</a></li>
<li class="chapter" data-level="3.4" data-path="ch3_fdm.html"><a href="ch3_fdm.html#隐式求解法"><i class="fa fa-check"></i><b>3.4</b> 隐式求解法</a></li>
<li class="chapter" data-level="3.5" data-path="ch3_fdm.html"><a href="ch3_fdm.html#编程求解"><i class="fa fa-check"></i><b>3.5</b> 编程求解</a></li>
<li class="chapter" data-level="3.6" data-path="ch3_fdm.html"><a href="ch3_fdm.html#显式与隐式求解法对比"><i class="fa fa-check"></i><b>3.6</b> 显式与隐式求解法对比</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="ch3_fdm.html"><a href="ch3_fdm.html#cfl条件"><i class="fa fa-check"></i><b>3.6.1</b> CFL条件</a></li>
<li class="chapter" data-level="3.6.2" data-path="ch3_fdm.html"><a href="ch3_fdm.html#计算效率"><i class="fa fa-check"></i><b>3.6.2</b> 计算效率</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="ch3_fdm.html"><a href="ch3_fdm.html#二维有限差分"><i class="fa fa-check"></i><b>3.7</b> 二维有限差分</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="ch3_fdm.html"><a href="ch3_fdm.html#编程求解-1"><i class="fa fa-check"></i><b>3.7.1</b> 编程求解</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch4_fem.html"><a href="ch4_fem.html"><i class="fa fa-check"></i><b>4</b> 有限元法</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元法理论基础"><i class="fa fa-check"></i><b>4.1</b> 有限元法理论基础</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ch4_fem.html"><a href="ch4_fem.html#历史发展与应用背景"><i class="fa fa-check"></i><b>4.1.1</b> 历史发展与应用背景</a></li>
<li class="chapter" data-level="4.1.2" data-path="ch4_fem.html"><a href="ch4_fem.html#基本思想与哲学"><i class="fa fa-check"></i><b>4.1.2</b> 基本思想与哲学</a></li>
<li class="chapter" data-level="4.1.3" data-path="ch4_fem.html"><a href="ch4_fem.html#详细求解步骤"><i class="fa fa-check"></i><b>4.1.3</b> 详细求解步骤</a></li>
<li class="chapter" data-level="4.1.4" data-path="ch4_fem.html"><a href="ch4_fem.html#变分原理的深入理解"><i class="fa fa-check"></i><b>4.1.4</b> 变分原理的深入理解</a></li>
<li class="chapter" data-level="4.1.5" data-path="ch4_fem.html"><a href="ch4_fem.html#形函数理论的完整体系"><i class="fa fa-check"></i><b>4.1.5</b> 形函数理论的完整体系</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch4_fem.html"><a href="ch4_fem.html#数学公式论证"><i class="fa fa-check"></i><b>4.2</b> 数学公式论证</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ch4_fem.html"><a href="ch4_fem.html#变分形式的推导"><i class="fa fa-check"></i><b>4.2.1</b> 变分形式的推导</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元离散化"><i class="fa fa-check"></i><b>4.2.2</b> 有限元离散化</a></li>
<li class="chapter" data-level="4.2.3" data-path="ch4_fem.html"><a href="ch4_fem.html#单元矩阵的构造"><i class="fa fa-check"></i><b>4.2.3</b> 单元矩阵的构造</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch4_fem.html"><a href="ch4_fem.html#一维热传导问题的深入分析与fem求解"><i class="fa fa-check"></i><b>4.3</b> 一维热传导问题的深入分析与FEM求解</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ch4_fem.html"><a href="ch4_fem.html#工程背景与实际意义"><i class="fa fa-check"></i><b>4.3.1</b> 工程背景与实际意义</a></li>
<li class="chapter" data-level="4.3.2" data-path="ch4_fem.html"><a href="ch4_fem.html#详细问题描述"><i class="fa fa-check"></i><b>4.3.2</b> 详细问题描述</a></li>
<li class="chapter" data-level="4.3.3" data-path="ch4_fem.html"><a href="ch4_fem.html#clams方法的系统化建模"><i class="fa fa-check"></i><b>4.3.3</b> CLAMS方法的系统化建模</a></li>
<li class="chapter" data-level="4.3.4" data-path="ch4_fem.html"><a href="ch4_fem.html#r代码实现"><i class="fa fa-check"></i><b>4.3.4</b> R代码实现</a></li>
<li class="chapter" data-level="4.3.5" data-path="ch4_fem.html"><a href="ch4_fem.html#完整实现代码"><i class="fa fa-check"></i><b>4.3.5</b> 完整实现代码</a></li>
<li class="chapter" data-level="4.3.6" data-path="ch4_fem.html"><a href="ch4_fem.html#运行结果示例"><i class="fa fa-check"></i><b>4.3.6</b> 运行结果示例</a></li>
<li class="chapter" data-level="4.3.7" data-path="ch4_fem.html"><a href="ch4_fem.html#高级有限元技术实现"><i class="fa fa-check"></i><b>4.3.7</b> 高级有限元技术实现</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ch4_fem.html"><a href="ch4_fem.html#地球科学应用案例地下水流模拟"><i class="fa fa-check"></i><b>4.4</b> 地球科学应用案例：地下水流模拟</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ch4_fem.html"><a href="ch4_fem.html#问题背景"><i class="fa fa-check"></i><b>4.4.1</b> 问题背景</a></li>
<li class="chapter" data-level="4.4.2" data-path="ch4_fem.html"><a href="ch4_fem.html#数学模型"><i class="fa fa-check"></i><b>4.4.2</b> 数学模型</a></li>
<li class="chapter" data-level="4.4.3" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元离散化-1"><i class="fa fa-check"></i><b>4.4.3</b> 有限元离散化</a></li>
<li class="chapter" data-level="4.4.4" data-path="ch4_fem.html"><a href="ch4_fem.html#实际应用案例"><i class="fa fa-check"></i><b>4.4.4</b> 实际应用案例</a></li>
<li class="chapter" data-level="4.4.5" data-path="ch4_fem.html"><a href="ch4_fem.html#工程意义"><i class="fa fa-check"></i><b>4.4.5</b> 工程意义</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元法的收敛性分析与误差估计"><i class="fa fa-check"></i><b>4.5</b> 有限元法的收敛性分析与误差估计</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="ch4_fem.html"><a href="ch4_fem.html#收敛性理论基础"><i class="fa fa-check"></i><b>4.5.1</b> 收敛性理论基础</a></li>
<li class="chapter" data-level="4.5.2" data-path="ch4_fem.html"><a href="ch4_fem.html#先验误差估计"><i class="fa fa-check"></i><b>4.5.2</b> 先验误差估计</a></li>
<li class="chapter" data-level="4.5.3" data-path="ch4_fem.html"><a href="ch4_fem.html#后验误差估计"><i class="fa fa-check"></i><b>4.5.3</b> 后验误差估计</a></li>
<li class="chapter" data-level="4.5.4" data-path="ch4_fem.html"><a href="ch4_fem.html#自适应网格细化"><i class="fa fa-check"></i><b>4.5.4</b> 自适应网格细化</a></li>
<li class="chapter" data-level="4.5.5" data-path="ch4_fem.html"><a href="ch4_fem.html#数值实验与验证"><i class="fa fa-check"></i><b>4.5.5</b> 数值实验与验证</a></li>
<li class="chapter" data-level="4.5.6" data-path="ch4_fem.html"><a href="ch4_fem.html#误差的物理解释"><i class="fa fa-check"></i><b>4.5.6</b> 误差的物理解释</a></li>
<li class="chapter" data-level="4.5.7" data-path="ch4_fem.html"><a href="ch4_fem.html#收敛性改进技术"><i class="fa fa-check"></i><b>4.5.7</b> 收敛性改进技术</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元法与有限差分法的系统对比"><i class="fa fa-check"></i><b>4.6</b> 有限元法与有限差分法的系统对比</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="ch4_fem.html"><a href="ch4_fem.html#理论基础对比"><i class="fa fa-check"></i><b>4.6.1</b> 理论基础对比</a></li>
<li class="chapter" data-level="4.6.2" data-path="ch4_fem.html"><a href="ch4_fem.html#精度和稳定性对比"><i class="fa fa-check"></i><b>4.6.2</b> 精度和稳定性对比</a></li>
<li class="chapter" data-level="4.6.3" data-path="ch4_fem.html"><a href="ch4_fem.html#计算效率对比"><i class="fa fa-check"></i><b>4.6.3</b> 计算效率对比</a></li>
<li class="chapter" data-level="4.6.4" data-path="ch4_fem.html"><a href="ch4_fem.html#适用性分析"><i class="fa fa-check"></i><b>4.6.4</b> 适用性分析</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ch4_fem.html"><a href="ch4_fem.html#高级有限元技术的深入探讨"><i class="fa fa-check"></i><b>4.7</b> 高级有限元技术的深入探讨</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="ch4_fem.html"><a href="ch4_fem.html#高阶形函数技术"><i class="fa fa-check"></i><b>4.7.1</b> 高阶形函数技术</a></li>
<li class="chapter" data-level="4.7.2" data-path="ch4_fem.html"><a href="ch4_fem.html#自适应有限元技术"><i class="fa fa-check"></i><b>4.7.2</b> 自适应有限元技术</a></li>
<li class="chapter" data-level="4.7.3" data-path="ch4_fem.html"><a href="ch4_fem.html#稳定化技术"><i class="fa fa-check"></i><b>4.7.3</b> 稳定化技术</a></li>
<li class="chapter" data-level="4.7.4" data-path="ch4_fem.html"><a href="ch4_fem.html#多尺度有限元方法"><i class="fa fa-check"></i><b>4.7.4</b> 多尺度有限元方法</a></li>
<li class="chapter" data-level="4.7.5" data-path="ch4_fem.html"><a href="ch4_fem.html#间断有限元方法"><i class="fa fa-check"></i><b>4.7.5</b> 间断有限元方法</a></li>
<li class="chapter" data-level="4.7.6" data-path="ch4_fem.html"><a href="ch4_fem.html#混合有限元方法"><i class="fa fa-check"></i><b>4.7.6</b> 混合有限元方法</a></li>
<li class="chapter" data-level="4.7.7" data-path="ch4_fem.html"><a href="ch4_fem.html#有限元方法的并行计算"><i class="fa fa-check"></i><b>4.7.7</b> 有限元方法的并行计算</a></li>
<li class="chapter" data-level="4.7.8" data-path="ch4_fem.html"><a href="ch4_fem.html#高级技术的应用实例"><i class="fa fa-check"></i><b>4.7.8</b> 高级技术的应用实例</a></li>
<li class="chapter" data-level="4.7.9" data-path="ch4_fem.html"><a href="ch4_fem.html#实现考虑"><i class="fa fa-check"></i><b>4.7.9</b> 实现考虑</a></li>
<li class="chapter" data-level="4.7.10" data-path="ch4_fem.html"><a href="ch4_fem.html#软件实现框架"><i class="fa fa-check"></i><b>4.7.10</b> 软件实现框架</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ch4_fem.html"><a href="ch4_fem.html#总结"><i class="fa fa-check"></i><b>4.8</b> 总结</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="ch4_fem.html"><a href="ch4_fem.html#本章要点回顾"><i class="fa fa-check"></i><b>4.8.1</b> 本章要点回顾</a></li>
<li class="chapter" data-level="4.8.2" data-path="ch4_fem.html"><a href="ch4_fem.html#扩展阅读建议"><i class="fa fa-check"></i><b>4.8.2</b> 扩展阅读建议</a></li>
<li class="chapter" data-level="4.8.3" data-path="ch4_fem.html"><a href="ch4_fem.html#实践练习"><i class="fa fa-check"></i><b>4.8.3</b> 实践练习</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch5_fvm.html"><a href="ch5_fvm.html"><i class="fa fa-check"></i><b>5</b> 有限体积法</a></li>
<li class="chapter" data-level="6" data-path="ch6_app.html"><a href="ch6_app.html"><i class="fa fa-check"></i><b>6</b> 应用案例</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch6_app.html"><a href="ch6_app.html#热传递问题heat-transfer"><i class="fa fa-check"></i><b>6.1</b> 热传递问题(Heat Transfer)</a></li>
<li class="chapter" data-level="6.2" data-path="ch6_app.html"><a href="ch6_app.html#大气混沌系统chaos-system-in-atmosphere"><i class="fa fa-check"></i><b>6.2</b> 大气混沌系统（Chaos System in Atmosphere）</a></li>
<li class="chapter" data-level="6.3" data-path="ch6_app.html"><a href="ch6_app.html#土壤垂直水分流动"><i class="fa fa-check"></i><b>6.3</b> 土壤垂直水分流动</a></li>
<li class="chapter" data-level="6.4" data-path="ch6_app.html"><a href="ch6_app.html#土壤垂直一维水热耦合问题"><i class="fa fa-check"></i><b>6.4</b> 土壤垂直一维水热耦合问题</a></li>
<li class="chapter" data-level="6.5" data-path="ch6_app.html"><a href="ch6_app.html#承压地下水confined-aquifer"><i class="fa fa-check"></i><b>6.5</b> 承压地下水（Confined Aquifer）</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="ch6_app.html"><a href="ch6_app.html#控制方程"><i class="fa fa-check"></i><b>6.5.1</b> 控制方程</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="ch6_app.html"><a href="ch6_app.html#湖面湍流lake-turbulence"><i class="fa fa-check"></i><b>6.6</b> 湖面湍流（Lake Turbulence）</a></li>
<li class="chapter" data-level="6.7" data-path="ch6_app.html"><a href="ch6_app.html#溶质运移solute-transport"><i class="fa fa-check"></i><b>6.7</b> 溶质运移（Solute Transport）</a></li>
<li class="chapter" data-level="6.8" data-path="ch6_app.html"><a href="ch6_app.html#地貌侵蚀landscape-evolution"><i class="fa fa-check"></i><b>6.8</b> 地貌侵蚀（Landscape Evolution）</a></li>
<li class="chapter" data-level="6.9" data-path="ch6_app.html"><a href="ch6_app.html#熔岩入侵lava-invasion"><i class="fa fa-check"></i><b>6.9</b> 熔岩入侵（Lava Invasion）</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数值地球</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch4_fem" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">第 4</span> 有限元法<a href="ch4_fem.html#ch4_fem" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="有限元法理论基础" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 有限元法理论基础<a href="ch4_fem.html#有限元法理论基础" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>有限元法（Finite Element Method, FEM）是一种强大的数值分析方法，广泛应用于求解工程和科学中的偏微分方程问题。它由Richard Courant于1943年首次提出，经过几十年的发展，已成为现代数值计算的重要工具之一。</p>
<div id="历史发展与应用背景" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> 历史发展与应用背景<a href="ch4_fem.html#历史发展与应用背景" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有限元法的发展经历了几个重要阶段：</p>
<ol style="list-style-type: decimal">
<li><strong>理论奠基期（1943-1960）</strong>：Courant提出了使用分片多项式和变分方法求解偏微分方程的思想</li>
<li><strong>工程应用期（1960-1980）</strong>：在结构力学和航空航天领域得到广泛应用</li>
<li><strong>理论完善期（1980-2000）</strong>：数学理论体系日趋完善，收敛性和误差分析取得重大进展</li>
<li><strong>多学科融合期（2000至今）</strong>：在地球科学、生物医学、材料科学等领域得到广泛应用</li>
</ol>
<p>在地球科学中，有限元法特别适用于：
- 地下水流动模拟
- 地质构造变形分析
- 地震波传播计算
- 地热传输模拟
- 污染物扩散预测</p>
</div>
<div id="基本思想与哲学" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> 基本思想与哲学<a href="ch4_fem.html#基本思想与哲学" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有限元法的核心思想体现了”分而治之”的哲学理念，将复杂的连续问题分解为简单的离散问题。这种思想具有以下特点：</p>
<ol style="list-style-type: decimal">
<li><strong>局部化原理</strong>：复杂的全局问题可以通过求解简单的局部问题来近似</li>
<li><strong>分片逼近</strong>：使用简单的多项式函数在每个小区域内逼近真解</li>
<li><strong>变分基础</strong>：基于能量原理或变分原理，确保解的物理合理性</li>
<li><strong>系统性方法</strong>：提供了一套系统的、标准化的求解流程</li>
</ol>
</div>
<div id="详细求解步骤" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> 详细求解步骤<a href="ch4_fem.html#详细求解步骤" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有限元法的完整求解过程包括以下七个核心步骤：</p>
<div id="域离散化domain-discretization" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> 1. 域离散化（Domain Discretization）<a href="ch4_fem.html#域离散化domain-discretization" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>将连续的求解域 <span class="math inline">\(\Omega\)</span> 划分为 <span class="math inline">\(N_e\)</span> 个不重叠的子域（单元）：
<span class="math display">\[\Omega = \bigcup_{e=1}^{N_e} \Omega_e, \quad \Omega_i \cap \Omega_j = \emptyset \text{ (when } i \neq j \text{)}\]</span></p>
<p>单元类型的选择原则：
- <strong>一维问题</strong>：线段单元（2节点或3节点）
- <strong>二维问题</strong>：三角形单元或四边形单元
- <strong>三维问题</strong>：四面体单元或六面体单元</p>
</div>
<div id="形函数构造shape-function-construction" class="section level4 hasAnchor" number="4.1.3.2">
<h4><span class="header-section-number">4.1.3.2</span> 2. 形函数构造（Shape Function Construction）<a href="ch4_fem.html#形函数构造shape-function-construction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在每个单元内定义形函数 <span class="math inline">\(N_i(x)\)</span>，满足：
- <strong>插值性质</strong>：<span class="math inline">\(N_i(x_j) = \delta_{ij}\)</span>（Kronecker delta）
- <strong>完备性质</strong>：能够精确表示多项式函数
- <strong>连续性质</strong>：在单元边界上保持连续性</p>
</div>
<div id="弱形式建立weak-formulation" class="section level4 hasAnchor" number="4.1.3.3">
<h4><span class="header-section-number">4.1.3.3</span> 3. 弱形式建立（Weak Formulation）<a href="ch4_fem.html#弱形式建立weak-formulation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>通过分部积分和Green公式，将强形式的偏微分方程转化为弱形式，降低对解的光滑性要求。</p>
</div>
<div id="单元矩阵组装element-matrix-assembly" class="section level4 hasAnchor" number="4.1.3.4">
<h4><span class="header-section-number">4.1.3.4</span> 4. 单元矩阵组装（Element Matrix Assembly）<a href="ch4_fem.html#单元矩阵组装element-matrix-assembly" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在每个单元上计算局部刚度矩阵 <span class="math inline">\(\mathbf{K}^e\)</span> 和质量矩阵 <span class="math inline">\(\mathbf{M}^e\)</span>。</p>
</div>
<div id="全局矩阵组装global-matrix-assembly" class="section level4 hasAnchor" number="4.1.3.5">
<h4><span class="header-section-number">4.1.3.5</span> 5. 全局矩阵组装（Global Matrix Assembly）<a href="ch4_fem.html#全局矩阵组装global-matrix-assembly" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>将所有单元的贡献组装成全局矩阵：
<span class="math display">\[\mathbf{K} = \sum_{e=1}^{N_e} \mathbf{A}^e \mathbf{K}^e (\mathbf{A}^e)^T\]</span></p>
<p>其中 <span class="math inline">\(\mathbf{A}^e\)</span> 是单元组装矩阵。</p>
</div>
<div id="边界条件施加boundary-condition-implementation" class="section level4 hasAnchor" number="4.1.3.6">
<h4><span class="header-section-number">4.1.3.6</span> 6. 边界条件施加（Boundary Condition Implementation）<a href="ch4_fem.html#边界条件施加boundary-condition-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>处理不同类型的边界条件：
- <strong>Dirichlet边界条件</strong>：指定函数值
- <strong>Neumann边界条件</strong>：指定导数值
- <strong>Robin边界条件</strong>：混合边界条件</p>
</div>
<div id="线性方程组求解linear-system-solution" class="section level4 hasAnchor" number="4.1.3.7">
<h4><span class="header-section-number">4.1.3.7</span> 7. 线性方程组求解（Linear System Solution）<a href="ch4_fem.html#线性方程组求解linear-system-solution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>求解最终的线性代数方程组：
<span class="math display">\[\mathbf{K}\mathbf{u} = \mathbf{f}\]</span></p>
<p>使用适当的数值方法（直接法或迭代法）求解。</p>
</div>
</div>
<div id="变分原理的深入理解" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> 变分原理的深入理解<a href="ch4_fem.html#变分原理的深入理解" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="变分原理的数学基础" class="section level4 hasAnchor" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> 变分原理的数学基础<a href="ch4_fem.html#变分原理的数学基础" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>变分原理是有限元法的理论基石，它建立了偏微分方程与泛函极值问题之间的等价关系。这种等价性不仅为数值求解提供了新的途径，更重要的是为解的存在性和唯一性提供了理论保证。</p>
<p><strong>泛函的定义</strong>：
泛函是从函数空间到实数的映射。对于函数 <span class="math inline">\(u(x)\)</span>，泛函 <span class="math inline">\(J[u]\)</span> 将函数 <span class="math inline">\(u\)</span> 映射到一个实数值：
<span class="math display">\[J[u] = \int_\Omega F(x, u, \nabla u) dx\]</span></p>
<p>其中 <span class="math inline">\(F\)</span> 是给定的函数，<span class="math inline">\(\nabla u\)</span> 是 <span class="math inline">\(u\)</span> 的梯度。</p>
</div>
<div id="从强形式到弱形式的详细推导" class="section level4 hasAnchor" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> 从强形式到弱形式的详细推导<a href="ch4_fem.html#从强形式到弱形式的详细推导" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>考虑一般的二阶椭圆型偏微分方程：
<span class="math display">\[-\nabla \cdot (k(x) \nabla u) + c(x) u = f(x) \quad \text{in} \quad \Omega\]</span></p>
<p>配以边界条件：
<span class="math display">\[u = g \quad \text{on} \quad \Gamma_D \quad \text{(Dirichlet边界)}\]</span>
<span class="math display">\[k \frac{\partial u}{\partial n} = h \quad \text{on} \quad \Gamma_N \quad \text{(Neumann边界)}\]</span></p>
<p>其中 <span class="math inline">\(\Gamma_D \cup \Gamma_N = \partial\Omega\)</span>，<span class="math inline">\(\partial\Omega\)</span> 是 <span class="math inline">\(\Omega\)</span> 的边界。</p>
<p><strong>步骤1：构造测试函数空间</strong></p>
<p>定义测试函数空间：
<span class="math display">\[V_0 = \{v \in H^1(\Omega) : v = 0 \text{ on } \Gamma_D\}\]</span></p>
<p>其中 <span class="math inline">\(H^1(\Omega)\)</span> 是Sobolev空间，包含所有在 <span class="math inline">\(\Omega\)</span> 上平方可积且弱导数也平方可积的函数。</p>
<p><strong>步骤2：建立弱形式</strong></p>
<p>将强形式方程乘以测试函数 <span class="math inline">\(v \in V_0\)</span> 并在 <span class="math inline">\(\Omega\)</span> 上积分：
<span class="math display">\[\int_\Omega [-\nabla \cdot (k \nabla u) + c u] v \, dx = \int_\Omega f v \, dx\]</span></p>
<p><strong>步骤3：应用Green公式（分部积分）</strong></p>
<p>对第一项应用Green公式：
<span class="math display">\[-\int_\Omega v \nabla \cdot (k \nabla u) dx = \int_\Omega k \nabla u \cdot \nabla v \, dx - \int_{\partial\Omega} v k \frac{\partial u}{\partial n} ds\]</span></p>
<p>由于 <span class="math inline">\(v = 0\)</span> 在 <span class="math inline">\(\Gamma_D\)</span> 上，边界积分只在 <span class="math inline">\(\Gamma_N\)</span> 上非零：
<span class="math display">\[-\int_{\partial\Omega} v k \frac{\partial u}{\partial n} ds = -\int_{\Gamma_N} v h \, ds\]</span></p>
<p><strong>步骤4：得到弱形式</strong></p>
<p>最终的弱形式为：寻找 <span class="math inline">\(u \in V_g = \{w \in H^1(\Omega) : w = g \text{ on } \Gamma_D\}\)</span>，使得对所有 <span class="math inline">\(v \in V_0\)</span>：</p>
<p><span class="math display">\[\int_\Omega k \nabla u \cdot \nabla v \, dx + \int_\Omega c u v \, dx = \int_\Omega f v \, dx + \int_{\Gamma_N} h v \, ds\]</span></p>
<p>这可以写成抽象形式：
<span class="math display">\[a(u,v) = L(v)\]</span></p>
<p>其中：
- <span class="math inline">\(a(u,v) = \int_\Omega k \nabla u \cdot \nabla v \, dx + \int_\Omega c u v \, dx\)</span> （双线性形式）
- <span class="math inline">\(L(v) = \int_\Omega f v \, dx + \int_{\Gamma_N} h v \, ds\)</span> （线性形式）</p>
</div>
<div id="变分原理的物理意义" class="section level4 hasAnchor" number="4.1.4.3">
<h4><span class="header-section-number">4.1.4.3</span> 变分原理的物理意义<a href="ch4_fem.html#变分原理的物理意义" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>变分原理具有深刻的物理意义：</p>
<ol style="list-style-type: decimal">
<li><strong>能量最小原理</strong>：对于弹性力学问题，弱形式对应于势能的最小化</li>
<li><strong>虚功原理</strong>：弱形式表达了虚位移做的虚功等于外力做的虚功</li>
<li><strong>守恒定律</strong>：弱形式自然地体现了各种守恒定律（质量、动量、能量等）</li>
</ol>
</div>
<div id="lax-milgram定理" class="section level4 hasAnchor" number="4.1.4.4">
<h4><span class="header-section-number">4.1.4.4</span> Lax-Milgram定理<a href="ch4_fem.html#lax-milgram定理" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Lax-Milgram定理保证了弱形式解的存在性和唯一性。如果双线性形式 <span class="math inline">\(a(\cdot,\cdot)\)</span> 满足：</p>
<ol style="list-style-type: decimal">
<li><strong>连续性</strong>：存在常数 <span class="math inline">\(M &gt; 0\)</span>，使得 <span class="math inline">\(|a(u,v)| \leq M \|u\|_{V} \|v\|_{V}\)</span></li>
<li><strong>强制性（椭圆性）</strong>：存在常数 <span class="math inline">\(\alpha &gt; 0\)</span>，使得 <span class="math inline">\(a(v,v) \geq \alpha \|v\|_{V}^2\)</span></li>
</ol>
<p>且线性形式 <span class="math inline">\(L(\cdot)\)</span> 连续，则弱形式存在唯一解。</p>
</div>
<div id="等价性定理" class="section level4 hasAnchor" number="4.1.4.5">
<h4><span class="header-section-number">4.1.4.5</span> 等价性定理<a href="ch4_fem.html#等价性定理" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在适当的正则性假设下，强形式和弱形式是等价的：
- 强形式的解必然是弱形式的解
- 在足够光滑的条件下，弱形式的解也是强形式的解</p>
<p>这种等价性为有限元法提供了坚实的理论基础。</p>
</div>
</div>
<div id="形函数理论的完整体系" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> 形函数理论的完整体系<a href="ch4_fem.html#形函数理论的完整体系" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>形函数（Shape Functions）是有限元法的核心概念，它们不仅定义了单元内的插值关系，更是连接离散节点值与连续函数空间的桥梁。深入理解形函数的性质和构造方法，对于掌握有限元法的精髓至关重要。</p>
<div id="形函数的基本性质" class="section level4 hasAnchor" number="4.1.5.1">
<h4><span class="header-section-number">4.1.5.1</span> 形函数的基本性质<a href="ch4_fem.html#形函数的基本性质" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>形函数必须满足以下四个基本性质：</p>
<p><strong>1. 插值性质（Interpolation Property）</strong>
<span class="math display">\[N_i(x_j) = \delta_{ij} = \begin{cases} 1 &amp; \text{if } i = j \\ 0 &amp; \text{if } i \neq j \end{cases}\]</span></p>
<p>这确保了节点值的准确插值。</p>
<p><strong>2. 单位分解性质（Partition of Unity）</strong>
<span class="math display">\[\sum_{i=1}^{n} N_i(x) = 1, \quad \forall x \in \Omega_e\]</span></p>
<p>这保证了常数函数能够被精确表示。</p>
<p><strong>3. 完备性性质（Completeness Property）</strong>
形函数集合能够精确表示完全多项式，至少到某个给定阶数 <span class="math inline">\(p\)</span>：
<span class="math display">\[\mathcal{P}_p \subset \text{span}\{N_1, N_2, \ldots, N_n\}\]</span></p>
<p>其中 <span class="math inline">\(\mathcal{P}_p\)</span> 是阶数不超过 <span class="math inline">\(p\)</span> 的多项式空间。</p>
<p><strong>4. 连续性性质（Continuity Property）</strong>
在单元边界上，形函数保持 <span class="math inline">\(C^0\)</span> 连续性，即函数值连续但导数可能不连续。</p>
</div>
<div id="一维形函数的详细构造" class="section level4 hasAnchor" number="4.1.5.2">
<h4><span class="header-section-number">4.1.5.2</span> 一维形函数的详细构造<a href="ch4_fem.html#一维形函数的详细构造" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>线性形函数（Linear Shape Functions）</strong></p>
<p>对于标准单元 <span class="math inline">\(\xi \in [-1, 1]\)</span>：
<span class="math display">\[N_1(\xi) = \frac{1-\xi}{2}, \quad N_2(\xi) = \frac{1+\xi}{2}\]</span></p>
<p>其导数为：
<span class="math display">\[\frac{dN_1}{d\xi} = -\frac{1}{2}, \quad \frac{dN_2}{d\xi} = \frac{1}{2}\]</span></p>
<p><strong>二次形函数（Quadratic Shape Functions）</strong></p>
<p>对于三节点单元，节点位于 <span class="math inline">\(\xi = -1, 0, 1\)</span>：
<span class="math display">\[N_1(\xi) = \frac{\xi(\xi-1)}{2}, \quad N_2(\xi) = 1-\xi^2, \quad N_3(\xi) = \frac{\xi(\xi+1)}{2}\]</span></p>
<p>其导数为：
<span class="math display">\[\frac{dN_1}{d\xi} = \xi - \frac{1}{2}, \quad \frac{dN_2}{d\xi} = -2\xi, \quad \frac{dN_3}{d\xi} = \xi + \frac{1}{2}\]</span></p>
<p><strong>三次形函数（Cubic Shape Functions）</strong></p>
<p>对于四节点单元，可以使用Hermite插值：
<span class="math display">\[N_1(\xi) = \frac{1}{16}(1-\xi)^2(2+\xi)\]</span>
<span class="math display">\[N_2(\xi) = \frac{1}{16}(1-\xi)^2(1+\xi)\]</span>
<span class="math display">\[N_3(\xi) = \frac{1}{16}(1+\xi)^2(2-\xi)\]</span>
<span class="math display">\[N_4(\xi) = \frac{1}{16}(1+\xi)^2(1-\xi)\]</span></p>
</div>
<div id="lagrange插值基础" class="section level4 hasAnchor" number="4.1.5.3">
<h4><span class="header-section-number">4.1.5.3</span> Lagrange插值基础<a href="ch4_fem.html#lagrange插值基础" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>形函数的构造通常基于Lagrange插值理论。对于 <span class="math inline">\(n+1\)</span> 个节点 <span class="math inline">\(\xi_0, \xi_1, \ldots, \xi_n\)</span>，Lagrange插值多项式为：</p>
<p><span class="math display">\[L_i(\xi) = \prod_{j=0, j \neq i}^{n} \frac{\xi - \xi_j}{\xi_i - \xi_j}\]</span></p>
<p>这自然满足插值性质：<span class="math inline">\(L_i(\xi_j) = \delta_{ij}\)</span>。</p>
</div>
<div id="等参变换理论" class="section level4 hasAnchor" number="4.1.5.4">
<h4><span class="header-section-number">4.1.5.4</span> 等参变换理论<a href="ch4_fem.html#等参变换理论" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>坐标变换</strong></p>
<p>从物理坐标 <span class="math inline">\(x\)</span> 到参考坐标 <span class="math inline">\(\xi\)</span> 的变换：
<span class="math display">\[x = \sum_{i=1}^{n} x_i N_i(\xi)\]</span></p>
<p>其中 <span class="math inline">\(x_i\)</span> 是节点的物理坐标。</p>
<p><strong>雅可比矩阵</strong></p>
<p>变换的雅可比矩阵为：
<span class="math display">\[J = \frac{dx}{d\xi} = \sum_{i=1}^{n} x_i \frac{dN_i}{d\xi}\]</span></p>
<p>对于一维情况，雅可比行列式 <span class="math inline">\(|J| = J\)</span>。</p>
<p><strong>导数变换</strong></p>
<p>物理空间中的导数通过链式法则计算：
<span class="math display">\[\frac{dN_i}{dx} = \frac{dN_i}{d\xi} \frac{d\xi}{dx} = \frac{1}{J} \frac{dN_i}{d\xi}\]</span></p>
</div>
<div id="二维形函数" class="section level4 hasAnchor" number="4.1.5.5">
<h4><span class="header-section-number">4.1.5.5</span> 二维形函数<a href="ch4_fem.html#二维形函数" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>三角形单元</strong></p>
<p>对于三角形单元，使用面积坐标（重心坐标）<span class="math inline">\(L_1, L_2, L_3\)</span>：
<span class="math display">\[N_1 = L_1, \quad N_2 = L_2, \quad N_3 = L_3\]</span></p>
<p>其中 <span class="math inline">\(L_1 + L_2 + L_3 = 1\)</span>。</p>
<p><strong>四边形单元</strong></p>
<p>对于双线性四边形单元：
<span class="math display">\[N_1(\xi, \eta) = \frac{(1-\xi)(1-\eta)}{4}\]</span>
<span class="math display">\[N_2(\xi, \eta) = \frac{(1+\xi)(1-\eta)}{4}\]</span>
<span class="math display">\[N_3(\xi, \eta) = \frac{(1+\xi)(1+\eta)}{4}\]</span>
<span class="math display">\[N_4(\xi, \eta) = \frac{(1-\xi)(1+\eta)}{4}\]</span></p>
</div>
<div id="形函数的数值积分" class="section level4 hasAnchor" number="4.1.5.6">
<h4><span class="header-section-number">4.1.5.6</span> 形函数的数值积分<a href="ch4_fem.html#形函数的数值积分" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>形函数涉及的积分通常通过高斯积分法计算：</p>
<p><strong>一维高斯积分</strong>
<span class="math display">\[\int_{-1}^{1} f(\xi) d\xi \approx \sum_{i=1}^{n} w_i f(\xi_i)\]</span></p>
<p>其中 <span class="math inline">\(w_i\)</span> 是权重，<span class="math inline">\(\xi_i\)</span> 是积分点。</p>
<p><strong>常用高斯积分点</strong></p>
<ul>
<li>1点积分：<span class="math inline">\(\xi_1 = 0\)</span>, <span class="math inline">\(w_1 = 2\)</span></li>
<li>2点积分：<span class="math inline">\(\xi_{1,2} = \pm\frac{1}{\sqrt{3}}\)</span>, <span class="math inline">\(w_{1,2} = 1\)</span></li>
<li>3点积分：<span class="math inline">\(\xi_1 = 0, \xi_{2,3} = \pm\sqrt{\frac{3}{5}}\)</span>, <span class="math inline">\(w_1 = \frac{8}{9}, w_{2,3} = \frac{5}{9}\)</span></li>
</ul>
</div>
<div id="形函数的误差分析" class="section level4 hasAnchor" number="4.1.5.7">
<h4><span class="header-section-number">4.1.5.7</span> 形函数的误差分析<a href="ch4_fem.html#形函数的误差分析" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>形函数的插值误差可以通过Taylor展开分析。对于 <span class="math inline">\(p\)</span> 阶多项式形函数，插值误差为：</p>
<p><span class="math display">\[|u - u^h| \leq C h^{p+1} \left\|\frac{d^{p+1}u}{dx^{p+1}}\right\|_{L^2(\Omega_e)}\]</span></p>
<p>其中 <span class="math inline">\(h\)</span> 是单元尺寸，<span class="math inline">\(C\)</span> 是与形函数相关的常数。</p>
</div>
<div id="特殊形函数" class="section level4 hasAnchor" number="4.1.5.8">
<h4><span class="header-section-number">4.1.5.8</span> 特殊形函数<a href="ch4_fem.html#特殊形函数" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>分层形函数（Hierarchical Shape Functions）</strong></p>
<p>分层形函数便于实现 <span class="math inline">\(p\)</span> 型自适应：
<span class="math display">\[N_i^{(p)} = N_i^{(p-1)} + \alpha_i \phi_p(\xi)\]</span></p>
<p>其中 <span class="math inline">\(\phi_p\)</span> 是 <span class="math inline">\(p\)</span> 阶正交多项式。</p>
<p><strong>泡函数（Bubble Functions）</strong></p>
<p>泡函数在单元内部非零，在边界上为零：
<span class="math display">\[N_b(\xi) = (1-\xi^2)^p\]</span></p>
<p>泡函数常用于稳定化方法和混合有限元法。</p>
</div>
</div>
</div>
<div id="数学公式论证" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> 数学公式论证<a href="ch4_fem.html#数学公式论证" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="变分形式的推导" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> 变分形式的推导<a href="ch4_fem.html#变分形式的推导" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>考虑一维热传导方程：</p>
<p><span class="math display">\[\frac{\partial u}{\partial t} = \alpha \frac{\partial^2 u}{\partial x^2} \quad \text{in} \quad (0,L) \times (0,T)\]</span></p>
<p>其中 <span class="math inline">\(u(x,t)\)</span> 是温度，<span class="math inline">\(\alpha\)</span> 是热扩散系数，<span class="math inline">\(L\)</span> 是杆长，<span class="math inline">\(T\)</span> 是总时间。</p>
<p>边界条件：
<span class="math display">\[u(0,t) = u_0, \quad u(L,t) = u_L\]</span></p>
<p>初始条件：
<span class="math display">\[u(x,0) = u_{ic}(x)\]</span></p>
<p>将方程乘以测试函数 <span class="math inline">\(v(x)\)</span> 并在空间域上积分：</p>
<p><span class="math display">\[\int_0^L v(x) \frac{\partial u}{\partial t} dx = \alpha \int_0^L v(x) \frac{\partial^2 u}{\partial x^2} dx\]</span></p>
<p>对右边进行分部积分：</p>
<p><span class="math display">\[\int_0^L v(x) \frac{\partial u}{\partial t} dx = -\alpha \int_0^L \frac{\partial v}{\partial x} \frac{\partial u}{\partial x} dx + \alpha \left[v(x) \frac{\partial u}{\partial x}\right]_0^L\]</span></p>
<p>由于边界条件已知，边界项可以处理，得到弱形式：</p>
<p><span class="math display">\[\int_0^L v(x) \frac{\partial u}{\partial t} dx + \alpha \int_0^L \frac{\partial v}{\partial x} \frac{\partial u}{\partial x} dx = 0\]</span></p>
</div>
<div id="有限元离散化" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> 有限元离散化<a href="ch4_fem.html#有限元离散化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>将空间域 <span class="math inline">\([0,L]\)</span> 划分为 <span class="math inline">\(n\)</span> 个单元，每个单元长度为 <span class="math inline">\(h = L/n\)</span>。在每个单元 <span class="math inline">\([x_i, x_{i+1}]\)</span> 上，使用线性形函数：</p>
<p><span class="math display">\[u^h(x) = \sum_{j=1}^{n+1} u_j N_j(x)\]</span></p>
<p>其中 <span class="math inline">\(u_j\)</span> 是节点 <span class="math inline">\(j\)</span> 处的温度值，<span class="math inline">\(N_j(x)\)</span> 是节点 <span class="math inline">\(j\)</span> 的形函数。</p>
<p>将弱形式离散化，得到：</p>
<p><span class="math display">\[\sum_{i=1}^n \int_{x_i}^{x_{i+1}} N_j(x) \frac{\partial u^h}{\partial t} dx + \alpha \sum_{i=1}^n \int_{x_i}^{x_{i+1}} \frac{\partial N_j}{\partial x} \frac{\partial u^h}{\partial x} dx = 0\]</span></p>
<p>这可以写成矩阵形式：</p>
<p><span class="math display">\[M \frac{d\mathbf{u}}{dt} + K\mathbf{u} = \mathbf{0}\]</span></p>
<p>其中 <span class="math inline">\(M\)</span> 是质量矩阵，<span class="math inline">\(K\)</span> 是刚度矩阵，<span class="math inline">\(\mathbf{u}\)</span> 是节点温度向量。</p>
</div>
<div id="单元矩阵的构造" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> 单元矩阵的构造<a href="ch4_fem.html#单元矩阵的构造" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>对于线性单元，质量矩阵和刚度矩阵的元素为：</p>
<p><span class="math display">\[M_{ij} = \int_{x_i}^{x_{i+1}} N_i(x) N_j(x) dx\]</span></p>
<p><span class="math display">\[K_{ij} = \alpha \int_{x_i}^{x_{i+1}} \frac{\partial N_i}{\partial x} \frac{\partial N_j}{\partial x} dx\]</span></p>
<p>对于均匀网格，这些积分可以解析计算：</p>
<p><span class="math display">\[M = \frac{h}{6} \begin{bmatrix} 2 &amp; 1 \\ 1 &amp; 2 \end{bmatrix}\]</span></p>
<p><span class="math display">\[K = \frac{\alpha}{h} \begin{bmatrix} 1 &amp; -1 \\ -1 &amp; 1 \end{bmatrix}\]</span></p>
</div>
</div>
<div id="一维热传导问题的深入分析与fem求解" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> 一维热传导问题的深入分析与FEM求解<a href="ch4_fem.html#一维热传导问题的深入分析与fem求解" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="工程背景与实际意义" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> 工程背景与实际意义<a href="ch4_fem.html#工程背景与实际意义" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>热传导问题在地球科学和工程实践中具有重要意义。本节以铁棍热传导为例，展示有限元法在解决实际工程问题中的应用。这类问题在以下领域具有广泛应用：</p>
<p><strong>地球科学应用</strong>：
- <strong>地热能开发</strong>：地下岩层的热传导分析
- <strong>冻土工程</strong>：永久冻土层的热力学行为
- <strong>地质勘探</strong>：地下温度场分布预测
- <strong>环境工程</strong>：土壤污染热修复技术</p>
<p><strong>工程应用</strong>：
- <strong>建筑节能</strong>：墙体保温材料设计
- <strong>电子散热</strong>：芯片热管理系统
- <strong>材料加工</strong>：金属热处理工艺
- <strong>核工程</strong>：反应堆热传递分析</p>
</div>
<div id="详细问题描述" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 详细问题描述<a href="ch4_fem.html#详细问题描述" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>考虑一根长度为 <span class="math inline">\(L = 1.0\)</span> m 的均匀铁棍，其物理参数如下：</p>
<p><strong>材料参数</strong>：
- 热传导系数：<span class="math inline">\(k = 50\)</span> W/(m·K)
- 密度：<span class="math inline">\(\rho = 7850\)</span> kg/m³
- 比热容：<span class="math inline">\(c = 460\)</span> J/(kg·K)
- 热扩散系数：<span class="math inline">\(\alpha = \frac{k}{\rho c} = 1.384 \times 10^{-5}\)</span> m²/s</p>
<p><strong>几何参数</strong>：
- 长度：<span class="math inline">\(L = 1.0\)</span> m
- 横截面积：<span class="math inline">\(A = 1.0\)</span> cm²（假设为细棍，忽略横向传热）</p>
<p><strong>边界条件</strong>：
- 左端（<span class="math inline">\(x = 0\)</span>）：恒温 <span class="math inline">\(u(0,t) = 100°C\)</span>
- 右端（<span class="math inline">\(x = L\)</span>）：恒温 <span class="math inline">\(u(L,t) = 50°C\)</span></p>
<p><strong>初始条件</strong>：
- 初始温度：<span class="math inline">\(u(x,0) = 25°C\)</span>（室温）</p>
</div>
<div id="clams方法的系统化建模" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> CLAMS方法的系统化建模<a href="ch4_fem.html#clams方法的系统化建模" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CLAMS方法为复杂物理问题提供了系统化的建模框架，确保建模过程的完整性和科学性。</p>
<div id="概念描述-conceptual-model" class="section level4 hasAnchor" number="4.3.3.1">
<h4><span class="header-section-number">4.3.3.1</span> 1. 概念描述 (Conceptual Model)<a href="ch4_fem.html#概念描述-conceptual-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>物理系统描述</strong>：
一维热传导系统，包含以下关键要素：
- <strong>系统边界</strong>：铁棍的几何边界
- <strong>控制体积</strong>：整个铁棍内部
- <strong>热源/热汇</strong>：两端的恒温边界条件
- <strong>传热机制</strong>：纯导热（忽略对流和辐射）</p>
<p><strong>简化假设的物理合理性</strong>：
1. <strong>一维假设</strong>：当铁棍的长度远大于其直径时，横向温度梯度可忽略
2. <strong>均匀材料</strong>：工业铁棍在宏观尺度上可视为均匀介质
3. <strong>恒定物性</strong>：在给定温度范围内，铁的热物性变化较小</p>
</div>
<div id="物理定律-laws-of-physics" class="section level4 hasAnchor" number="4.3.3.2">
<h4><span class="header-section-number">4.3.3.2</span> 2. 物理定律 (Laws of Physics)<a href="ch4_fem.html#物理定律-laws-of-physics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>傅里叶热传导定律</strong>：
<span class="math display">\[\mathbf{q} = -k \nabla u\]</span></p>
<p>对于一维情况：
<span class="math display">\[q_x = -k \frac{\partial u}{\partial x}\]</span></p>
<p>其中 <span class="math inline">\(q_x\)</span> 是单位面积的热流密度（W/m²）。</p>
<p><strong>能量守恒定律</strong>：
基于控制体积的能量平衡：
<span class="math display">\[\frac{\partial}{\partial t}(\rho c u) + \nabla \cdot \mathbf{q} = S\]</span></p>
<p>其中 <span class="math inline">\(S\)</span> 是内热源项。对于无内热源的一维情况：
<span class="math display">\[\rho c \frac{\partial u}{\partial t} + \frac{\partial q_x}{\partial x} = 0\]</span></p>
<p><strong>热力学第二定律</strong>：
热量自发地从高温区域传向低温区域，这确保了问题解的物理合理性。</p>
</div>
<div id="假设条件-assumptions" class="section level4 hasAnchor" number="4.3.3.3">
<h4><span class="header-section-number">4.3.3.3</span> 3. 假设条件 (Assumptions)<a href="ch4_fem.html#假设条件-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>几何假设</strong>：
1. <strong>一维传热</strong>：<span class="math inline">\(\frac{\partial u}{\partial y} = \frac{\partial u}{\partial z} = 0\)</span>
2. <strong>直杆假设</strong>：忽略几何形状对传热的影响
3. <strong>边界绝热</strong>：侧表面无热交换</p>
<p><strong>物理假设</strong>：
4. <strong>恒定物性</strong>：<span class="math inline">\(k\)</span>、<span class="math inline">\(\rho\)</span>、<span class="math inline">\(c\)</span> 为常数
5. <strong>无内热源</strong>：<span class="math inline">\(S = 0\)</span>
6. <strong>线性传热</strong>：忽略非线性效应（如温度相关的物性）</p>
<p><strong>数值假设</strong>：
7. <strong>连续介质</strong>：忽略分子尺度的不连续性
8. <strong>准静态过程</strong>：忽略惯性效应</p>
<p><strong>假设的有效性分析</strong>：
- 对于长径比 &gt; 10 的铁棍，一维假设误差 &lt; 5%
- 在0-200°C温度范围内，铁的热物性变化 &lt; 10%
- 忽略对流和辐射在低温差情况下是合理的</p>
</div>
<div id="数学推导-mathematical-derivation" class="section level4 hasAnchor" number="4.3.3.4">
<h4><span class="header-section-number">4.3.3.4</span> 4. 数学推导 (Mathematical Derivation)<a href="ch4_fem.html#数学推导-mathematical-derivation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>控制方程的推导</strong>：</p>
<p>将傅里叶定律代入能量守恒方程：
<span class="math display">\[\rho c \frac{\partial u}{\partial t} - \frac{\partial}{\partial x}\left(k \frac{\partial u}{\partial x}\right) = 0\]</span></p>
<p>对于恒定物性：
<span class="math display">\[\frac{\partial u}{\partial t} = \alpha \frac{\partial^2 u}{\partial x^2}\]</span></p>
<p>其中热扩散系数 <span class="math inline">\(\alpha = \frac{k}{\rho c}\)</span> 具有量纲 [m²/s]。</p>
<p><strong>边界条件的数学表达</strong>：
- <strong>第一类边界条件（Dirichlet）</strong>：
<span class="math display">\[u(0,t) = u_0 = 100°C\]</span>
<span class="math display">\[u(L,t) = u_L = 50°C\]</span></p>
<p><strong>初始条件</strong>：
<span class="math display">\[u(x,0) = u_{ic}(x) = 25°C\]</span></p>
<p><strong>无量纲化处理</strong>：
为了便于数值计算和参数分析，引入无量纲变量：
- 无量纲坐标：<span class="math inline">\(\xi = \frac{x}{L}\)</span>
- 无量纲温度：<span class="math inline">\(\theta = \frac{u - u_L}{u_0 - u_L}\)</span>
- 无量纲时间：<span class="math inline">\(\tau = \frac{\alpha t}{L^2}\)</span></p>
<p>无量纲控制方程：
<span class="math display">\[\frac{\partial \theta}{\partial \tau} = \frac{\partial^2 \theta}{\partial \xi^2}\]</span></p>
<p>边界条件：<span class="math inline">\(\theta(0,\tau) = 1\)</span>，<span class="math inline">\(\theta(1,\tau) = 0\)</span>
初始条件：<span class="math inline">\(\theta(\xi,0) = \frac{25-50}{100-50} = -0.5\)</span></p>
</div>
<div id="求解策略-solver-strategy" class="section level4 hasAnchor" number="4.3.3.5">
<h4><span class="header-section-number">4.3.3.5</span> 5. 求解策略 (Solver Strategy)<a href="ch4_fem.html#求解策略-solver-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>有限元离散化策略</strong>：</p>
<ol style="list-style-type: decimal">
<li><strong>空间离散化</strong>：
<ul>
<li>单元类型：一维线性单元</li>
<li>网格密度：根据Peclet数确定</li>
<li>单元数量：<span class="math inline">\(N_e = 20\)</span>（经收敛性分析确定）</li>
</ul></li>
<li><strong>时间离散化</strong>：
<ul>
<li>时间积分格式：隐式Euler法（确保无条件稳定）</li>
<li>时间步长：<span class="math inline">\(\Delta t = 100\)</span> s（满足精度要求）</li>
<li>总时间：<span class="math inline">\(T = 10000\)</span> s（达到稳态）</li>
</ul></li>
<li><strong>线性方程组求解</strong>：
<ul>
<li>矩阵类型：对称正定稀疏矩阵</li>
<li>求解方法：直接法（LU分解）</li>
<li>边界条件处理：罚方法或消元法</li>
</ul></li>
</ol>
<p><strong>数值稳定性分析</strong>：
- CFL条件：隐式格式无条件稳定
- 质量矩阵：确保质量守恒
- 能量守恒：验证总能量平衡</p>
<p><strong>收敛性检验</strong>：
- 网格收敛性：比较不同网格密度的结果
- 时间步长收敛性：验证时间积分精度
- 解析解对比：在特殊情况下与解析解比较</p>
</div>
</div>
<div id="r代码实现" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> R代码实现<a href="ch4_fem.html#r代码实现" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下代码展示了有限元法求解一维热传导问题的完整实现：</p>
</div>
<div id="完整实现代码" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> 完整实现代码<a href="ch4_fem.html#完整实现代码" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="ch4_fem.html#cb29-1" tabindex="-1"></a><span class="co"># 有限元法求解一维热传导问题</span></span>
<span id="cb29-2"><a href="ch4_fem.html#cb29-2" tabindex="-1"></a><span class="co"># 作者：数值地球教科书项目</span></span>
<span id="cb29-3"><a href="ch4_fem.html#cb29-3" tabindex="-1"></a><span class="co"># 日期：2025年</span></span>
<span id="cb29-4"><a href="ch4_fem.html#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="ch4_fem.html#cb29-5" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb29-6"><a href="ch4_fem.html#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="ch4_fem.html#cb29-7" tabindex="-1"></a><span class="co"># 加载字体配置</span></span>
<span id="cb29-8"><a href="ch4_fem.html#cb29-8" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Functions/font_setup.R&quot;</span>)</span>
<span id="cb29-9"><a href="ch4_fem.html#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="ch4_fem.html#cb29-10" tabindex="-1"></a><span class="co"># 设置中文字体（在绘图前）</span></span>
<span id="cb29-11"><a href="ch4_fem.html#cb29-11" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb29-12"><a href="ch4_fem.html#cb29-12" tabindex="-1"></a>  <span class="fu">setup_bookdown_fonts</span>()</span>
<span id="cb29-13"><a href="ch4_fem.html#cb29-13" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb29-14"><a href="ch4_fem.html#cb29-14" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;字体设置失败，使用默认字体：&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb29-15"><a href="ch4_fem.html#cb29-15" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## 字体设置完成： Arial Unicode MS</code></pre>
<pre><code>## [1] &quot;Arial Unicode MS&quot;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="ch4_fem.html#cb32-1" tabindex="-1"></a><span class="co"># 参数设置</span></span>
<span id="cb32-2"><a href="ch4_fem.html#cb32-2" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fl">1.0</span>          <span class="co"># 杆长 (m)</span></span>
<span id="cb32-3"><a href="ch4_fem.html#cb32-3" tabindex="-1"></a>n_elements <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># 单元数量</span></span>
<span id="cb32-4"><a href="ch4_fem.html#cb32-4" tabindex="-1"></a>n_nodes <span class="ot">&lt;-</span> n_elements <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># 节点数量</span></span>
<span id="cb32-5"><a href="ch4_fem.html#cb32-5" tabindex="-1"></a>h <span class="ot">&lt;-</span> L <span class="sc">/</span> n_elements        <span class="co"># 单元长度</span></span>
<span id="cb32-6"><a href="ch4_fem.html#cb32-6" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">1e-4</span>              <span class="co"># 热扩散系数 (m²/s)</span></span>
<span id="cb32-7"><a href="ch4_fem.html#cb32-7" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">100</span>                  <span class="co"># 时间步长 (s)</span></span>
<span id="cb32-8"><a href="ch4_fem.html#cb32-8" tabindex="-1"></a>T_max <span class="ot">&lt;-</span> <span class="dv">10000</span>             <span class="co"># 总时间 (s)</span></span>
<span id="cb32-9"><a href="ch4_fem.html#cb32-9" tabindex="-1"></a>n_steps <span class="ot">&lt;-</span> T_max <span class="sc">/</span> dt      <span class="co"># 时间步数</span></span>
<span id="cb32-10"><a href="ch4_fem.html#cb32-10" tabindex="-1"></a></span>
<span id="cb32-11"><a href="ch4_fem.html#cb32-11" tabindex="-1"></a><span class="co"># 初始条件</span></span>
<span id="cb32-12"><a href="ch4_fem.html#cb32-12" tabindex="-1"></a>u_ic <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">25</span>, n_nodes)  <span class="co"># 初始温度 (°C)</span></span>
<span id="cb32-13"><a href="ch4_fem.html#cb32-13" tabindex="-1"></a>u_0 <span class="ot">&lt;-</span> <span class="dv">100</span>                 <span class="co"># 左端温度 (°C)</span></span>
<span id="cb32-14"><a href="ch4_fem.html#cb32-14" tabindex="-1"></a>u_L <span class="ot">&lt;-</span> <span class="dv">50</span>                  <span class="co"># 右端温度 (°C)</span></span>
<span id="cb32-15"><a href="ch4_fem.html#cb32-15" tabindex="-1"></a></span>
<span id="cb32-16"><a href="ch4_fem.html#cb32-16" tabindex="-1"></a><span class="co"># 构造质量矩阵和刚度矩阵</span></span>
<span id="cb32-17"><a href="ch4_fem.html#cb32-17" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-18"><a href="ch4_fem.html#cb32-18" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-19"><a href="ch4_fem.html#cb32-19" tabindex="-1"></a></span>
<span id="cb32-20"><a href="ch4_fem.html#cb32-20" tabindex="-1"></a><span class="co"># 组装全局矩阵</span></span>
<span id="cb32-21"><a href="ch4_fem.html#cb32-21" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_elements) {</span>
<span id="cb32-22"><a href="ch4_fem.html#cb32-22" tabindex="-1"></a>  <span class="co"># 局部节点编号</span></span>
<span id="cb32-23"><a href="ch4_fem.html#cb32-23" tabindex="-1"></a>  local_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(i, i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb32-24"><a href="ch4_fem.html#cb32-24" tabindex="-1"></a>  </span>
<span id="cb32-25"><a href="ch4_fem.html#cb32-25" tabindex="-1"></a>  <span class="co"># 局部质量矩阵</span></span>
<span id="cb32-26"><a href="ch4_fem.html#cb32-26" tabindex="-1"></a>  M_local <span class="ot">&lt;-</span> h<span class="sc">/</span><span class="dv">6</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb32-27"><a href="ch4_fem.html#cb32-27" tabindex="-1"></a>  <span class="co"># 局部刚度矩阵</span></span>
<span id="cb32-28"><a href="ch4_fem.html#cb32-28" tabindex="-1"></a>  K_local <span class="ot">&lt;-</span> alpha<span class="sc">/</span>h <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb32-29"><a href="ch4_fem.html#cb32-29" tabindex="-1"></a>  </span>
<span id="cb32-30"><a href="ch4_fem.html#cb32-30" tabindex="-1"></a>  <span class="co"># 组装到全局矩阵</span></span>
<span id="cb32-31"><a href="ch4_fem.html#cb32-31" tabindex="-1"></a>  M[local_nodes, local_nodes] <span class="ot">&lt;-</span> M[local_nodes, local_nodes] <span class="sc">+</span> M_local</span>
<span id="cb32-32"><a href="ch4_fem.html#cb32-32" tabindex="-1"></a>  K[local_nodes, local_nodes] <span class="ot">&lt;-</span> K[local_nodes, local_nodes] <span class="sc">+</span> K_local</span>
<span id="cb32-33"><a href="ch4_fem.html#cb32-33" tabindex="-1"></a>}</span>
<span id="cb32-34"><a href="ch4_fem.html#cb32-34" tabindex="-1"></a></span>
<span id="cb32-35"><a href="ch4_fem.html#cb32-35" tabindex="-1"></a><span class="co"># 时间推进（隐式欧拉法）</span></span>
<span id="cb32-36"><a href="ch4_fem.html#cb32-36" tabindex="-1"></a>u_current <span class="ot">&lt;-</span> u_ic</span>
<span id="cb32-37"><a href="ch4_fem.html#cb32-37" tabindex="-1"></a>u_history <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_nodes, n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb32-38"><a href="ch4_fem.html#cb32-38" tabindex="-1"></a>u_history[, <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb32-39"><a href="ch4_fem.html#cb32-39" tabindex="-1"></a></span>
<span id="cb32-40"><a href="ch4_fem.html#cb32-40" tabindex="-1"></a><span class="co"># 构造线性方程组系数矩阵</span></span>
<span id="cb32-41"><a href="ch4_fem.html#cb32-41" tabindex="-1"></a>A <span class="ot">&lt;-</span> M <span class="sc">+</span> dt <span class="sc">*</span> K</span>
<span id="cb32-42"><a href="ch4_fem.html#cb32-42" tabindex="-1"></a>b <span class="ot">&lt;-</span> M <span class="sc">%*%</span> u_current</span>
<span id="cb32-43"><a href="ch4_fem.html#cb32-43" tabindex="-1"></a></span>
<span id="cb32-44"><a href="ch4_fem.html#cb32-44" tabindex="-1"></a><span class="co"># 施加边界条件</span></span>
<span id="cb32-45"><a href="ch4_fem.html#cb32-45" tabindex="-1"></a>A[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-46"><a href="ch4_fem.html#cb32-46" tabindex="-1"></a>A[n_nodes, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[n_nodes, n_nodes] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-47"><a href="ch4_fem.html#cb32-47" tabindex="-1"></a></span>
<span id="cb32-48"><a href="ch4_fem.html#cb32-48" tabindex="-1"></a><span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb32-49"><a href="ch4_fem.html#cb32-49" tabindex="-1"></a>  <span class="co"># 更新右端项</span></span>
<span id="cb32-50"><a href="ch4_fem.html#cb32-50" tabindex="-1"></a>  b <span class="ot">&lt;-</span> M <span class="sc">%*%</span> u_current</span>
<span id="cb32-51"><a href="ch4_fem.html#cb32-51" tabindex="-1"></a>  </span>
<span id="cb32-52"><a href="ch4_fem.html#cb32-52" tabindex="-1"></a>  <span class="co"># 施加边界条件</span></span>
<span id="cb32-53"><a href="ch4_fem.html#cb32-53" tabindex="-1"></a>  b[<span class="dv">1</span>] <span class="ot">&lt;-</span> u_0</span>
<span id="cb32-54"><a href="ch4_fem.html#cb32-54" tabindex="-1"></a>  b[n_nodes] <span class="ot">&lt;-</span> u_L</span>
<span id="cb32-55"><a href="ch4_fem.html#cb32-55" tabindex="-1"></a>  </span>
<span id="cb32-56"><a href="ch4_fem.html#cb32-56" tabindex="-1"></a>  <span class="co"># 求解线性方程组</span></span>
<span id="cb32-57"><a href="ch4_fem.html#cb32-57" tabindex="-1"></a>  u_new <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, b)</span>
<span id="cb32-58"><a href="ch4_fem.html#cb32-58" tabindex="-1"></a>  </span>
<span id="cb32-59"><a href="ch4_fem.html#cb32-59" tabindex="-1"></a>  <span class="co"># 更新解</span></span>
<span id="cb32-60"><a href="ch4_fem.html#cb32-60" tabindex="-1"></a>  u_current <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(u_new)</span>
<span id="cb32-61"><a href="ch4_fem.html#cb32-61" tabindex="-1"></a>  u_history[, step <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb32-62"><a href="ch4_fem.html#cb32-62" tabindex="-1"></a>}</span>
<span id="cb32-63"><a href="ch4_fem.html#cb32-63" tabindex="-1"></a></span>
<span id="cb32-64"><a href="ch4_fem.html#cb32-64" tabindex="-1"></a><span class="co"># 结果可视化</span></span>
<span id="cb32-65"><a href="ch4_fem.html#cb32-65" tabindex="-1"></a>x_coords <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, L, <span class="at">length.out =</span> n_nodes)</span>
<span id="cb32-66"><a href="ch4_fem.html#cb32-66" tabindex="-1"></a>time_coords <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, T_max, <span class="at">by =</span> dt)</span>
<span id="cb32-67"><a href="ch4_fem.html#cb32-67" tabindex="-1"></a></span>
<span id="cb32-68"><a href="ch4_fem.html#cb32-68" tabindex="-1"></a><span class="co"># 绘制不同时刻的温度分布</span></span>
<span id="cb32-69"><a href="ch4_fem.html#cb32-69" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb32-70"><a href="ch4_fem.html#cb32-70" tabindex="-1"></a></span>
<span id="cb32-71"><a href="ch4_fem.html#cb32-71" tabindex="-1"></a><span class="co"># 选择要显示的时刻</span></span>
<span id="cb32-72"><a href="ch4_fem.html#cb32-72" tabindex="-1"></a>time_indices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">round</span>(n_steps<span class="sc">/</span><span class="dv">16</span>), <span class="fu">round</span>(n_steps<span class="sc">/</span><span class="dv">8</span>), n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb32-73"><a href="ch4_fem.html#cb32-73" tabindex="-1"></a>time_labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&#39;Time =&#39;</span>, time_indices, <span class="st">&#39;s&#39;</span>)</span>
<span id="cb32-74"><a href="ch4_fem.html#cb32-74" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb32-75"><a href="ch4_fem.html#cb32-75" tabindex="-1"></a></span>
<span id="cb32-76"><a href="ch4_fem.html#cb32-76" tabindex="-1"></a><span class="co"># 绘制第一条曲线（初始时刻）</span></span>
<span id="cb32-77"><a href="ch4_fem.html#cb32-77" tabindex="-1"></a><span class="fu">plot</span>(x_coords, u_history[, time_indices[<span class="dv">1</span>]], <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, </span>
<span id="cb32-78"><a href="ch4_fem.html#cb32-78" tabindex="-1"></a>     <span class="at">col =</span> colors[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb32-79"><a href="ch4_fem.html#cb32-79" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;位置 (m)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;温度 (°C)&#39;</span>, </span>
<span id="cb32-80"><a href="ch4_fem.html#cb32-80" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;不同时刻的温度分布&#39;</span>)</span>
<span id="cb32-81"><a href="ch4_fem.html#cb32-81" tabindex="-1"></a></span>
<span id="cb32-82"><a href="ch4_fem.html#cb32-82" tabindex="-1"></a><span class="co"># 添加其他时刻的曲线</span></span>
<span id="cb32-83"><a href="ch4_fem.html#cb32-83" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(time_indices)) {</span>
<span id="cb32-84"><a href="ch4_fem.html#cb32-84" tabindex="-1"></a>  <span class="fu">lines</span>(x_coords, u_history[, time_indices[i]], </span>
<span id="cb32-85"><a href="ch4_fem.html#cb32-85" tabindex="-1"></a>        <span class="at">col =</span> colors[i], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb32-86"><a href="ch4_fem.html#cb32-86" tabindex="-1"></a>}</span>
<span id="cb32-87"><a href="ch4_fem.html#cb32-87" tabindex="-1"></a></span>
<span id="cb32-88"><a href="ch4_fem.html#cb32-88" tabindex="-1"></a><span class="co"># 添加图例</span></span>
<span id="cb32-89"><a href="ch4_fem.html#cb32-89" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> time_labels, </span>
<span id="cb32-90"><a href="ch4_fem.html#cb32-90" tabindex="-1"></a>       <span class="at">col =</span> colors, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb32-91"><a href="ch4_fem.html#cb32-91" tabindex="-1"></a></span>
<span id="cb32-92"><a href="ch4_fem.html#cb32-92" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="_bookdown_files/04-FEM_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="ch4_fem.html#cb33-1" tabindex="-1"></a><span class="co"># 绘制温度随时间变化图（选择几个关键位置）</span></span>
<span id="cb33-2"><a href="ch4_fem.html#cb33-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb33-3"><a href="ch4_fem.html#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="ch4_fem.html#cb33-4" tabindex="-1"></a><span class="co"># 选择要显示的位置</span></span>
<span id="cb33-5"><a href="ch4_fem.html#cb33-5" tabindex="-1"></a>position_indices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">round</span>(n_nodes<span class="sc">/</span><span class="dv">4</span>), <span class="fu">round</span>(n_nodes<span class="sc">/</span><span class="dv">2</span>), <span class="fu">round</span>(<span class="dv">3</span><span class="sc">*</span>n_nodes<span class="sc">/</span><span class="dv">4</span>), n_nodes)</span>
<span id="cb33-6"><a href="ch4_fem.html#cb33-6" tabindex="-1"></a>position_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;左端&quot;</span>, <span class="st">&quot;1/4处&quot;</span>, <span class="st">&quot;中点&quot;</span>, <span class="st">&quot;3/4处&quot;</span>, <span class="st">&quot;右端&quot;</span>)</span>
<span id="cb33-7"><a href="ch4_fem.html#cb33-7" tabindex="-1"></a>colors_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb33-8"><a href="ch4_fem.html#cb33-8" tabindex="-1"></a></span>
<span id="cb33-9"><a href="ch4_fem.html#cb33-9" tabindex="-1"></a><span class="co"># 绘制第一条曲线（左端）</span></span>
<span id="cb33-10"><a href="ch4_fem.html#cb33-10" tabindex="-1"></a><span class="fu">plot</span>(time_coords, u_history[position_indices[<span class="dv">1</span>], ], <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, </span>
<span id="cb33-11"><a href="ch4_fem.html#cb33-11" tabindex="-1"></a>     <span class="at">col =</span> colors_time[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb33-12"><a href="ch4_fem.html#cb33-12" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;时间 (s)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;温度 (°C)&#39;</span>, </span>
<span id="cb33-13"><a href="ch4_fem.html#cb33-13" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;不同位置的温度随时间变化&#39;</span>)</span>
<span id="cb33-14"><a href="ch4_fem.html#cb33-14" tabindex="-1"></a></span>
<span id="cb33-15"><a href="ch4_fem.html#cb33-15" tabindex="-1"></a><span class="co"># 添加其他位置的曲线</span></span>
<span id="cb33-16"><a href="ch4_fem.html#cb33-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(position_indices)) {</span>
<span id="cb33-17"><a href="ch4_fem.html#cb33-17" tabindex="-1"></a>  <span class="fu">lines</span>(time_coords, u_history[position_indices[i], ], </span>
<span id="cb33-18"><a href="ch4_fem.html#cb33-18" tabindex="-1"></a>        <span class="at">col =</span> colors_time[i], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-19"><a href="ch4_fem.html#cb33-19" tabindex="-1"></a>}</span>
<span id="cb33-20"><a href="ch4_fem.html#cb33-20" tabindex="-1"></a></span>
<span id="cb33-21"><a href="ch4_fem.html#cb33-21" tabindex="-1"></a><span class="co"># 添加图例</span></span>
<span id="cb33-22"><a href="ch4_fem.html#cb33-22" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> position_labels, </span>
<span id="cb33-23"><a href="ch4_fem.html#cb33-23" tabindex="-1"></a>       <span class="at">col =</span> colors_time, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb33-24"><a href="ch4_fem.html#cb33-24" tabindex="-1"></a></span>
<span id="cb33-25"><a href="ch4_fem.html#cb33-25" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="_bookdown_files/04-FEM_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="ch4_fem.html#cb34-1" tabindex="-1"></a><span class="co"># 返回结果</span></span>
<span id="cb34-2"><a href="ch4_fem.html#cb34-2" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-3"><a href="ch4_fem.html#cb34-3" tabindex="-1"></a>  <span class="at">x_coords =</span> x_coords,</span>
<span id="cb34-4"><a href="ch4_fem.html#cb34-4" tabindex="-1"></a>  <span class="at">time_coords =</span> time_coords,</span>
<span id="cb34-5"><a href="ch4_fem.html#cb34-5" tabindex="-1"></a>  <span class="at">u_history =</span> u_history,</span>
<span id="cb34-6"><a href="ch4_fem.html#cb34-6" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb34-7"><a href="ch4_fem.html#cb34-7" tabindex="-1"></a>    <span class="at">L =</span> L,</span>
<span id="cb34-8"><a href="ch4_fem.html#cb34-8" tabindex="-1"></a>    <span class="at">n_elements =</span> n_elements,</span>
<span id="cb34-9"><a href="ch4_fem.html#cb34-9" tabindex="-1"></a>    <span class="at">alpha =</span> alpha,</span>
<span id="cb34-10"><a href="ch4_fem.html#cb34-10" tabindex="-1"></a>    <span class="at">dt =</span> dt,</span>
<span id="cb34-11"><a href="ch4_fem.html#cb34-11" tabindex="-1"></a>    <span class="at">T_max =</span> T_max</span>
<span id="cb34-12"><a href="ch4_fem.html#cb34-12" tabindex="-1"></a>  )</span>
<span id="cb34-13"><a href="ch4_fem.html#cb34-13" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="ch4_fem.html#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="ch4_fem.html#cb34-15" tabindex="-1"></a><span class="co"># 打印结果摘要</span></span>
<span id="cb34-16"><a href="ch4_fem.html#cb34-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;有限元法求解完成！</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 有限元法求解完成！</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="ch4_fem.html#cb36-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;空间网格点数：&quot;</span>, n_nodes, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 空间网格点数： 21</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ch4_fem.html#cb38-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;时间步数：&quot;</span>, n_steps, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 时间步数： 100</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ch4_fem.html#cb40-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;最终温度范围：&quot;</span>, <span class="fu">round</span>(<span class="fu">min</span>(u_history[, n_steps <span class="sc">+</span> <span class="dv">1</span>]), <span class="dv">2</span>), <span class="st">&quot;°C 到&quot;</span>, </span>
<span id="cb40-2"><a href="ch4_fem.html#cb40-2" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">max</span>(u_history[, n_steps <span class="sc">+</span> <span class="dv">1</span>]), <span class="dv">2</span>), <span class="st">&quot;°C</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 最终温度范围： 50 °C 到 100 °C</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ch4_fem.html#cb42-1" tabindex="-1"></a><span class="co">#return(result)</span></span></code></pre></div>
</div>
<div id="运行结果示例" class="section level3 hasAnchor" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> 运行结果示例<a href="ch4_fem.html#运行结果示例" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>运行上述代码可以得到一维热传导问题的有限元解。结果显示：</p>
<ol style="list-style-type: decimal">
<li><strong>温度分布演化</strong>：从初始的均匀温度25°C逐渐向两端边界温度过渡</li>
<li><strong>收敛性</strong>：解在时间推进过程中逐渐收敛到稳态解</li>
<li><strong>边界效应</strong>：温度梯度在边界附近较大，在中心区域较小</li>
</ol>
</div>
<div id="高级有限元技术实现" class="section level3 hasAnchor" number="4.3.7">
<h3><span class="header-section-number">4.3.7</span> 高级有限元技术实现<a href="ch4_fem.html#高级有限元技术实现" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>除了基本的线性有限元法，我们还实现了更高级的技术：</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ch4_fem.html#cb43-1" tabindex="-1"></a><span class="co"># 高级有限元法实现</span></span>
<span id="cb43-2"><a href="ch4_fem.html#cb43-2" tabindex="-1"></a><span class="co"># 包括高阶形函数、自适应网格和与有限差分法的对比</span></span>
<span id="cb43-3"><a href="ch4_fem.html#cb43-3" tabindex="-1"></a><span class="co"># 作者：数值地球教科书项目</span></span>
<span id="cb43-4"><a href="ch4_fem.html#cb43-4" tabindex="-1"></a><span class="co"># 日期：2025年</span></span>
<span id="cb43-5"><a href="ch4_fem.html#cb43-5" tabindex="-1"></a></span>
<span id="cb43-6"><a href="ch4_fem.html#cb43-6" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb43-7"><a href="ch4_fem.html#cb43-7" tabindex="-1"></a></span>
<span id="cb43-8"><a href="ch4_fem.html#cb43-8" tabindex="-1"></a><span class="co"># 加载字体配置</span></span>
<span id="cb43-9"><a href="ch4_fem.html#cb43-9" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Functions/font_setup.R&quot;</span>)</span>
<span id="cb43-10"><a href="ch4_fem.html#cb43-10" tabindex="-1"></a></span>
<span id="cb43-11"><a href="ch4_fem.html#cb43-11" tabindex="-1"></a><span class="co"># 设置中文字体（在绘图前）</span></span>
<span id="cb43-12"><a href="ch4_fem.html#cb43-12" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb43-13"><a href="ch4_fem.html#cb43-13" tabindex="-1"></a>  <span class="fu">setup_bookdown_fonts</span>()</span>
<span id="cb43-14"><a href="ch4_fem.html#cb43-14" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb43-15"><a href="ch4_fem.html#cb43-15" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;字体设置失败，使用默认字体：&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb43-16"><a href="ch4_fem.html#cb43-16" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## 字体设置完成： Arial Unicode MS</code></pre>
<pre><code>## [1] &quot;Arial Unicode MS&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="ch4_fem.html#cb46-1" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-2"><a href="ch4_fem.html#cb46-2" tabindex="-1"></a><span class="co"># 高阶形函数有限元法</span></span>
<span id="cb46-3"><a href="ch4_fem.html#cb46-3" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-4"><a href="ch4_fem.html#cb46-4" tabindex="-1"></a></span>
<span id="cb46-5"><a href="ch4_fem.html#cb46-5" tabindex="-1"></a><span class="co"># 二次形函数</span></span>
<span id="cb46-6"><a href="ch4_fem.html#cb46-6" tabindex="-1"></a>quadratic_shape_functions <span class="ot">&lt;-</span> <span class="cf">function</span>(xi) {</span>
<span id="cb46-7"><a href="ch4_fem.html#cb46-7" tabindex="-1"></a>  N1 <span class="ot">&lt;-</span> xi <span class="sc">*</span> (xi <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-8"><a href="ch4_fem.html#cb46-8" tabindex="-1"></a>  N2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> xi<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-9"><a href="ch4_fem.html#cb46-9" tabindex="-1"></a>  N3 <span class="ot">&lt;-</span> xi <span class="sc">*</span> (xi <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-10"><a href="ch4_fem.html#cb46-10" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(N1, N2, N3))</span>
<span id="cb46-11"><a href="ch4_fem.html#cb46-11" tabindex="-1"></a>}</span>
<span id="cb46-12"><a href="ch4_fem.html#cb46-12" tabindex="-1"></a></span>
<span id="cb46-13"><a href="ch4_fem.html#cb46-13" tabindex="-1"></a><span class="co"># 二次形函数的导数</span></span>
<span id="cb46-14"><a href="ch4_fem.html#cb46-14" tabindex="-1"></a>quadratic_shape_derivatives <span class="ot">&lt;-</span> <span class="cf">function</span>(xi) {</span>
<span id="cb46-15"><a href="ch4_fem.html#cb46-15" tabindex="-1"></a>  dN1 <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>xi <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-16"><a href="ch4_fem.html#cb46-16" tabindex="-1"></a>  dN2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>xi</span>
<span id="cb46-17"><a href="ch4_fem.html#cb46-17" tabindex="-1"></a>  dN3 <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>xi <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-18"><a href="ch4_fem.html#cb46-18" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(dN1, dN2, dN3))</span>
<span id="cb46-19"><a href="ch4_fem.html#cb46-19" tabindex="-1"></a>}</span>
<span id="cb46-20"><a href="ch4_fem.html#cb46-20" tabindex="-1"></a></span>
<span id="cb46-21"><a href="ch4_fem.html#cb46-21" tabindex="-1"></a><span class="co"># 高阶有限元求解器</span></span>
<span id="cb46-22"><a href="ch4_fem.html#cb46-22" tabindex="-1"></a>FEM_quadratic <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">L =</span> <span class="fl">1.0</span>, <span class="at">n_elements =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">1e-4</span>, </span>
<span id="cb46-23"><a href="ch4_fem.html#cb46-23" tabindex="-1"></a>                          <span class="at">dt =</span> <span class="dv">100</span>, <span class="at">T_max =</span> <span class="dv">10000</span>, <span class="at">u_0 =</span> <span class="dv">100</span>, <span class="at">u_L =</span> <span class="dv">50</span>, <span class="at">u_ic =</span> <span class="dv">25</span>) {</span>
<span id="cb46-24"><a href="ch4_fem.html#cb46-24" tabindex="-1"></a>  </span>
<span id="cb46-25"><a href="ch4_fem.html#cb46-25" tabindex="-1"></a>  n_nodes <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> n_elements <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># 二次单元：每个单元3个节点</span></span>
<span id="cb46-26"><a href="ch4_fem.html#cb46-26" tabindex="-1"></a>  h <span class="ot">&lt;-</span> L <span class="sc">/</span> n_elements</span>
<span id="cb46-27"><a href="ch4_fem.html#cb46-27" tabindex="-1"></a>  </span>
<span id="cb46-28"><a href="ch4_fem.html#cb46-28" tabindex="-1"></a>  <span class="co"># 构造质量矩阵和刚度矩阵</span></span>
<span id="cb46-29"><a href="ch4_fem.html#cb46-29" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-30"><a href="ch4_fem.html#cb46-30" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-31"><a href="ch4_fem.html#cb46-31" tabindex="-1"></a>  </span>
<span id="cb46-32"><a href="ch4_fem.html#cb46-32" tabindex="-1"></a>  <span class="co"># 高斯积分点和权重</span></span>
<span id="cb46-33"><a href="ch4_fem.html#cb46-33" tabindex="-1"></a>  gauss_points <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">sqrt</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>), <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>))</span>
<span id="cb46-34"><a href="ch4_fem.html#cb46-34" tabindex="-1"></a>  gauss_weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>, <span class="dv">8</span><span class="sc">/</span><span class="dv">9</span>, <span class="dv">5</span><span class="sc">/</span><span class="dv">9</span>)</span>
<span id="cb46-35"><a href="ch4_fem.html#cb46-35" tabindex="-1"></a>  </span>
<span id="cb46-36"><a href="ch4_fem.html#cb46-36" tabindex="-1"></a>  <span class="co"># 组装全局矩阵</span></span>
<span id="cb46-37"><a href="ch4_fem.html#cb46-37" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_elements) {</span>
<span id="cb46-38"><a href="ch4_fem.html#cb46-38" tabindex="-1"></a>    <span class="co"># 局部节点编号（二次单元）</span></span>
<span id="cb46-39"><a href="ch4_fem.html#cb46-39" tabindex="-1"></a>    local_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">*</span>i<span class="dv">-1</span>, <span class="dv">2</span><span class="sc">*</span>i, <span class="dv">2</span><span class="sc">*</span>i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb46-40"><a href="ch4_fem.html#cb46-40" tabindex="-1"></a>    </span>
<span id="cb46-41"><a href="ch4_fem.html#cb46-41" tabindex="-1"></a>    <span class="co"># 初始化局部矩阵</span></span>
<span id="cb46-42"><a href="ch4_fem.html#cb46-42" tabindex="-1"></a>    M_local <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb46-43"><a href="ch4_fem.html#cb46-43" tabindex="-1"></a>    K_local <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb46-44"><a href="ch4_fem.html#cb46-44" tabindex="-1"></a>    </span>
<span id="cb46-45"><a href="ch4_fem.html#cb46-45" tabindex="-1"></a>    <span class="co"># 高斯积分</span></span>
<span id="cb46-46"><a href="ch4_fem.html#cb46-46" tabindex="-1"></a>    <span class="cf">for</span> (gp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb46-47"><a href="ch4_fem.html#cb46-47" tabindex="-1"></a>      xi <span class="ot">&lt;-</span> gauss_points[gp]</span>
<span id="cb46-48"><a href="ch4_fem.html#cb46-48" tabindex="-1"></a>      weight <span class="ot">&lt;-</span> gauss_weights[gp]</span>
<span id="cb46-49"><a href="ch4_fem.html#cb46-49" tabindex="-1"></a>      </span>
<span id="cb46-50"><a href="ch4_fem.html#cb46-50" tabindex="-1"></a>      <span class="co"># 形函数和导数</span></span>
<span id="cb46-51"><a href="ch4_fem.html#cb46-51" tabindex="-1"></a>      N <span class="ot">&lt;-</span> <span class="fu">quadratic_shape_functions</span>(xi)</span>
<span id="cb46-52"><a href="ch4_fem.html#cb46-52" tabindex="-1"></a>      dN <span class="ot">&lt;-</span> <span class="fu">quadratic_shape_derivatives</span>(xi)</span>
<span id="cb46-53"><a href="ch4_fem.html#cb46-53" tabindex="-1"></a>      </span>
<span id="cb46-54"><a href="ch4_fem.html#cb46-54" tabindex="-1"></a>      <span class="co"># 雅可比变换</span></span>
<span id="cb46-55"><a href="ch4_fem.html#cb46-55" tabindex="-1"></a>      J <span class="ot">&lt;-</span> h<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb46-56"><a href="ch4_fem.html#cb46-56" tabindex="-1"></a>      </span>
<span id="cb46-57"><a href="ch4_fem.html#cb46-57" tabindex="-1"></a>      <span class="co"># 组装局部矩阵</span></span>
<span id="cb46-58"><a href="ch4_fem.html#cb46-58" tabindex="-1"></a>      <span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb46-59"><a href="ch4_fem.html#cb46-59" tabindex="-1"></a>        <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb46-60"><a href="ch4_fem.html#cb46-60" tabindex="-1"></a>          M_local[a, b] <span class="ot">&lt;-</span> M_local[a, b] <span class="sc">+</span> weight <span class="sc">*</span> N[a] <span class="sc">*</span> N[b] <span class="sc">*</span> J</span>
<span id="cb46-61"><a href="ch4_fem.html#cb46-61" tabindex="-1"></a>          K_local[a, b] <span class="ot">&lt;-</span> K_local[a, b] <span class="sc">+</span> weight <span class="sc">*</span> dN[a] <span class="sc">*</span> dN[b] <span class="sc">*</span> J</span>
<span id="cb46-62"><a href="ch4_fem.html#cb46-62" tabindex="-1"></a>        }</span>
<span id="cb46-63"><a href="ch4_fem.html#cb46-63" tabindex="-1"></a>      }</span>
<span id="cb46-64"><a href="ch4_fem.html#cb46-64" tabindex="-1"></a>    }</span>
<span id="cb46-65"><a href="ch4_fem.html#cb46-65" tabindex="-1"></a>    </span>
<span id="cb46-66"><a href="ch4_fem.html#cb46-66" tabindex="-1"></a>    <span class="co"># 组装到全局矩阵</span></span>
<span id="cb46-67"><a href="ch4_fem.html#cb46-67" tabindex="-1"></a>    M[local_nodes, local_nodes] <span class="ot">&lt;-</span> M[local_nodes, local_nodes] <span class="sc">+</span> M_local</span>
<span id="cb46-68"><a href="ch4_fem.html#cb46-68" tabindex="-1"></a>    K[local_nodes, local_nodes] <span class="ot">&lt;-</span> K[local_nodes, local_nodes] <span class="sc">+</span> alpha <span class="sc">*</span> K_local</span>
<span id="cb46-69"><a href="ch4_fem.html#cb46-69" tabindex="-1"></a>  }</span>
<span id="cb46-70"><a href="ch4_fem.html#cb46-70" tabindex="-1"></a>  </span>
<span id="cb46-71"><a href="ch4_fem.html#cb46-71" tabindex="-1"></a>  <span class="co"># 时间推进</span></span>
<span id="cb46-72"><a href="ch4_fem.html#cb46-72" tabindex="-1"></a>  n_steps <span class="ot">&lt;-</span> T_max <span class="sc">/</span> dt</span>
<span id="cb46-73"><a href="ch4_fem.html#cb46-73" tabindex="-1"></a>  u_current <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_ic, n_nodes)</span>
<span id="cb46-74"><a href="ch4_fem.html#cb46-74" tabindex="-1"></a>  u_history <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_nodes, n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb46-75"><a href="ch4_fem.html#cb46-75" tabindex="-1"></a>  u_history[, <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-76"><a href="ch4_fem.html#cb46-76" tabindex="-1"></a>  </span>
<span id="cb46-77"><a href="ch4_fem.html#cb46-77" tabindex="-1"></a>  <span class="co"># 构造线性方程组系数矩阵</span></span>
<span id="cb46-78"><a href="ch4_fem.html#cb46-78" tabindex="-1"></a>  A <span class="ot">&lt;-</span> M <span class="sc">+</span> dt <span class="sc">*</span> K</span>
<span id="cb46-79"><a href="ch4_fem.html#cb46-79" tabindex="-1"></a>  </span>
<span id="cb46-80"><a href="ch4_fem.html#cb46-80" tabindex="-1"></a>  <span class="co"># 施加边界条件</span></span>
<span id="cb46-81"><a href="ch4_fem.html#cb46-81" tabindex="-1"></a>  A[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-82"><a href="ch4_fem.html#cb46-82" tabindex="-1"></a>  A[n_nodes, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[n_nodes, n_nodes] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-83"><a href="ch4_fem.html#cb46-83" tabindex="-1"></a>  </span>
<span id="cb46-84"><a href="ch4_fem.html#cb46-84" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb46-85"><a href="ch4_fem.html#cb46-85" tabindex="-1"></a>    b <span class="ot">&lt;-</span> M <span class="sc">%*%</span> u_current</span>
<span id="cb46-86"><a href="ch4_fem.html#cb46-86" tabindex="-1"></a>    b[<span class="dv">1</span>] <span class="ot">&lt;-</span> u_0</span>
<span id="cb46-87"><a href="ch4_fem.html#cb46-87" tabindex="-1"></a>    b[n_nodes] <span class="ot">&lt;-</span> u_L</span>
<span id="cb46-88"><a href="ch4_fem.html#cb46-88" tabindex="-1"></a>    </span>
<span id="cb46-89"><a href="ch4_fem.html#cb46-89" tabindex="-1"></a>    u_new <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, b)</span>
<span id="cb46-90"><a href="ch4_fem.html#cb46-90" tabindex="-1"></a>    u_current <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(u_new)</span>
<span id="cb46-91"><a href="ch4_fem.html#cb46-91" tabindex="-1"></a>    u_history[, step <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-92"><a href="ch4_fem.html#cb46-92" tabindex="-1"></a>  }</span>
<span id="cb46-93"><a href="ch4_fem.html#cb46-93" tabindex="-1"></a>  </span>
<span id="cb46-94"><a href="ch4_fem.html#cb46-94" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb46-95"><a href="ch4_fem.html#cb46-95" tabindex="-1"></a>    <span class="at">u_history =</span> u_history,</span>
<span id="cb46-96"><a href="ch4_fem.html#cb46-96" tabindex="-1"></a>    <span class="at">x_coords =</span> <span class="fu">seq</span>(<span class="dv">0</span>, L, <span class="at">length.out =</span> n_nodes),</span>
<span id="cb46-97"><a href="ch4_fem.html#cb46-97" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">list</span>(<span class="at">n_elements =</span> n_elements, <span class="at">n_nodes =</span> n_nodes, <span class="at">h =</span> h)</span>
<span id="cb46-98"><a href="ch4_fem.html#cb46-98" tabindex="-1"></a>  ))</span>
<span id="cb46-99"><a href="ch4_fem.html#cb46-99" tabindex="-1"></a>}</span>
<span id="cb46-100"><a href="ch4_fem.html#cb46-100" tabindex="-1"></a></span>
<span id="cb46-101"><a href="ch4_fem.html#cb46-101" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-102"><a href="ch4_fem.html#cb46-102" tabindex="-1"></a><span class="co"># 自适应网格有限元法</span></span>
<span id="cb46-103"><a href="ch4_fem.html#cb46-103" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-104"><a href="ch4_fem.html#cb46-104" tabindex="-1"></a></span>
<span id="cb46-105"><a href="ch4_fem.html#cb46-105" tabindex="-1"></a><span class="co"># 误差估计器</span></span>
<span id="cb46-106"><a href="ch4_fem.html#cb46-106" tabindex="-1"></a>error_estimator <span class="ot">&lt;-</span> <span class="cf">function</span>(u, h) {</span>
<span id="cb46-107"><a href="ch4_fem.html#cb46-107" tabindex="-1"></a>  <span class="co"># 基于梯度的简单误差估计</span></span>
<span id="cb46-108"><a href="ch4_fem.html#cb46-108" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(u)</span>
<span id="cb46-109"><a href="ch4_fem.html#cb46-109" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n<span class="dv">-1</span>)</span>
<span id="cb46-110"><a href="ch4_fem.html#cb46-110" tabindex="-1"></a>  </span>
<span id="cb46-111"><a href="ch4_fem.html#cb46-111" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)) {</span>
<span id="cb46-112"><a href="ch4_fem.html#cb46-112" tabindex="-1"></a>    gradient <span class="ot">&lt;-</span> <span class="fu">abs</span>(u[i<span class="sc">+</span><span class="dv">1</span>] <span class="sc">-</span> u[i]) <span class="sc">/</span> h</span>
<span id="cb46-113"><a href="ch4_fem.html#cb46-113" tabindex="-1"></a>    error[i] <span class="ot">&lt;-</span> h <span class="sc">*</span> gradient<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-114"><a href="ch4_fem.html#cb46-114" tabindex="-1"></a>  }</span>
<span id="cb46-115"><a href="ch4_fem.html#cb46-115" tabindex="-1"></a>  </span>
<span id="cb46-116"><a href="ch4_fem.html#cb46-116" tabindex="-1"></a>  <span class="fu">return</span>(error)</span>
<span id="cb46-117"><a href="ch4_fem.html#cb46-117" tabindex="-1"></a>}</span>
<span id="cb46-118"><a href="ch4_fem.html#cb46-118" tabindex="-1"></a></span>
<span id="cb46-119"><a href="ch4_fem.html#cb46-119" tabindex="-1"></a><span class="co"># 自适应网格细化</span></span>
<span id="cb46-120"><a href="ch4_fem.html#cb46-120" tabindex="-1"></a>adaptive_mesh_refinement <span class="ot">&lt;-</span> <span class="cf">function</span>(u, x, <span class="at">error_threshold =</span> <span class="fl">0.01</span>) {</span>
<span id="cb46-121"><a href="ch4_fem.html#cb46-121" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(u)</span>
<span id="cb46-122"><a href="ch4_fem.html#cb46-122" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">error_estimator</span>(u, <span class="fu">diff</span>(x))</span>
<span id="cb46-123"><a href="ch4_fem.html#cb46-123" tabindex="-1"></a>  </span>
<span id="cb46-124"><a href="ch4_fem.html#cb46-124" tabindex="-1"></a>  <span class="co"># 标记需要细化的单元</span></span>
<span id="cb46-125"><a href="ch4_fem.html#cb46-125" tabindex="-1"></a>  refine_elements <span class="ot">&lt;-</span> <span class="fu">which</span>(error <span class="sc">&gt;</span> error_threshold)</span>
<span id="cb46-126"><a href="ch4_fem.html#cb46-126" tabindex="-1"></a>  </span>
<span id="cb46-127"><a href="ch4_fem.html#cb46-127" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(refine_elements) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb46-128"><a href="ch4_fem.html#cb46-128" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">u =</span> u, <span class="at">refined =</span> <span class="cn">FALSE</span>))</span>
<span id="cb46-129"><a href="ch4_fem.html#cb46-129" tabindex="-1"></a>  }</span>
<span id="cb46-130"><a href="ch4_fem.html#cb46-130" tabindex="-1"></a>  </span>
<span id="cb46-131"><a href="ch4_fem.html#cb46-131" tabindex="-1"></a>  <span class="co"># 在误差大的单元中点插入新节点</span></span>
<span id="cb46-132"><a href="ch4_fem.html#cb46-132" tabindex="-1"></a>  new_x <span class="ot">&lt;-</span> x</span>
<span id="cb46-133"><a href="ch4_fem.html#cb46-133" tabindex="-1"></a>  new_u <span class="ot">&lt;-</span> u</span>
<span id="cb46-134"><a href="ch4_fem.html#cb46-134" tabindex="-1"></a>  </span>
<span id="cb46-135"><a href="ch4_fem.html#cb46-135" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">sort</span>(refine_elements, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb46-136"><a href="ch4_fem.html#cb46-136" tabindex="-1"></a>    <span class="co"># 插入中点</span></span>
<span id="cb46-137"><a href="ch4_fem.html#cb46-137" tabindex="-1"></a>    mid_x <span class="ot">&lt;-</span> (x[i] <span class="sc">+</span> x[i<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-138"><a href="ch4_fem.html#cb46-138" tabindex="-1"></a>    mid_u <span class="ot">&lt;-</span> (u[i] <span class="sc">+</span> u[i<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb46-139"><a href="ch4_fem.html#cb46-139" tabindex="-1"></a>    </span>
<span id="cb46-140"><a href="ch4_fem.html#cb46-140" tabindex="-1"></a>    new_x <span class="ot">&lt;-</span> <span class="fu">c</span>(new_x[<span class="dv">1</span><span class="sc">:</span>i], mid_x, new_x[(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(new_x)])</span>
<span id="cb46-141"><a href="ch4_fem.html#cb46-141" tabindex="-1"></a>    new_u <span class="ot">&lt;-</span> <span class="fu">c</span>(new_u[<span class="dv">1</span><span class="sc">:</span>i], mid_u, new_u[(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(new_u)])</span>
<span id="cb46-142"><a href="ch4_fem.html#cb46-142" tabindex="-1"></a>  }</span>
<span id="cb46-143"><a href="ch4_fem.html#cb46-143" tabindex="-1"></a>  </span>
<span id="cb46-144"><a href="ch4_fem.html#cb46-144" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x =</span> new_x, <span class="at">u =</span> new_u, <span class="at">refined =</span> <span class="cn">TRUE</span>))</span>
<span id="cb46-145"><a href="ch4_fem.html#cb46-145" tabindex="-1"></a>}</span>
<span id="cb46-146"><a href="ch4_fem.html#cb46-146" tabindex="-1"></a></span>
<span id="cb46-147"><a href="ch4_fem.html#cb46-147" tabindex="-1"></a><span class="co"># 自适应有限元求解器</span></span>
<span id="cb46-148"><a href="ch4_fem.html#cb46-148" tabindex="-1"></a>FEM_adaptive <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">L =</span> <span class="fl">1.0</span>, <span class="at">initial_elements =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">1e-4</span>, </span>
<span id="cb46-149"><a href="ch4_fem.html#cb46-149" tabindex="-1"></a>                         <span class="at">dt =</span> <span class="dv">100</span>, <span class="at">T_max =</span> <span class="dv">10000</span>, <span class="at">u_0 =</span> <span class="dv">100</span>, <span class="at">u_L =</span> <span class="dv">50</span>, <span class="at">u_ic =</span> <span class="dv">25</span>,</span>
<span id="cb46-150"><a href="ch4_fem.html#cb46-150" tabindex="-1"></a>                         <span class="at">max_refinements =</span> <span class="dv">3</span>) {</span>
<span id="cb46-151"><a href="ch4_fem.html#cb46-151" tabindex="-1"></a>  </span>
<span id="cb46-152"><a href="ch4_fem.html#cb46-152" tabindex="-1"></a>  <span class="co"># 初始网格</span></span>
<span id="cb46-153"><a href="ch4_fem.html#cb46-153" tabindex="-1"></a>  n_elements <span class="ot">&lt;-</span> initial_elements</span>
<span id="cb46-154"><a href="ch4_fem.html#cb46-154" tabindex="-1"></a>  n_nodes <span class="ot">&lt;-</span> n_elements <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb46-155"><a href="ch4_fem.html#cb46-155" tabindex="-1"></a>  h <span class="ot">&lt;-</span> L <span class="sc">/</span> n_elements</span>
<span id="cb46-156"><a href="ch4_fem.html#cb46-156" tabindex="-1"></a>  </span>
<span id="cb46-157"><a href="ch4_fem.html#cb46-157" tabindex="-1"></a>  <span class="co"># 初始条件</span></span>
<span id="cb46-158"><a href="ch4_fem.html#cb46-158" tabindex="-1"></a>  u_current <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_ic, n_nodes)</span>
<span id="cb46-159"><a href="ch4_fem.html#cb46-159" tabindex="-1"></a>  x_coords <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, L, <span class="at">length.out =</span> n_nodes)</span>
<span id="cb46-160"><a href="ch4_fem.html#cb46-160" tabindex="-1"></a>  </span>
<span id="cb46-161"><a href="ch4_fem.html#cb46-161" tabindex="-1"></a>  <span class="co"># 自适应细化循环</span></span>
<span id="cb46-162"><a href="ch4_fem.html#cb46-162" tabindex="-1"></a>  <span class="cf">for</span> (refinement <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_refinements) {</span>
<span id="cb46-163"><a href="ch4_fem.html#cb46-163" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;第&quot;</span>, refinement, <span class="st">&quot;次网格细化，节点数：&quot;</span>, <span class="fu">length</span>(x_coords), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-164"><a href="ch4_fem.html#cb46-164" tabindex="-1"></a>    </span>
<span id="cb46-165"><a href="ch4_fem.html#cb46-165" tabindex="-1"></a>    <span class="co"># 使用当前网格求解</span></span>
<span id="cb46-166"><a href="ch4_fem.html#cb46-166" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">FEM_linear_adaptive</span>(x_coords, u_current, alpha, dt, T_max, u_0, u_L)</span>
<span id="cb46-167"><a href="ch4_fem.html#cb46-167" tabindex="-1"></a>    </span>
<span id="cb46-168"><a href="ch4_fem.html#cb46-168" tabindex="-1"></a>    <span class="co"># 误差估计和网格细化</span></span>
<span id="cb46-169"><a href="ch4_fem.html#cb46-169" tabindex="-1"></a>    mesh_result <span class="ot">&lt;-</span> <span class="fu">adaptive_mesh_refinement</span>(result<span class="sc">$</span>u_final, x_coords)</span>
<span id="cb46-170"><a href="ch4_fem.html#cb46-170" tabindex="-1"></a>    </span>
<span id="cb46-171"><a href="ch4_fem.html#cb46-171" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>mesh_result<span class="sc">$</span>refined) {</span>
<span id="cb46-172"><a href="ch4_fem.html#cb46-172" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;网格细化完成</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-173"><a href="ch4_fem.html#cb46-173" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb46-174"><a href="ch4_fem.html#cb46-174" tabindex="-1"></a>    }</span>
<span id="cb46-175"><a href="ch4_fem.html#cb46-175" tabindex="-1"></a>    </span>
<span id="cb46-176"><a href="ch4_fem.html#cb46-176" tabindex="-1"></a>    <span class="co"># 更新网格和解</span></span>
<span id="cb46-177"><a href="ch4_fem.html#cb46-177" tabindex="-1"></a>    x_coords <span class="ot">&lt;-</span> mesh_result<span class="sc">$</span>x</span>
<span id="cb46-178"><a href="ch4_fem.html#cb46-178" tabindex="-1"></a>    u_current <span class="ot">&lt;-</span> mesh_result<span class="sc">$</span>u</span>
<span id="cb46-179"><a href="ch4_fem.html#cb46-179" tabindex="-1"></a>  }</span>
<span id="cb46-180"><a href="ch4_fem.html#cb46-180" tabindex="-1"></a>  </span>
<span id="cb46-181"><a href="ch4_fem.html#cb46-181" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb46-182"><a href="ch4_fem.html#cb46-182" tabindex="-1"></a>}</span>
<span id="cb46-183"><a href="ch4_fem.html#cb46-183" tabindex="-1"></a></span>
<span id="cb46-184"><a href="ch4_fem.html#cb46-184" tabindex="-1"></a><span class="co"># 线性有限元求解器（用于自适应网格）</span></span>
<span id="cb46-185"><a href="ch4_fem.html#cb46-185" tabindex="-1"></a>FEM_linear_adaptive <span class="ot">&lt;-</span> <span class="cf">function</span>(x_coords, u_ic, alpha, dt, T_max, u_0, u_L) {</span>
<span id="cb46-186"><a href="ch4_fem.html#cb46-186" tabindex="-1"></a>  n_nodes <span class="ot">&lt;-</span> <span class="fu">length</span>(x_coords)</span>
<span id="cb46-187"><a href="ch4_fem.html#cb46-187" tabindex="-1"></a>  n_elements <span class="ot">&lt;-</span> n_nodes <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb46-188"><a href="ch4_fem.html#cb46-188" tabindex="-1"></a>  </span>
<span id="cb46-189"><a href="ch4_fem.html#cb46-189" tabindex="-1"></a>  <span class="co"># 构造质量矩阵和刚度矩阵</span></span>
<span id="cb46-190"><a href="ch4_fem.html#cb46-190" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-191"><a href="ch4_fem.html#cb46-191" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-192"><a href="ch4_fem.html#cb46-192" tabindex="-1"></a>  </span>
<span id="cb46-193"><a href="ch4_fem.html#cb46-193" tabindex="-1"></a>  <span class="co"># 组装全局矩阵</span></span>
<span id="cb46-194"><a href="ch4_fem.html#cb46-194" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_elements) {</span>
<span id="cb46-195"><a href="ch4_fem.html#cb46-195" tabindex="-1"></a>    h <span class="ot">&lt;-</span> x_coords[i<span class="sc">+</span><span class="dv">1</span>] <span class="sc">-</span> x_coords[i]</span>
<span id="cb46-196"><a href="ch4_fem.html#cb46-196" tabindex="-1"></a>    local_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(i, i<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb46-197"><a href="ch4_fem.html#cb46-197" tabindex="-1"></a>    </span>
<span id="cb46-198"><a href="ch4_fem.html#cb46-198" tabindex="-1"></a>    M_local <span class="ot">&lt;-</span> h<span class="sc">/</span><span class="dv">6</span> <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb46-199"><a href="ch4_fem.html#cb46-199" tabindex="-1"></a>    K_local <span class="ot">&lt;-</span> alpha<span class="sc">/</span>h <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb46-200"><a href="ch4_fem.html#cb46-200" tabindex="-1"></a>    </span>
<span id="cb46-201"><a href="ch4_fem.html#cb46-201" tabindex="-1"></a>    M[local_nodes, local_nodes] <span class="ot">&lt;-</span> M[local_nodes, local_nodes] <span class="sc">+</span> M_local</span>
<span id="cb46-202"><a href="ch4_fem.html#cb46-202" tabindex="-1"></a>    K[local_nodes, local_nodes] <span class="ot">&lt;-</span> K[local_nodes, local_nodes] <span class="sc">+</span> K_local</span>
<span id="cb46-203"><a href="ch4_fem.html#cb46-203" tabindex="-1"></a>  }</span>
<span id="cb46-204"><a href="ch4_fem.html#cb46-204" tabindex="-1"></a>  </span>
<span id="cb46-205"><a href="ch4_fem.html#cb46-205" tabindex="-1"></a>  <span class="co"># 时间推进</span></span>
<span id="cb46-206"><a href="ch4_fem.html#cb46-206" tabindex="-1"></a>  n_steps <span class="ot">&lt;-</span> T_max <span class="sc">/</span> dt</span>
<span id="cb46-207"><a href="ch4_fem.html#cb46-207" tabindex="-1"></a>  u_current <span class="ot">&lt;-</span> u_ic</span>
<span id="cb46-208"><a href="ch4_fem.html#cb46-208" tabindex="-1"></a>  u_history <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_nodes, n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb46-209"><a href="ch4_fem.html#cb46-209" tabindex="-1"></a>  u_history[, <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-210"><a href="ch4_fem.html#cb46-210" tabindex="-1"></a>  </span>
<span id="cb46-211"><a href="ch4_fem.html#cb46-211" tabindex="-1"></a>  A <span class="ot">&lt;-</span> M <span class="sc">+</span> dt <span class="sc">*</span> K</span>
<span id="cb46-212"><a href="ch4_fem.html#cb46-212" tabindex="-1"></a>  A[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-213"><a href="ch4_fem.html#cb46-213" tabindex="-1"></a>  A[n_nodes, ] <span class="ot">&lt;-</span> <span class="dv">0</span>; A[n_nodes, n_nodes] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-214"><a href="ch4_fem.html#cb46-214" tabindex="-1"></a>  </span>
<span id="cb46-215"><a href="ch4_fem.html#cb46-215" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb46-216"><a href="ch4_fem.html#cb46-216" tabindex="-1"></a>    b <span class="ot">&lt;-</span> M <span class="sc">%*%</span> u_current</span>
<span id="cb46-217"><a href="ch4_fem.html#cb46-217" tabindex="-1"></a>    b[<span class="dv">1</span>] <span class="ot">&lt;-</span> u_0</span>
<span id="cb46-218"><a href="ch4_fem.html#cb46-218" tabindex="-1"></a>    b[n_nodes] <span class="ot">&lt;-</span> u_L</span>
<span id="cb46-219"><a href="ch4_fem.html#cb46-219" tabindex="-1"></a>    </span>
<span id="cb46-220"><a href="ch4_fem.html#cb46-220" tabindex="-1"></a>    u_new <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, b)</span>
<span id="cb46-221"><a href="ch4_fem.html#cb46-221" tabindex="-1"></a>    u_current <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(u_new)</span>
<span id="cb46-222"><a href="ch4_fem.html#cb46-222" tabindex="-1"></a>    u_history[, step <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-223"><a href="ch4_fem.html#cb46-223" tabindex="-1"></a>  }</span>
<span id="cb46-224"><a href="ch4_fem.html#cb46-224" tabindex="-1"></a>  </span>
<span id="cb46-225"><a href="ch4_fem.html#cb46-225" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb46-226"><a href="ch4_fem.html#cb46-226" tabindex="-1"></a>    <span class="at">u_history =</span> u_history,</span>
<span id="cb46-227"><a href="ch4_fem.html#cb46-227" tabindex="-1"></a>    <span class="at">u_final =</span> u_current,</span>
<span id="cb46-228"><a href="ch4_fem.html#cb46-228" tabindex="-1"></a>    <span class="at">x_coords =</span> x_coords</span>
<span id="cb46-229"><a href="ch4_fem.html#cb46-229" tabindex="-1"></a>  ))</span>
<span id="cb46-230"><a href="ch4_fem.html#cb46-230" tabindex="-1"></a>}</span>
<span id="cb46-231"><a href="ch4_fem.html#cb46-231" tabindex="-1"></a></span>
<span id="cb46-232"><a href="ch4_fem.html#cb46-232" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-233"><a href="ch4_fem.html#cb46-233" tabindex="-1"></a><span class="co"># 与有限差分法的对比</span></span>
<span id="cb46-234"><a href="ch4_fem.html#cb46-234" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-235"><a href="ch4_fem.html#cb46-235" tabindex="-1"></a></span>
<span id="cb46-236"><a href="ch4_fem.html#cb46-236" tabindex="-1"></a><span class="co"># 有限差分法求解器（用于对比）</span></span>
<span id="cb46-237"><a href="ch4_fem.html#cb46-237" tabindex="-1"></a>FDM_explicit <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">L =</span> <span class="fl">1.0</span>, <span class="at">n_points =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">1e-4</span>, </span>
<span id="cb46-238"><a href="ch4_fem.html#cb46-238" tabindex="-1"></a>                         <span class="at">dt =</span> <span class="dv">100</span>, <span class="at">T_max =</span> <span class="dv">10000</span>, <span class="at">u_0 =</span> <span class="dv">100</span>, <span class="at">u_L =</span> <span class="dv">50</span>, <span class="at">u_ic =</span> <span class="dv">25</span>) {</span>
<span id="cb46-239"><a href="ch4_fem.html#cb46-239" tabindex="-1"></a>  </span>
<span id="cb46-240"><a href="ch4_fem.html#cb46-240" tabindex="-1"></a>  h <span class="ot">&lt;-</span> L <span class="sc">/</span> (n_points <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb46-241"><a href="ch4_fem.html#cb46-241" tabindex="-1"></a>  n_steps <span class="ot">&lt;-</span> T_max <span class="sc">/</span> dt</span>
<span id="cb46-242"><a href="ch4_fem.html#cb46-242" tabindex="-1"></a>  </span>
<span id="cb46-243"><a href="ch4_fem.html#cb46-243" tabindex="-1"></a>  <span class="co"># 检查CFL条件</span></span>
<span id="cb46-244"><a href="ch4_fem.html#cb46-244" tabindex="-1"></a>  cfl <span class="ot">&lt;-</span> alpha <span class="sc">*</span> dt <span class="sc">/</span> (h<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb46-245"><a href="ch4_fem.html#cb46-245" tabindex="-1"></a>  <span class="cf">if</span> (cfl <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb46-246"><a href="ch4_fem.html#cb46-246" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;警告：CFL条件不满足，CFL =&quot;</span>, cfl, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-247"><a href="ch4_fem.html#cb46-247" tabindex="-1"></a>  }</span>
<span id="cb46-248"><a href="ch4_fem.html#cb46-248" tabindex="-1"></a>  </span>
<span id="cb46-249"><a href="ch4_fem.html#cb46-249" tabindex="-1"></a>  <span class="co"># 初始条件</span></span>
<span id="cb46-250"><a href="ch4_fem.html#cb46-250" tabindex="-1"></a>  u_current <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_ic, n_points)</span>
<span id="cb46-251"><a href="ch4_fem.html#cb46-251" tabindex="-1"></a>  u_history <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_points, n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb46-252"><a href="ch4_fem.html#cb46-252" tabindex="-1"></a>  u_history[, <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-253"><a href="ch4_fem.html#cb46-253" tabindex="-1"></a>  </span>
<span id="cb46-254"><a href="ch4_fem.html#cb46-254" tabindex="-1"></a>  <span class="co"># 显式时间推进</span></span>
<span id="cb46-255"><a href="ch4_fem.html#cb46-255" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb46-256"><a href="ch4_fem.html#cb46-256" tabindex="-1"></a>    u_new <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-257"><a href="ch4_fem.html#cb46-257" tabindex="-1"></a>    </span>
<span id="cb46-258"><a href="ch4_fem.html#cb46-258" tabindex="-1"></a>    <span class="co"># 内部点</span></span>
<span id="cb46-259"><a href="ch4_fem.html#cb46-259" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n_points<span class="dv">-1</span>)) {</span>
<span id="cb46-260"><a href="ch4_fem.html#cb46-260" tabindex="-1"></a>      u_new[i] <span class="ot">&lt;-</span> u_current[i] <span class="sc">+</span> cfl <span class="sc">*</span> (u_current[i<span class="sc">+</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>u_current[i] <span class="sc">+</span> u_current[i<span class="dv">-1</span>])</span>
<span id="cb46-261"><a href="ch4_fem.html#cb46-261" tabindex="-1"></a>    }</span>
<span id="cb46-262"><a href="ch4_fem.html#cb46-262" tabindex="-1"></a>    </span>
<span id="cb46-263"><a href="ch4_fem.html#cb46-263" tabindex="-1"></a>    <span class="co"># 边界条件</span></span>
<span id="cb46-264"><a href="ch4_fem.html#cb46-264" tabindex="-1"></a>    u_new[<span class="dv">1</span>] <span class="ot">&lt;-</span> u_0</span>
<span id="cb46-265"><a href="ch4_fem.html#cb46-265" tabindex="-1"></a>    u_new[n_points] <span class="ot">&lt;-</span> u_L</span>
<span id="cb46-266"><a href="ch4_fem.html#cb46-266" tabindex="-1"></a>    </span>
<span id="cb46-267"><a href="ch4_fem.html#cb46-267" tabindex="-1"></a>    u_current <span class="ot">&lt;-</span> u_new</span>
<span id="cb46-268"><a href="ch4_fem.html#cb46-268" tabindex="-1"></a>    u_history[, step <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> u_current</span>
<span id="cb46-269"><a href="ch4_fem.html#cb46-269" tabindex="-1"></a>  }</span>
<span id="cb46-270"><a href="ch4_fem.html#cb46-270" tabindex="-1"></a>  </span>
<span id="cb46-271"><a href="ch4_fem.html#cb46-271" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb46-272"><a href="ch4_fem.html#cb46-272" tabindex="-1"></a>    <span class="at">u_history =</span> u_history,</span>
<span id="cb46-273"><a href="ch4_fem.html#cb46-273" tabindex="-1"></a>    <span class="at">x_coords =</span> <span class="fu">seq</span>(<span class="dv">0</span>, L, <span class="at">length.out =</span> n_points),</span>
<span id="cb46-274"><a href="ch4_fem.html#cb46-274" tabindex="-1"></a>    <span class="at">cfl =</span> cfl</span>
<span id="cb46-275"><a href="ch4_fem.html#cb46-275" tabindex="-1"></a>  ))</span>
<span id="cb46-276"><a href="ch4_fem.html#cb46-276" tabindex="-1"></a>}</span>
<span id="cb46-277"><a href="ch4_fem.html#cb46-277" tabindex="-1"></a></span>
<span id="cb46-278"><a href="ch4_fem.html#cb46-278" tabindex="-1"></a><span class="co"># 性能对比函数</span></span>
<span id="cb46-279"><a href="ch4_fem.html#cb46-279" tabindex="-1"></a>performance_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb46-280"><a href="ch4_fem.html#cb46-280" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;有限元法与有限差分法性能对比</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-281"><a href="ch4_fem.html#cb46-281" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;=&quot;</span> <span class="sc">*</span> <span class="dv">50</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-282"><a href="ch4_fem.html#cb46-282" tabindex="-1"></a>  </span>
<span id="cb46-283"><a href="ch4_fem.html#cb46-283" tabindex="-1"></a>  <span class="co"># 测试参数</span></span>
<span id="cb46-284"><a href="ch4_fem.html#cb46-284" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb46-285"><a href="ch4_fem.html#cb46-285" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="fl">1e-4</span></span>
<span id="cb46-286"><a href="ch4_fem.html#cb46-286" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb46-287"><a href="ch4_fem.html#cb46-287" tabindex="-1"></a>  T_max <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb46-288"><a href="ch4_fem.html#cb46-288" tabindex="-1"></a>  u_0 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb46-289"><a href="ch4_fem.html#cb46-289" tabindex="-1"></a>  u_L <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb46-290"><a href="ch4_fem.html#cb46-290" tabindex="-1"></a>  u_ic <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb46-291"><a href="ch4_fem.html#cb46-291" tabindex="-1"></a>  </span>
<span id="cb46-292"><a href="ch4_fem.html#cb46-292" tabindex="-1"></a>  <span class="co"># 测试不同网格密度</span></span>
<span id="cb46-293"><a href="ch4_fem.html#cb46-293" tabindex="-1"></a>  grid_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">21</span>, <span class="dv">41</span>, <span class="dv">81</span>)</span>
<span id="cb46-294"><a href="ch4_fem.html#cb46-294" tabindex="-1"></a>  </span>
<span id="cb46-295"><a href="ch4_fem.html#cb46-295" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> grid_sizes) {</span>
<span id="cb46-296"><a href="ch4_fem.html#cb46-296" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">网格点数：&quot;</span>, n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-297"><a href="ch4_fem.html#cb46-297" tabindex="-1"></a>    </span>
<span id="cb46-298"><a href="ch4_fem.html#cb46-298" tabindex="-1"></a>    <span class="co"># 有限差分法</span></span>
<span id="cb46-299"><a href="ch4_fem.html#cb46-299" tabindex="-1"></a>    t0 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb46-300"><a href="ch4_fem.html#cb46-300" tabindex="-1"></a>    fdm_result <span class="ot">&lt;-</span> <span class="fu">FDM_explicit</span>(L, n, alpha, dt, T_max, u_0, u_L, u_ic)</span>
<span id="cb46-301"><a href="ch4_fem.html#cb46-301" tabindex="-1"></a>    t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb46-302"><a href="ch4_fem.html#cb46-302" tabindex="-1"></a>    fdm_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(t1 <span class="sc">-</span> t0)</span>
<span id="cb46-303"><a href="ch4_fem.html#cb46-303" tabindex="-1"></a>    </span>
<span id="cb46-304"><a href="ch4_fem.html#cb46-304" tabindex="-1"></a>    <span class="co"># 有限元法（线性）</span></span>
<span id="cb46-305"><a href="ch4_fem.html#cb46-305" tabindex="-1"></a>    t0 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb46-306"><a href="ch4_fem.html#cb46-306" tabindex="-1"></a>    fem_result <span class="ot">&lt;-</span> <span class="fu">FEM_linear_adaptive</span>(</span>
<span id="cb46-307"><a href="ch4_fem.html#cb46-307" tabindex="-1"></a>      <span class="fu">seq</span>(<span class="dv">0</span>, L, <span class="at">length.out =</span> n), <span class="fu">rep</span>(u_ic, n), </span>
<span id="cb46-308"><a href="ch4_fem.html#cb46-308" tabindex="-1"></a>      alpha, dt, T_max, u_0, u_L</span>
<span id="cb46-309"><a href="ch4_fem.html#cb46-309" tabindex="-1"></a>    )</span>
<span id="cb46-310"><a href="ch4_fem.html#cb46-310" tabindex="-1"></a>    t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb46-311"><a href="ch4_fem.html#cb46-311" tabindex="-1"></a>    fem_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(t1 <span class="sc">-</span> t0)</span>
<span id="cb46-312"><a href="ch4_fem.html#cb46-312" tabindex="-1"></a>    </span>
<span id="cb46-313"><a href="ch4_fem.html#cb46-313" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;FDM时间：&quot;</span>, <span class="fu">round</span>(fdm_time, <span class="dv">4</span>), <span class="st">&quot;秒</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-314"><a href="ch4_fem.html#cb46-314" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;FEM时间：&quot;</span>, <span class="fu">round</span>(fem_time, <span class="dv">4</span>), <span class="st">&quot;秒</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-315"><a href="ch4_fem.html#cb46-315" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;时间比：&quot;</span>, <span class="fu">round</span>(fem_time<span class="sc">/</span>fdm_time, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-316"><a href="ch4_fem.html#cb46-316" tabindex="-1"></a>    </span>
<span id="cb46-317"><a href="ch4_fem.html#cb46-317" tabindex="-1"></a>    <span class="co"># 精度对比（使用解析解作为参考）</span></span>
<span id="cb46-318"><a href="ch4_fem.html#cb46-318" tabindex="-1"></a>    <span class="co"># 这里简化处理，实际应该与解析解比较</span></span>
<span id="cb46-319"><a href="ch4_fem.html#cb46-319" tabindex="-1"></a>    fdm_error <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">diff</span>(fdm_result<span class="sc">$</span>u_history[, <span class="fu">ncol</span>(fdm_result<span class="sc">$</span>u_history)])))</span>
<span id="cb46-320"><a href="ch4_fem.html#cb46-320" tabindex="-1"></a>    fem_error <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">diff</span>(fem_result<span class="sc">$</span>u_final)))</span>
<span id="cb46-321"><a href="ch4_fem.html#cb46-321" tabindex="-1"></a>    </span>
<span id="cb46-322"><a href="ch4_fem.html#cb46-322" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;FDM误差：&quot;</span>, <span class="fu">round</span>(fdm_error, <span class="dv">6</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-323"><a href="ch4_fem.html#cb46-323" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;FEM误差：&quot;</span>, <span class="fu">round</span>(fem_error, <span class="dv">6</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-324"><a href="ch4_fem.html#cb46-324" tabindex="-1"></a>  }</span>
<span id="cb46-325"><a href="ch4_fem.html#cb46-325" tabindex="-1"></a>}</span>
<span id="cb46-326"><a href="ch4_fem.html#cb46-326" tabindex="-1"></a></span>
<span id="cb46-327"><a href="ch4_fem.html#cb46-327" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-328"><a href="ch4_fem.html#cb46-328" tabindex="-1"></a><span class="co"># 主函数和示例</span></span>
<span id="cb46-329"><a href="ch4_fem.html#cb46-329" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb46-330"><a href="ch4_fem.html#cb46-330" tabindex="-1"></a></span>
<span id="cb46-331"><a href="ch4_fem.html#cb46-331" tabindex="-1"></a><span class="co"># 运行示例</span></span>
<span id="cb46-332"><a href="ch4_fem.html#cb46-332" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb46-333"><a href="ch4_fem.html#cb46-333" tabindex="-1"></a>  <span class="co"># 基本有限元法</span></span>
<span id="cb46-334"><a href="ch4_fem.html#cb46-334" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;运行基本有限元法...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-335"><a href="ch4_fem.html#cb46-335" tabindex="-1"></a>  result_basic <span class="ot">&lt;-</span> <span class="fu">FEM_quadratic</span>()</span>
<span id="cb46-336"><a href="ch4_fem.html#cb46-336" tabindex="-1"></a>  </span>
<span id="cb46-337"><a href="ch4_fem.html#cb46-337" tabindex="-1"></a>  <span class="co"># 自适应网格有限元法</span></span>
<span id="cb46-338"><a href="ch4_fem.html#cb46-338" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;运行自适应网格有限元法...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb46-339"><a href="ch4_fem.html#cb46-339" tabindex="-1"></a>  result_adaptive <span class="ot">&lt;-</span> <span class="fu">FEM_adaptive</span>()</span>
<span id="cb46-340"><a href="ch4_fem.html#cb46-340" tabindex="-1"></a>  </span>
<span id="cb46-341"><a href="ch4_fem.html#cb46-341" tabindex="-1"></a>  <span class="co"># 性能对比</span></span>
<span id="cb46-342"><a href="ch4_fem.html#cb46-342" tabindex="-1"></a>  <span class="fu">performance_comparison</span>()</span>
<span id="cb46-343"><a href="ch4_fem.html#cb46-343" tabindex="-1"></a>  </span>
<span id="cb46-344"><a href="ch4_fem.html#cb46-344" tabindex="-1"></a>  <span class="co"># 可视化结果</span></span>
<span id="cb46-345"><a href="ch4_fem.html#cb46-345" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb46-346"><a href="ch4_fem.html#cb46-346" tabindex="-1"></a>  </span>
<span id="cb46-347"><a href="ch4_fem.html#cb46-347" tabindex="-1"></a>  <span class="co"># 基本FEM结果 - 不同时刻的温度分布</span></span>
<span id="cb46-348"><a href="ch4_fem.html#cb46-348" tabindex="-1"></a>  time_indices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">ncol</span>(result_basic<span class="sc">$</span>u_history)<span class="sc">/</span><span class="dv">16</span>), </span>
<span id="cb46-349"><a href="ch4_fem.html#cb46-349" tabindex="-1"></a>                   <span class="fu">round</span>(<span class="fu">ncol</span>(result_basic<span class="sc">$</span>u_history)<span class="sc">/</span><span class="dv">8</span>), <span class="fu">ncol</span>(result_basic<span class="sc">$</span>u_history))</span>
<span id="cb46-350"><a href="ch4_fem.html#cb46-350" tabindex="-1"></a>  time_labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&#39;Time =&#39;</span>, time_indices, <span class="st">&#39;s&#39;</span>)</span>
<span id="cb46-351"><a href="ch4_fem.html#cb46-351" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb46-352"><a href="ch4_fem.html#cb46-352" tabindex="-1"></a>  </span>
<span id="cb46-353"><a href="ch4_fem.html#cb46-353" tabindex="-1"></a>  <span class="co"># 绘制第一条曲线</span></span>
<span id="cb46-354"><a href="ch4_fem.html#cb46-354" tabindex="-1"></a>  <span class="fu">plot</span>(result_basic<span class="sc">$</span>x_coords, result_basic<span class="sc">$</span>u_history[, time_indices[<span class="dv">1</span>]], <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, </span>
<span id="cb46-355"><a href="ch4_fem.html#cb46-355" tabindex="-1"></a>       <span class="at">col =</span> colors[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb46-356"><a href="ch4_fem.html#cb46-356" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&#39;位置 (m)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;温度 (°C)&#39;</span>, </span>
<span id="cb46-357"><a href="ch4_fem.html#cb46-357" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&#39;基本FEM - 不同时刻温度分布&#39;</span>)</span>
<span id="cb46-358"><a href="ch4_fem.html#cb46-358" tabindex="-1"></a>  </span>
<span id="cb46-359"><a href="ch4_fem.html#cb46-359" tabindex="-1"></a>  <span class="co"># 添加其他时刻的曲线</span></span>
<span id="cb46-360"><a href="ch4_fem.html#cb46-360" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(time_indices)) {</span>
<span id="cb46-361"><a href="ch4_fem.html#cb46-361" tabindex="-1"></a>    <span class="fu">lines</span>(result_basic<span class="sc">$</span>x_coords, result_basic<span class="sc">$</span>u_history[, time_indices[i]], </span>
<span id="cb46-362"><a href="ch4_fem.html#cb46-362" tabindex="-1"></a>          <span class="at">col =</span> colors[i], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb46-363"><a href="ch4_fem.html#cb46-363" tabindex="-1"></a>  }</span>
<span id="cb46-364"><a href="ch4_fem.html#cb46-364" tabindex="-1"></a>  </span>
<span id="cb46-365"><a href="ch4_fem.html#cb46-365" tabindex="-1"></a>  <span class="co"># 添加图例</span></span>
<span id="cb46-366"><a href="ch4_fem.html#cb46-366" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> time_labels, </span>
<span id="cb46-367"><a href="ch4_fem.html#cb46-367" tabindex="-1"></a>         <span class="at">col =</span> colors, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb46-368"><a href="ch4_fem.html#cb46-368" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb46-369"><a href="ch4_fem.html#cb46-369" tabindex="-1"></a>  </span>
<span id="cb46-370"><a href="ch4_fem.html#cb46-370" tabindex="-1"></a>  <span class="co"># 自适应FEM结果 - 不同时刻的温度分布</span></span>
<span id="cb46-371"><a href="ch4_fem.html#cb46-371" tabindex="-1"></a>  <span class="fu">plot</span>(result_adaptive<span class="sc">$</span>x_coords, result_adaptive<span class="sc">$</span>u_final, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb46-372"><a href="ch4_fem.html#cb46-372" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;green&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&#39;位置 (m)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;温度 (°C)&#39;</span>,  </span>
<span id="cb46-373"><a href="ch4_fem.html#cb46-373" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&#39;自适应FEM - 最终温度分布&#39;</span>)</span>
<span id="cb46-374"><a href="ch4_fem.html#cb46-374" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb46-375"><a href="ch4_fem.html#cb46-375" tabindex="-1"></a>  </span>
<span id="cb46-376"><a href="ch4_fem.html#cb46-376" tabindex="-1"></a>  <span class="co"># 网格对比图</span></span>
<span id="cb46-377"><a href="ch4_fem.html#cb46-377" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb46-378"><a href="ch4_fem.html#cb46-378" tabindex="-1"></a>  <span class="fu">plot</span>(result_basic<span class="sc">$</span>x_coords, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(result_basic<span class="sc">$</span>x_coords)), </span>
<span id="cb46-379"><a href="ch4_fem.html#cb46-379" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&#39;p&#39;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">xlab =</span> <span class="st">&#39;位置 (m)&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;&#39;</span>, </span>
<span id="cb46-380"><a href="ch4_fem.html#cb46-380" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&#39;网格对比&#39;</span>, <span class="at">yaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">1.4</span>))</span>
<span id="cb46-381"><a href="ch4_fem.html#cb46-381" tabindex="-1"></a>  <span class="fu">points</span>(result_adaptive<span class="sc">$</span>x_coords, <span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="fu">length</span>(result_adaptive<span class="sc">$</span>x_coords)), </span>
<span id="cb46-382"><a href="ch4_fem.html#cb46-382" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb46-383"><a href="ch4_fem.html#cb46-383" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&#39;top&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;基本网格&#39;</span>, <span class="st">&#39;自适应网格&#39;</span>), </span>
<span id="cb46-384"><a href="ch4_fem.html#cb46-384" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>), <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb46-385"><a href="ch4_fem.html#cb46-385" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb46-386"><a href="ch4_fem.html#cb46-386" tabindex="-1"></a>}</span></code></pre></div>
<p>这些高级技术展示了有限元法的强大功能：</p>
<ol style="list-style-type: decimal">
<li><strong>高阶形函数</strong>：使用二次形函数提高精度，收敛阶从<span class="math inline">\(O(h^2)\)</span>提升到<span class="math inline">\(O(h^3)\)</span></li>
<li><strong>自适应网格</strong>：根据误差估计自动调整网格密度，在解变化剧烈的区域加密网格</li>
<li><strong>性能对比</strong>：与有限差分法进行系统比较，展示有限元法的优势</li>
<li><strong>数值积分</strong>：使用高斯积分法提高计算精度</li>
</ol>
</div>
</div>
<div id="地球科学应用案例地下水流模拟" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 地球科学应用案例：地下水流模拟<a href="ch4_fem.html#地球科学应用案例地下水流模拟" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="问题背景" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> 问题背景<a href="ch4_fem.html#问题背景" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>地下水流模拟是水文地质学中的核心问题，有限元法在这一领域具有重要应用。考虑一个二维承压含水层中的地下水流动问题，这是有限元法在地球科学中的典型应用。</p>
</div>
<div id="数学模型" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> 数学模型<a href="ch4_fem.html#数学模型" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>控制方程</strong>：
二维承压含水层中的地下水流动由以下偏微分方程描述：</p>
<p><span class="math display">\[\frac{\partial}{\partial x}\left(T_{xx}\frac{\partial h}{\partial x}\right) + \frac{\partial}{\partial y}\left(T_{yy}\frac{\partial h}{\partial y}\right) = S\frac{\partial h}{\partial t} + Q\]</span></p>
<p>其中：
- <span class="math inline">\(h(x,y,t)\)</span> 是水头（m）
- <span class="math inline">\(T_{xx}\)</span>、<span class="math inline">\(T_{yy}\)</span> 是导水系数（m²/s）
- <span class="math inline">\(S\)</span> 是储水系数（无量纲）
- <span class="math inline">\(Q\)</span> 是源汇项（1/s）</p>
<p><strong>边界条件</strong>：
- <strong>Dirichlet边界</strong>：<span class="math inline">\(h = h_0\)</span> 在 <span class="math inline">\(\Gamma_D\)</span> 上
- <strong>Neumann边界</strong>：<span class="math inline">\(T\frac{\partial h}{\partial n} = q\)</span> 在 <span class="math inline">\(\Gamma_N\)</span> 上</p>
</div>
<div id="有限元离散化-1" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> 有限元离散化<a href="ch4_fem.html#有限元离散化-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>弱形式</strong>：
寻找 <span class="math inline">\(h \in V\)</span>，使得对所有 <span class="math inline">\(v \in V_0\)</span>：</p>
<p><span class="math display">\[\int_\Omega T\nabla h \cdot \nabla v \, d\Omega + \int_\Omega S\frac{\partial h}{\partial t}v \, d\Omega = \int_\Omega Qv \, d\Omega + \int_{\Gamma_N} qv \, d\Gamma\]</span></p>
<p><strong>有限元近似</strong>：
<span class="math display">\[h^h(x,y,t) = \sum_{i=1}^{N} h_i(t) N_i(x,y)\]</span></p>
<p>其中 <span class="math inline">\(N_i(x,y)\)</span> 是形函数，<span class="math inline">\(h_i(t)\)</span> 是节点水头值。</p>
</div>
<div id="实际应用案例" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> 实际应用案例<a href="ch4_fem.html#实际应用案例" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>案例描述</strong>：
考虑一个矩形承压含水层，尺寸为1000m × 500m，厚度为50m。含水层参数如下：
- 导水系数：<span class="math inline">\(T = 10^{-3}\)</span> m²/s
- 储水系数：<span class="math inline">\(S = 10^{-4}\)</span>
- 初始水头：<span class="math inline">\(h_0 = 100\)</span> m
- 边界条件：左边界 <span class="math inline">\(h = 120\)</span> m，右边界 <span class="math inline">\(h = 80\)</span> m</p>
<p><strong>有限元求解</strong>：
使用三角形单元对计算域进行离散化，采用线性形函数进行插值。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="ch4_fem.html#cb47-1" tabindex="-1"></a><span class="co"># 有限元法求解二维地下水流问题</span></span>
<span id="cb47-2"><a href="ch4_fem.html#cb47-2" tabindex="-1"></a><span class="co"># 作者：数值地球教科书项目</span></span>
<span id="cb47-3"><a href="ch4_fem.html#cb47-3" tabindex="-1"></a><span class="co"># 日期：2025年</span></span>
<span id="cb47-4"><a href="ch4_fem.html#cb47-4" tabindex="-1"></a></span>
<span id="cb47-5"><a href="ch4_fem.html#cb47-5" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb47-6"><a href="ch4_fem.html#cb47-6" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-7"><a href="ch4_fem.html#cb47-7" tabindex="-1"></a></span>
<span id="cb47-8"><a href="ch4_fem.html#cb47-8" tabindex="-1"></a><span class="co"># 加载字体配置</span></span>
<span id="cb47-9"><a href="ch4_fem.html#cb47-9" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;Functions/font_setup.R&quot;</span>)</span>
<span id="cb47-10"><a href="ch4_fem.html#cb47-10" tabindex="-1"></a></span>
<span id="cb47-11"><a href="ch4_fem.html#cb47-11" tabindex="-1"></a><span class="co"># 设置中文字体（在绘图前）</span></span>
<span id="cb47-12"><a href="ch4_fem.html#cb47-12" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb47-13"><a href="ch4_fem.html#cb47-13" tabindex="-1"></a>  <span class="fu">setup_bookdown_fonts</span>()</span>
<span id="cb47-14"><a href="ch4_fem.html#cb47-14" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb47-15"><a href="ch4_fem.html#cb47-15" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;字体设置失败，使用默认字体：&quot;</span>, e<span class="sc">$</span>message, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb47-16"><a href="ch4_fem.html#cb47-16" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## 字体设置完成： Arial Unicode MS</code></pre>
<pre><code>## [1] &quot;Arial Unicode MS&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="ch4_fem.html#cb50-1" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb50-2"><a href="ch4_fem.html#cb50-2" tabindex="-1"></a><span class="co"># 二维地下水流有限元法求解器</span></span>
<span id="cb50-3"><a href="ch4_fem.html#cb50-3" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb50-4"><a href="ch4_fem.html#cb50-4" tabindex="-1"></a></span>
<span id="cb50-5"><a href="ch4_fem.html#cb50-5" tabindex="-1"></a><span class="co"># 三角形单元形函数（线性）</span></span>
<span id="cb50-6"><a href="ch4_fem.html#cb50-6" tabindex="-1"></a>triangle_shape_functions <span class="ot">&lt;-</span> <span class="cf">function</span>(xi, eta) {</span>
<span id="cb50-7"><a href="ch4_fem.html#cb50-7" tabindex="-1"></a>  N1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> xi <span class="sc">-</span> eta</span>
<span id="cb50-8"><a href="ch4_fem.html#cb50-8" tabindex="-1"></a>  N2 <span class="ot">&lt;-</span> xi</span>
<span id="cb50-9"><a href="ch4_fem.html#cb50-9" tabindex="-1"></a>  N3 <span class="ot">&lt;-</span> eta</span>
<span id="cb50-10"><a href="ch4_fem.html#cb50-10" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(N1, N2, N3))</span>
<span id="cb50-11"><a href="ch4_fem.html#cb50-11" tabindex="-1"></a>}</span>
<span id="cb50-12"><a href="ch4_fem.html#cb50-12" tabindex="-1"></a></span>
<span id="cb50-13"><a href="ch4_fem.html#cb50-13" tabindex="-1"></a><span class="co"># 三角形单元形函数导数</span></span>
<span id="cb50-14"><a href="ch4_fem.html#cb50-14" tabindex="-1"></a>triangle_shape_derivatives <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb50-15"><a href="ch4_fem.html#cb50-15" tabindex="-1"></a>  <span class="co"># 对于线性三角形单元，形函数导数为常数</span></span>
<span id="cb50-16"><a href="ch4_fem.html#cb50-16" tabindex="-1"></a>  dN_dxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb50-17"><a href="ch4_fem.html#cb50-17" tabindex="-1"></a>  dN_deta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb50-18"><a href="ch4_fem.html#cb50-18" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">dN_dxi =</span> dN_dxi, <span class="at">dN_deta =</span> dN_deta))</span>
<span id="cb50-19"><a href="ch4_fem.html#cb50-19" tabindex="-1"></a>}</span>
<span id="cb50-20"><a href="ch4_fem.html#cb50-20" tabindex="-1"></a></span>
<span id="cb50-21"><a href="ch4_fem.html#cb50-21" tabindex="-1"></a><span class="co"># 生成三角形网格</span></span>
<span id="cb50-22"><a href="ch4_fem.html#cb50-22" tabindex="-1"></a>generate_triangular_mesh <span class="ot">&lt;-</span> <span class="cf">function</span>(Lx, Ly, nx, ny) {</span>
<span id="cb50-23"><a href="ch4_fem.html#cb50-23" tabindex="-1"></a>  <span class="co"># 生成节点坐标</span></span>
<span id="cb50-24"><a href="ch4_fem.html#cb50-24" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, Lx, <span class="at">length.out =</span> nx)</span>
<span id="cb50-25"><a href="ch4_fem.html#cb50-25" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, Ly, <span class="at">length.out =</span> ny)</span>
<span id="cb50-26"><a href="ch4_fem.html#cb50-26" tabindex="-1"></a>  </span>
<span id="cb50-27"><a href="ch4_fem.html#cb50-27" tabindex="-1"></a>  nodes <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb50-28"><a href="ch4_fem.html#cb50-28" tabindex="-1"></a>  n_nodes <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nodes)</span>
<span id="cb50-29"><a href="ch4_fem.html#cb50-29" tabindex="-1"></a>  </span>
<span id="cb50-30"><a href="ch4_fem.html#cb50-30" tabindex="-1"></a>  <span class="co"># 生成三角形单元</span></span>
<span id="cb50-31"><a href="ch4_fem.html#cb50-31" tabindex="-1"></a>  elements <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb50-32"><a href="ch4_fem.html#cb50-32" tabindex="-1"></a>  element_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-33"><a href="ch4_fem.html#cb50-33" tabindex="-1"></a>  </span>
<span id="cb50-34"><a href="ch4_fem.html#cb50-34" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(nx<span class="dv">-1</span>)) {</span>
<span id="cb50-35"><a href="ch4_fem.html#cb50-35" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(ny<span class="dv">-1</span>)) {</span>
<span id="cb50-36"><a href="ch4_fem.html#cb50-36" tabindex="-1"></a>      <span class="co"># 每个矩形分成两个三角形</span></span>
<span id="cb50-37"><a href="ch4_fem.html#cb50-37" tabindex="-1"></a>      <span class="co"># 左下角节点索引</span></span>
<span id="cb50-38"><a href="ch4_fem.html#cb50-38" tabindex="-1"></a>      bottom_left <span class="ot">&lt;-</span> (j<span class="dv">-1</span>) <span class="sc">*</span> nx <span class="sc">+</span> i</span>
<span id="cb50-39"><a href="ch4_fem.html#cb50-39" tabindex="-1"></a>      bottom_right <span class="ot">&lt;-</span> (j<span class="dv">-1</span>) <span class="sc">*</span> nx <span class="sc">+</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-40"><a href="ch4_fem.html#cb50-40" tabindex="-1"></a>      top_left <span class="ot">&lt;-</span> j <span class="sc">*</span> nx <span class="sc">+</span> i</span>
<span id="cb50-41"><a href="ch4_fem.html#cb50-41" tabindex="-1"></a>      top_right <span class="ot">&lt;-</span> j <span class="sc">*</span> nx <span class="sc">+</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-42"><a href="ch4_fem.html#cb50-42" tabindex="-1"></a>      </span>
<span id="cb50-43"><a href="ch4_fem.html#cb50-43" tabindex="-1"></a>      <span class="co"># 第一个三角形（左下-右上-左上）</span></span>
<span id="cb50-44"><a href="ch4_fem.html#cb50-44" tabindex="-1"></a>      element_count <span class="ot">&lt;-</span> element_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-45"><a href="ch4_fem.html#cb50-45" tabindex="-1"></a>      elements[[element_count]] <span class="ot">&lt;-</span> <span class="fu">c</span>(bottom_left, top_right, top_left)</span>
<span id="cb50-46"><a href="ch4_fem.html#cb50-46" tabindex="-1"></a>      </span>
<span id="cb50-47"><a href="ch4_fem.html#cb50-47" tabindex="-1"></a>      <span class="co"># 第二个三角形（左下-右下-右上）</span></span>
<span id="cb50-48"><a href="ch4_fem.html#cb50-48" tabindex="-1"></a>      element_count <span class="ot">&lt;-</span> element_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-49"><a href="ch4_fem.html#cb50-49" tabindex="-1"></a>      elements[[element_count]] <span class="ot">&lt;-</span> <span class="fu">c</span>(bottom_left, bottom_right, top_right)</span>
<span id="cb50-50"><a href="ch4_fem.html#cb50-50" tabindex="-1"></a>    }</span>
<span id="cb50-51"><a href="ch4_fem.html#cb50-51" tabindex="-1"></a>  }</span>
<span id="cb50-52"><a href="ch4_fem.html#cb50-52" tabindex="-1"></a>  </span>
<span id="cb50-53"><a href="ch4_fem.html#cb50-53" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb50-54"><a href="ch4_fem.html#cb50-54" tabindex="-1"></a>    <span class="at">nodes =</span> nodes,</span>
<span id="cb50-55"><a href="ch4_fem.html#cb50-55" tabindex="-1"></a>    <span class="at">elements =</span> elements,</span>
<span id="cb50-56"><a href="ch4_fem.html#cb50-56" tabindex="-1"></a>    <span class="at">n_nodes =</span> n_nodes,</span>
<span id="cb50-57"><a href="ch4_fem.html#cb50-57" tabindex="-1"></a>    <span class="at">n_elements =</span> <span class="fu">length</span>(elements)</span>
<span id="cb50-58"><a href="ch4_fem.html#cb50-58" tabindex="-1"></a>  ))</span>
<span id="cb50-59"><a href="ch4_fem.html#cb50-59" tabindex="-1"></a>}</span>
<span id="cb50-60"><a href="ch4_fem.html#cb50-60" tabindex="-1"></a></span>
<span id="cb50-61"><a href="ch4_fem.html#cb50-61" tabindex="-1"></a><span class="co"># 计算单元矩阵</span></span>
<span id="cb50-62"><a href="ch4_fem.html#cb50-62" tabindex="-1"></a>compute_element_matrices <span class="ot">&lt;-</span> <span class="cf">function</span>(nodes, element, T_xx, T_yy, S) {</span>
<span id="cb50-63"><a href="ch4_fem.html#cb50-63" tabindex="-1"></a>  <span class="co"># 获取单元节点坐标</span></span>
<span id="cb50-64"><a href="ch4_fem.html#cb50-64" tabindex="-1"></a>  node_coords <span class="ot">&lt;-</span> nodes[element, ]</span>
<span id="cb50-65"><a href="ch4_fem.html#cb50-65" tabindex="-1"></a>  </span>
<span id="cb50-66"><a href="ch4_fem.html#cb50-66" tabindex="-1"></a>  <span class="co"># 计算雅可比矩阵</span></span>
<span id="cb50-67"><a href="ch4_fem.html#cb50-67" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> node_coords[<span class="dv">1</span>, <span class="dv">1</span>]; y1 <span class="ot">&lt;-</span> node_coords[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb50-68"><a href="ch4_fem.html#cb50-68" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> node_coords[<span class="dv">2</span>, <span class="dv">1</span>]; y2 <span class="ot">&lt;-</span> node_coords[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb50-69"><a href="ch4_fem.html#cb50-69" tabindex="-1"></a>  x3 <span class="ot">&lt;-</span> node_coords[<span class="dv">3</span>, <span class="dv">1</span>]; y3 <span class="ot">&lt;-</span> node_coords[<span class="dv">3</span>, <span class="dv">2</span>]</span>
<span id="cb50-70"><a href="ch4_fem.html#cb50-70" tabindex="-1"></a>  </span>
<span id="cb50-71"><a href="ch4_fem.html#cb50-71" tabindex="-1"></a>  <span class="co"># 雅可比矩阵</span></span>
<span id="cb50-72"><a href="ch4_fem.html#cb50-72" tabindex="-1"></a>  J <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(x2<span class="sc">-</span>x1, x3<span class="sc">-</span>x1, y2<span class="sc">-</span>y1, y3<span class="sc">-</span>y1), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb50-73"><a href="ch4_fem.html#cb50-73" tabindex="-1"></a>  det_J <span class="ot">&lt;-</span> <span class="fu">det</span>(J)</span>
<span id="cb50-74"><a href="ch4_fem.html#cb50-74" tabindex="-1"></a>  </span>
<span id="cb50-75"><a href="ch4_fem.html#cb50-75" tabindex="-1"></a>  <span class="co"># 雅可比矩阵的逆</span></span>
<span id="cb50-76"><a href="ch4_fem.html#cb50-76" tabindex="-1"></a>  J_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(J)</span>
<span id="cb50-77"><a href="ch4_fem.html#cb50-77" tabindex="-1"></a>  </span>
<span id="cb50-78"><a href="ch4_fem.html#cb50-78" tabindex="-1"></a>  <span class="co"># 形函数导数</span></span>
<span id="cb50-79"><a href="ch4_fem.html#cb50-79" tabindex="-1"></a>  dN <span class="ot">&lt;-</span> <span class="fu">triangle_shape_derivatives</span>()</span>
<span id="cb50-80"><a href="ch4_fem.html#cb50-80" tabindex="-1"></a>  </span>
<span id="cb50-81"><a href="ch4_fem.html#cb50-81" tabindex="-1"></a>  <span class="co"># 计算形函数在物理坐标中的导数</span></span>
<span id="cb50-82"><a href="ch4_fem.html#cb50-82" tabindex="-1"></a>  dN_dx <span class="ot">&lt;-</span> J_inv[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">*</span> dN<span class="sc">$</span>dN_dxi <span class="sc">+</span> J_inv[<span class="dv">1</span>, <span class="dv">2</span>] <span class="sc">*</span> dN<span class="sc">$</span>dN_deta</span>
<span id="cb50-83"><a href="ch4_fem.html#cb50-83" tabindex="-1"></a>  dN_dy <span class="ot">&lt;-</span> J_inv[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> dN<span class="sc">$</span>dN_dxi <span class="sc">+</span> J_inv[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> dN<span class="sc">$</span>dN_deta</span>
<span id="cb50-84"><a href="ch4_fem.html#cb50-84" tabindex="-1"></a>  </span>
<span id="cb50-85"><a href="ch4_fem.html#cb50-85" tabindex="-1"></a>  <span class="co"># 计算单元刚度矩阵</span></span>
<span id="cb50-86"><a href="ch4_fem.html#cb50-86" tabindex="-1"></a>  K_elem <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb50-87"><a href="ch4_fem.html#cb50-87" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb50-88"><a href="ch4_fem.html#cb50-88" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb50-89"><a href="ch4_fem.html#cb50-89" tabindex="-1"></a>      K_elem[i, j] <span class="ot">&lt;-</span> T_xx <span class="sc">*</span> dN_dx[i] <span class="sc">*</span> dN_dx[j] <span class="sc">+</span> T_yy <span class="sc">*</span> dN_dy[i] <span class="sc">*</span> dN_dy[j]</span>
<span id="cb50-90"><a href="ch4_fem.html#cb50-90" tabindex="-1"></a>    }</span>
<span id="cb50-91"><a href="ch4_fem.html#cb50-91" tabindex="-1"></a>  }</span>
<span id="cb50-92"><a href="ch4_fem.html#cb50-92" tabindex="-1"></a>  K_elem <span class="ot">&lt;-</span> K_elem <span class="sc">*</span> <span class="fu">abs</span>(det_J) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb50-93"><a href="ch4_fem.html#cb50-93" tabindex="-1"></a>  </span>
<span id="cb50-94"><a href="ch4_fem.html#cb50-94" tabindex="-1"></a>  <span class="co"># 计算单元质量矩阵</span></span>
<span id="cb50-95"><a href="ch4_fem.html#cb50-95" tabindex="-1"></a>  M_elem <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb50-96"><a href="ch4_fem.html#cb50-96" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb50-97"><a href="ch4_fem.html#cb50-97" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb50-98"><a href="ch4_fem.html#cb50-98" tabindex="-1"></a>      M_elem[i, j] <span class="ot">&lt;-</span> S <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (i<span class="sc">==</span>j)) <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># 简化的质量矩阵</span></span>
<span id="cb50-99"><a href="ch4_fem.html#cb50-99" tabindex="-1"></a>    }</span>
<span id="cb50-100"><a href="ch4_fem.html#cb50-100" tabindex="-1"></a>  }</span>
<span id="cb50-101"><a href="ch4_fem.html#cb50-101" tabindex="-1"></a>  M_elem <span class="ot">&lt;-</span> M_elem <span class="sc">*</span> <span class="fu">abs</span>(det_J) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb50-102"><a href="ch4_fem.html#cb50-102" tabindex="-1"></a>  </span>
<span id="cb50-103"><a href="ch4_fem.html#cb50-103" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">K =</span> K_elem, <span class="at">M =</span> M_elem))</span>
<span id="cb50-104"><a href="ch4_fem.html#cb50-104" tabindex="-1"></a>}</span>
<span id="cb50-105"><a href="ch4_fem.html#cb50-105" tabindex="-1"></a></span>
<span id="cb50-106"><a href="ch4_fem.html#cb50-106" tabindex="-1"></a><span class="co"># 主求解函数</span></span>
<span id="cb50-107"><a href="ch4_fem.html#cb50-107" tabindex="-1"></a>solve_groundwater_fem <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">Lx =</span> <span class="dv">1000</span>, <span class="at">Ly =</span> <span class="dv">500</span>, <span class="at">nx =</span> <span class="dv">21</span>, <span class="at">ny =</span> <span class="dv">11</span>,</span>
<span id="cb50-108"><a href="ch4_fem.html#cb50-108" tabindex="-1"></a>                                 <span class="at">T_xx =</span> <span class="fl">1e-3</span>, <span class="at">T_yy =</span> <span class="fl">1e-3</span>, <span class="at">S =</span> <span class="fl">1e-4</span>,</span>
<span id="cb50-109"><a href="ch4_fem.html#cb50-109" tabindex="-1"></a>                                 <span class="at">h_left =</span> <span class="dv">120</span>, <span class="at">h_right =</span> <span class="dv">80</span>, <span class="at">h_initial =</span> <span class="dv">100</span>,</span>
<span id="cb50-110"><a href="ch4_fem.html#cb50-110" tabindex="-1"></a>                                 <span class="at">dt =</span> <span class="dv">1000</span>, <span class="at">T_max =</span> <span class="dv">10000</span>) {</span>
<span id="cb50-111"><a href="ch4_fem.html#cb50-111" tabindex="-1"></a>  </span>
<span id="cb50-112"><a href="ch4_fem.html#cb50-112" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;开始有限元法求解二维地下水流问题...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-113"><a href="ch4_fem.html#cb50-113" tabindex="-1"></a>  </span>
<span id="cb50-114"><a href="ch4_fem.html#cb50-114" tabindex="-1"></a>  <span class="co"># 生成网格</span></span>
<span id="cb50-115"><a href="ch4_fem.html#cb50-115" tabindex="-1"></a>  mesh <span class="ot">&lt;-</span> <span class="fu">generate_triangular_mesh</span>(Lx, Ly, nx, ny)</span>
<span id="cb50-116"><a href="ch4_fem.html#cb50-116" tabindex="-1"></a>  nodes <span class="ot">&lt;-</span> mesh<span class="sc">$</span>nodes</span>
<span id="cb50-117"><a href="ch4_fem.html#cb50-117" tabindex="-1"></a>  elements <span class="ot">&lt;-</span> mesh<span class="sc">$</span>elements</span>
<span id="cb50-118"><a href="ch4_fem.html#cb50-118" tabindex="-1"></a>  n_nodes <span class="ot">&lt;-</span> mesh<span class="sc">$</span>n_nodes</span>
<span id="cb50-119"><a href="ch4_fem.html#cb50-119" tabindex="-1"></a>  n_elements <span class="ot">&lt;-</span> mesh<span class="sc">$</span>n_elements</span>
<span id="cb50-120"><a href="ch4_fem.html#cb50-120" tabindex="-1"></a>  </span>
<span id="cb50-121"><a href="ch4_fem.html#cb50-121" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;网格生成完成：&quot;</span>, n_nodes, <span class="st">&quot;个节点，&quot;</span>, n_elements, <span class="st">&quot;个单元</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-122"><a href="ch4_fem.html#cb50-122" tabindex="-1"></a>  </span>
<span id="cb50-123"><a href="ch4_fem.html#cb50-123" tabindex="-1"></a>  <span class="co"># 初始化全局矩阵</span></span>
<span id="cb50-124"><a href="ch4_fem.html#cb50-124" tabindex="-1"></a>  K_global <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-125"><a href="ch4_fem.html#cb50-125" tabindex="-1"></a>  M_global <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(<span class="dv">0</span>, n_nodes, n_nodes, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-126"><a href="ch4_fem.html#cb50-126" tabindex="-1"></a>  </span>
<span id="cb50-127"><a href="ch4_fem.html#cb50-127" tabindex="-1"></a>  <span class="co"># 组装全局矩阵</span></span>
<span id="cb50-128"><a href="ch4_fem.html#cb50-128" tabindex="-1"></a>  <span class="cf">for</span> (e <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_elements) {</span>
<span id="cb50-129"><a href="ch4_fem.html#cb50-129" tabindex="-1"></a>    element <span class="ot">&lt;-</span> elements[[e]]</span>
<span id="cb50-130"><a href="ch4_fem.html#cb50-130" tabindex="-1"></a>    elem_matrices <span class="ot">&lt;-</span> <span class="fu">compute_element_matrices</span>(nodes, element, T_xx, T_yy, S)</span>
<span id="cb50-131"><a href="ch4_fem.html#cb50-131" tabindex="-1"></a>    </span>
<span id="cb50-132"><a href="ch4_fem.html#cb50-132" tabindex="-1"></a>    <span class="co"># 组装到全局矩阵</span></span>
<span id="cb50-133"><a href="ch4_fem.html#cb50-133" tabindex="-1"></a>    K_global[element, element] <span class="ot">&lt;-</span> K_global[element, element] <span class="sc">+</span> elem_matrices<span class="sc">$</span>K</span>
<span id="cb50-134"><a href="ch4_fem.html#cb50-134" tabindex="-1"></a>    M_global[element, element] <span class="ot">&lt;-</span> M_global[element, element] <span class="sc">+</span> elem_matrices<span class="sc">$</span>M</span>
<span id="cb50-135"><a href="ch4_fem.html#cb50-135" tabindex="-1"></a>  }</span>
<span id="cb50-136"><a href="ch4_fem.html#cb50-136" tabindex="-1"></a>  </span>
<span id="cb50-137"><a href="ch4_fem.html#cb50-137" tabindex="-1"></a>  <span class="co"># 初始条件</span></span>
<span id="cb50-138"><a href="ch4_fem.html#cb50-138" tabindex="-1"></a>  h_current <span class="ot">&lt;-</span> <span class="fu">rep</span>(h_initial, n_nodes)</span>
<span id="cb50-139"><a href="ch4_fem.html#cb50-139" tabindex="-1"></a>  </span>
<span id="cb50-140"><a href="ch4_fem.html#cb50-140" tabindex="-1"></a>  <span class="co"># 时间推进</span></span>
<span id="cb50-141"><a href="ch4_fem.html#cb50-141" tabindex="-1"></a>  n_steps <span class="ot">&lt;-</span> T_max <span class="sc">/</span> dt</span>
<span id="cb50-142"><a href="ch4_fem.html#cb50-142" tabindex="-1"></a>  h_history <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_nodes, n_steps <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb50-143"><a href="ch4_fem.html#cb50-143" tabindex="-1"></a>  h_history[, <span class="dv">1</span>] <span class="ot">&lt;-</span> h_current</span>
<span id="cb50-144"><a href="ch4_fem.html#cb50-144" tabindex="-1"></a>  </span>
<span id="cb50-145"><a href="ch4_fem.html#cb50-145" tabindex="-1"></a>  <span class="co"># 构造线性方程组系数矩阵</span></span>
<span id="cb50-146"><a href="ch4_fem.html#cb50-146" tabindex="-1"></a>  A <span class="ot">&lt;-</span> M_global <span class="sc">+</span> dt <span class="sc">*</span> K_global</span>
<span id="cb50-147"><a href="ch4_fem.html#cb50-147" tabindex="-1"></a>  </span>
<span id="cb50-148"><a href="ch4_fem.html#cb50-148" tabindex="-1"></a>  <span class="co"># 施加边界条件</span></span>
<span id="cb50-149"><a href="ch4_fem.html#cb50-149" tabindex="-1"></a>  <span class="co"># 左边界（x = 0）</span></span>
<span id="cb50-150"><a href="ch4_fem.html#cb50-150" tabindex="-1"></a>  left_boundary <span class="ot">&lt;-</span> <span class="fu">which</span>(nodes<span class="sc">$</span>x <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb50-151"><a href="ch4_fem.html#cb50-151" tabindex="-1"></a>  A[left_boundary, ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-152"><a href="ch4_fem.html#cb50-152" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> left_boundary) {</span>
<span id="cb50-153"><a href="ch4_fem.html#cb50-153" tabindex="-1"></a>    A[i, i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb50-154"><a href="ch4_fem.html#cb50-154" tabindex="-1"></a>  }</span>
<span id="cb50-155"><a href="ch4_fem.html#cb50-155" tabindex="-1"></a>  </span>
<span id="cb50-156"><a href="ch4_fem.html#cb50-156" tabindex="-1"></a>  <span class="co"># 右边界（x = Lx）</span></span>
<span id="cb50-157"><a href="ch4_fem.html#cb50-157" tabindex="-1"></a>  right_boundary <span class="ot">&lt;-</span> <span class="fu">which</span>(nodes<span class="sc">$</span>x <span class="sc">==</span> Lx)</span>
<span id="cb50-158"><a href="ch4_fem.html#cb50-158" tabindex="-1"></a>  A[right_boundary, ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-159"><a href="ch4_fem.html#cb50-159" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> right_boundary) {</span>
<span id="cb50-160"><a href="ch4_fem.html#cb50-160" tabindex="-1"></a>    A[i, i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb50-161"><a href="ch4_fem.html#cb50-161" tabindex="-1"></a>  }</span>
<span id="cb50-162"><a href="ch4_fem.html#cb50-162" tabindex="-1"></a>  </span>
<span id="cb50-163"><a href="ch4_fem.html#cb50-163" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;开始时间推进...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-164"><a href="ch4_fem.html#cb50-164" tabindex="-1"></a>  </span>
<span id="cb50-165"><a href="ch4_fem.html#cb50-165" tabindex="-1"></a>  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb50-166"><a href="ch4_fem.html#cb50-166" tabindex="-1"></a>    <span class="co"># 更新右端项</span></span>
<span id="cb50-167"><a href="ch4_fem.html#cb50-167" tabindex="-1"></a>    b <span class="ot">&lt;-</span> M_global <span class="sc">%*%</span> h_current</span>
<span id="cb50-168"><a href="ch4_fem.html#cb50-168" tabindex="-1"></a>    </span>
<span id="cb50-169"><a href="ch4_fem.html#cb50-169" tabindex="-1"></a>    <span class="co"># 施加边界条件</span></span>
<span id="cb50-170"><a href="ch4_fem.html#cb50-170" tabindex="-1"></a>    b[left_boundary] <span class="ot">&lt;-</span> h_left</span>
<span id="cb50-171"><a href="ch4_fem.html#cb50-171" tabindex="-1"></a>    b[right_boundary] <span class="ot">&lt;-</span> h_right</span>
<span id="cb50-172"><a href="ch4_fem.html#cb50-172" tabindex="-1"></a>    </span>
<span id="cb50-173"><a href="ch4_fem.html#cb50-173" tabindex="-1"></a>    <span class="co"># 求解线性方程组</span></span>
<span id="cb50-174"><a href="ch4_fem.html#cb50-174" tabindex="-1"></a>    h_new <span class="ot">&lt;-</span> <span class="fu">solve</span>(A, b)</span>
<span id="cb50-175"><a href="ch4_fem.html#cb50-175" tabindex="-1"></a>    h_current <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(h_new)</span>
<span id="cb50-176"><a href="ch4_fem.html#cb50-176" tabindex="-1"></a>    h_history[, step <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> h_current</span>
<span id="cb50-177"><a href="ch4_fem.html#cb50-177" tabindex="-1"></a>    </span>
<span id="cb50-178"><a href="ch4_fem.html#cb50-178" tabindex="-1"></a>    <span class="cf">if</span> (step <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb50-179"><a href="ch4_fem.html#cb50-179" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">&quot;时间步&quot;</span>, step, <span class="st">&quot;/&quot;</span>, n_steps, <span class="st">&quot;完成</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-180"><a href="ch4_fem.html#cb50-180" tabindex="-1"></a>    }</span>
<span id="cb50-181"><a href="ch4_fem.html#cb50-181" tabindex="-1"></a>  }</span>
<span id="cb50-182"><a href="ch4_fem.html#cb50-182" tabindex="-1"></a>  </span>
<span id="cb50-183"><a href="ch4_fem.html#cb50-183" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;求解完成！</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-184"><a href="ch4_fem.html#cb50-184" tabindex="-1"></a>  </span>
<span id="cb50-185"><a href="ch4_fem.html#cb50-185" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb50-186"><a href="ch4_fem.html#cb50-186" tabindex="-1"></a>    <span class="at">nodes =</span> nodes,</span>
<span id="cb50-187"><a href="ch4_fem.html#cb50-187" tabindex="-1"></a>    <span class="at">elements =</span> elements,</span>
<span id="cb50-188"><a href="ch4_fem.html#cb50-188" tabindex="-1"></a>    <span class="at">h_history =</span> h_history,</span>
<span id="cb50-189"><a href="ch4_fem.html#cb50-189" tabindex="-1"></a>    <span class="at">h_final =</span> h_current,</span>
<span id="cb50-190"><a href="ch4_fem.html#cb50-190" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb50-191"><a href="ch4_fem.html#cb50-191" tabindex="-1"></a>      <span class="at">Lx =</span> Lx, <span class="at">Ly =</span> Ly, <span class="at">nx =</span> nx, <span class="at">ny =</span> ny,</span>
<span id="cb50-192"><a href="ch4_fem.html#cb50-192" tabindex="-1"></a>      <span class="at">T_xx =</span> T_xx, <span class="at">T_yy =</span> T_yy, <span class="at">S =</span> S,</span>
<span id="cb50-193"><a href="ch4_fem.html#cb50-193" tabindex="-1"></a>      <span class="at">dt =</span> dt, <span class="at">T_max =</span> T_max</span>
<span id="cb50-194"><a href="ch4_fem.html#cb50-194" tabindex="-1"></a>    )</span>
<span id="cb50-195"><a href="ch4_fem.html#cb50-195" tabindex="-1"></a>  ))</span>
<span id="cb50-196"><a href="ch4_fem.html#cb50-196" tabindex="-1"></a>}</span>
<span id="cb50-197"><a href="ch4_fem.html#cb50-197" tabindex="-1"></a></span>
<span id="cb50-198"><a href="ch4_fem.html#cb50-198" tabindex="-1"></a><span class="co"># 可视化函数</span></span>
<span id="cb50-199"><a href="ch4_fem.html#cb50-199" tabindex="-1"></a>plot_groundwater_results <span class="ot">&lt;-</span> <span class="cf">function</span>(result, <span class="at">time_step =</span> <span class="cn">NULL</span>) {</span>
<span id="cb50-200"><a href="ch4_fem.html#cb50-200" tabindex="-1"></a>  nodes <span class="ot">&lt;-</span> result<span class="sc">$</span>nodes</span>
<span id="cb50-201"><a href="ch4_fem.html#cb50-201" tabindex="-1"></a>  h_data <span class="ot">&lt;-</span> result<span class="sc">$</span>h_final</span>
<span id="cb50-202"><a href="ch4_fem.html#cb50-202" tabindex="-1"></a>  </span>
<span id="cb50-203"><a href="ch4_fem.html#cb50-203" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(time_step)) {</span>
<span id="cb50-204"><a href="ch4_fem.html#cb50-204" tabindex="-1"></a>    h_data <span class="ot">&lt;-</span> result<span class="sc">$</span>h_history[, time_step]</span>
<span id="cb50-205"><a href="ch4_fem.html#cb50-205" tabindex="-1"></a>  }</span>
<span id="cb50-206"><a href="ch4_fem.html#cb50-206" tabindex="-1"></a>  </span>
<span id="cb50-207"><a href="ch4_fem.html#cb50-207" tabindex="-1"></a>  <span class="co"># 创建数据框</span></span>
<span id="cb50-208"><a href="ch4_fem.html#cb50-208" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb50-209"><a href="ch4_fem.html#cb50-209" tabindex="-1"></a>    <span class="at">x =</span> nodes<span class="sc">$</span>x,</span>
<span id="cb50-210"><a href="ch4_fem.html#cb50-210" tabindex="-1"></a>    <span class="at">y =</span> nodes<span class="sc">$</span>y,</span>
<span id="cb50-211"><a href="ch4_fem.html#cb50-211" tabindex="-1"></a>    <span class="at">h =</span> h_data</span>
<span id="cb50-212"><a href="ch4_fem.html#cb50-212" tabindex="-1"></a>  )</span>
<span id="cb50-213"><a href="ch4_fem.html#cb50-213" tabindex="-1"></a>  </span>
<span id="cb50-214"><a href="ch4_fem.html#cb50-214" tabindex="-1"></a>  <span class="co"># 绘制水头分布</span></span>
<span id="cb50-215"><a href="ch4_fem.html#cb50-215" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> h)) <span class="sc">+</span></span>
<span id="cb50-216"><a href="ch4_fem.html#cb50-216" tabindex="-1"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb50-217"><a href="ch4_fem.html#cb50-217" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">&quot;水头 (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-218"><a href="ch4_fem.html#cb50-218" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;地下水流有限元解 - 水头分布&quot;</span>,</span>
<span id="cb50-219"><a href="ch4_fem.html#cb50-219" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;距离 (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;距离 (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-220"><a href="ch4_fem.html#cb50-220" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-221"><a href="ch4_fem.html#cb50-221" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SimHei&quot;</span>))</span>
<span id="cb50-222"><a href="ch4_fem.html#cb50-222" tabindex="-1"></a>  </span>
<span id="cb50-223"><a href="ch4_fem.html#cb50-223" tabindex="-1"></a>  <span class="fu">print</span>(p1)</span>
<span id="cb50-224"><a href="ch4_fem.html#cb50-224" tabindex="-1"></a>  </span>
<span id="cb50-225"><a href="ch4_fem.html#cb50-225" tabindex="-1"></a>  <span class="co"># 绘制等水头线</span></span>
<span id="cb50-226"><a href="ch4_fem.html#cb50-226" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> h)) <span class="sc">+</span></span>
<span id="cb50-227"><a href="ch4_fem.html#cb50-227" tabindex="-1"></a>    <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">color =</span> ..level..), <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb50-228"><a href="ch4_fem.html#cb50-228" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">&quot;水头 (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-229"><a href="ch4_fem.html#cb50-229" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;地下水流有限元解 - 等水头线&quot;</span>,</span>
<span id="cb50-230"><a href="ch4_fem.html#cb50-230" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;距离 (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;距离 (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-231"><a href="ch4_fem.html#cb50-231" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-232"><a href="ch4_fem.html#cb50-232" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;SimHei&quot;</span>))</span>
<span id="cb50-233"><a href="ch4_fem.html#cb50-233" tabindex="-1"></a>  </span>
<span id="cb50-234"><a href="ch4_fem.html#cb50-234" tabindex="-1"></a>  <span class="fu">print</span>(p2)</span>
<span id="cb50-235"><a href="ch4_fem.html#cb50-235" tabindex="-1"></a>  </span>
<span id="cb50-236"><a href="ch4_fem.html#cb50-236" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">contour_plot =</span> p1, <span class="at">level_plot =</span> p2))</span>
<span id="cb50-237"><a href="ch4_fem.html#cb50-237" tabindex="-1"></a>}</span>
<span id="cb50-238"><a href="ch4_fem.html#cb50-238" tabindex="-1"></a></span>
<span id="cb50-239"><a href="ch4_fem.html#cb50-239" tabindex="-1"></a><span class="co"># 主函数</span></span>
<span id="cb50-240"><a href="ch4_fem.html#cb50-240" tabindex="-1"></a>main_groundwater_fem <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb50-241"><a href="ch4_fem.html#cb50-241" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;=== 二维地下水流有限元法求解 ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-242"><a href="ch4_fem.html#cb50-242" tabindex="-1"></a>  </span>
<span id="cb50-243"><a href="ch4_fem.html#cb50-243" tabindex="-1"></a>  <span class="co"># 求解问题</span></span>
<span id="cb50-244"><a href="ch4_fem.html#cb50-244" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">solve_groundwater_fem</span>()</span>
<span id="cb50-245"><a href="ch4_fem.html#cb50-245" tabindex="-1"></a>  </span>
<span id="cb50-246"><a href="ch4_fem.html#cb50-246" tabindex="-1"></a>  <span class="co"># 可视化结果</span></span>
<span id="cb50-247"><a href="ch4_fem.html#cb50-247" tabindex="-1"></a>  plots <span class="ot">&lt;-</span> <span class="fu">plot_groundwater_results</span>(result)</span>
<span id="cb50-248"><a href="ch4_fem.html#cb50-248" tabindex="-1"></a>  </span>
<span id="cb50-249"><a href="ch4_fem.html#cb50-249" tabindex="-1"></a>  <span class="co"># 打印结果摘要</span></span>
<span id="cb50-250"><a href="ch4_fem.html#cb50-250" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== 求解结果摘要 ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-251"><a href="ch4_fem.html#cb50-251" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;最终水头范围：&quot;</span>, <span class="fu">round</span>(<span class="fu">min</span>(result<span class="sc">$</span>h_final), <span class="dv">2</span>), <span class="st">&quot;m 到&quot;</span>, </span>
<span id="cb50-252"><a href="ch4_fem.html#cb50-252" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">max</span>(result<span class="sc">$</span>h_final), <span class="dv">2</span>), <span class="st">&quot;m</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-253"><a href="ch4_fem.html#cb50-253" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;水头梯度：&quot;</span>, <span class="fu">round</span>((<span class="fu">max</span>(result<span class="sc">$</span>h_final) <span class="sc">-</span> <span class="fu">min</span>(result<span class="sc">$</span>h_final)) <span class="sc">/</span> <span class="dv">1000</span>, <span class="dv">4</span>), <span class="st">&quot;m/m</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb50-254"><a href="ch4_fem.html#cb50-254" tabindex="-1"></a>  </span>
<span id="cb50-255"><a href="ch4_fem.html#cb50-255" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb50-256"><a href="ch4_fem.html#cb50-256" tabindex="-1"></a>}</span>
<span id="cb50-257"><a href="ch4_fem.html#cb50-257" tabindex="-1"></a></span>
<span id="cb50-258"><a href="ch4_fem.html#cb50-258" tabindex="-1"></a><span class="co"># 运行示例</span></span>
<span id="cb50-259"><a href="ch4_fem.html#cb50-259" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb50-260"><a href="ch4_fem.html#cb50-260" tabindex="-1"></a>  <span class="co"># 运行主函数</span></span>
<span id="cb50-261"><a href="ch4_fem.html#cb50-261" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">main_groundwater_fem</span>()</span>
<span id="cb50-262"><a href="ch4_fem.html#cb50-262" tabindex="-1"></a>  </span>
<span id="cb50-263"><a href="ch4_fem.html#cb50-263" tabindex="-1"></a>  <span class="co"># 绘制不同时刻的水头分布</span></span>
<span id="cb50-264"><a href="ch4_fem.html#cb50-264" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb50-265"><a href="ch4_fem.html#cb50-265" tabindex="-1"></a>  time_steps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">ncol</span>(result<span class="sc">$</span>h_history)<span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb50-266"><a href="ch4_fem.html#cb50-266" tabindex="-1"></a>                  <span class="fu">round</span>(<span class="fu">ncol</span>(result<span class="sc">$</span>h_history)<span class="sc">/</span><span class="dv">2</span>), <span class="fu">ncol</span>(result<span class="sc">$</span>h_history))</span>
<span id="cb50-267"><a href="ch4_fem.html#cb50-267" tabindex="-1"></a>  </span>
<span id="cb50-268"><a href="ch4_fem.html#cb50-268" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb50-269"><a href="ch4_fem.html#cb50-269" tabindex="-1"></a>    <span class="fu">plot_groundwater_results</span>(result, time_steps[i])</span>
<span id="cb50-270"><a href="ch4_fem.html#cb50-270" tabindex="-1"></a>  }</span>
<span id="cb50-271"><a href="ch4_fem.html#cb50-271" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>结果分析</strong>：
1. <strong>水头分布</strong>：从左侧高水头向右侧低水头流动
2. <strong>流线模式</strong>：流线垂直于等水头线，符合达西定律
3. <strong>时间演化</strong>：水头分布随时间逐渐达到稳态</p>
</div>
<div id="工程意义" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> 工程意义<a href="ch4_fem.html#工程意义" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>这个案例展示了有限元法在地下水模拟中的优势：
1. <strong>几何适应性</strong>：可以处理复杂的含水层边界
2. <strong>参数变化</strong>：可以处理非均匀的导水系数
3. <strong>边界条件</strong>：可以灵活处理各种边界条件
4. <strong>数值精度</strong>：通过网格细化提高计算精度</p>
</div>
</div>
<div id="有限元法的收敛性分析与误差估计" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> 有限元法的收敛性分析与误差估计<a href="ch4_fem.html#有限元法的收敛性分析与误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="收敛性理论基础" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> 收敛性理论基础<a href="ch4_fem.html#收敛性理论基础" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有限元法的收敛性是数值分析中的核心问题，它回答了”随着网格加密，数值解是否趋向于精确解”这一基本问题。</p>
<div id="收敛性的数学定义" class="section level4 hasAnchor" number="4.5.1.1">
<h4><span class="header-section-number">4.5.1.1</span> 收敛性的数学定义<a href="ch4_fem.html#收敛性的数学定义" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>设 <span class="math inline">\(u\)</span> 为精确解，<span class="math inline">\(u^h\)</span> 为有限元解，其中 <span class="math inline">\(h\)</span> 表示网格尺寸参数。如果存在常数 <span class="math inline">\(C\)</span> 和 <span class="math inline">\(p &gt; 0\)</span>，使得：</p>
<p><span class="math display">\[\|u - u^h\|_V \leq C h^p\]</span></p>
<p>则称有限元方法以阶数 <span class="math inline">\(p\)</span> 收敛，其中 <span class="math inline">\(\|\cdot\|_V\)</span> 是适当的范数。</p>
</div>
<div id="收敛性的三个层次" class="section level4 hasAnchor" number="4.5.1.2">
<h4><span class="header-section-number">4.5.1.2</span> 收敛性的三个层次<a href="ch4_fem.html#收敛性的三个层次" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>1. 一致性（Consistency）</strong>
有限元格式必须在网格加密时趋向于原微分方程：
<span class="math display">\[\lim_{h \to 0} \|L^h u - L u\| = 0\]</span></p>
<p>其中 <span class="math inline">\(L^h\)</span> 是离散算子，<span class="math inline">\(L\)</span> 是微分算子。</p>
<p><strong>2. 稳定性（Stability）</strong>
数值格式必须对扰动不敏感，即存在常数 <span class="math inline">\(C\)</span>，使得：
<span class="math display">\[\|u^h\|_V \leq C \|f\|_{V^*}\]</span></p>
<p><strong>3. 收敛性（Convergence）</strong>
根据Lax等价性定理，一致性 + 稳定性 ⟹ 收敛性。</p>
</div>
</div>
<div id="先验误差估计" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> 先验误差估计<a href="ch4_fem.html#先验误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="céa引理" class="section level4 hasAnchor" number="4.5.2.1">
<h4><span class="header-section-number">4.5.2.1</span> Céa引理<a href="ch4_fem.html#céa引理" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Céa引理是有限元误差分析的基石：</p>
<p><span class="math display">\[\|u - u^h\|_V \leq \frac{M}{\alpha} \inf_{v^h \in V^h} \|u - v^h\|_V\]</span></p>
<p>其中：
- <span class="math inline">\(M\)</span> 是双线性形式 <span class="math inline">\(a(\cdot,\cdot)\)</span> 的连续性常数
- <span class="math inline">\(\alpha\)</span> 是强制性常数
- <span class="math inline">\(V^h\)</span> 是有限元空间</p>
<p>这表明有限元误差受最佳逼近误差控制。</p>
</div>
<div id="插值误差估计" class="section level4 hasAnchor" number="4.5.2.2">
<h4><span class="header-section-number">4.5.2.2</span> 插值误差估计<a href="ch4_fem.html#插值误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对于 <span class="math inline">\(p\)</span> 阶多项式形函数，插值误差为：</p>
<p><strong><span class="math inline">\(L^2\)</span> 范数误差</strong>：
<span class="math display">\[\|u - I^h u\|_{L^2(\Omega)} \leq C h^{p+1} |u|_{H^{p+1}(\Omega)}\]</span></p>
<p><strong><span class="math inline">\(H^1\)</span> 范数误差</strong>：
<span class="math display">\[\|u - I^h u\|_{H^1(\Omega)} \leq C h^p |u|_{H^{p+1}(\Omega)}\]</span></p>
<p>其中 <span class="math inline">\(I^h u\)</span> 是 <span class="math inline">\(u\)</span> 的插值，<span class="math inline">\(|\cdot|_{H^k}\)</span> 是 <span class="math inline">\(H^k\)</span> 半范数。</p>
</div>
<div id="最优收敛阶" class="section level4 hasAnchor" number="4.5.2.3">
<h4><span class="header-section-number">4.5.2.3</span> 最优收敛阶<a href="ch4_fem.html#最优收敛阶" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>结合Céa引理和插值误差估计，得到最优收敛阶：</p>
<ul>
<li><strong>能量范数</strong>：<span class="math inline">\(\|u - u^h\|_{H^1} = O(h^p)\)</span></li>
<li><strong><span class="math inline">\(L^2\)</span> 范数</strong>：<span class="math inline">\(\|u - u^h\|_{L^2} = O(h^{p+1})\)</span></li>
</ul>
<p>这被称为<strong>Aubin-Nitsche技巧</strong>的结果。</p>
</div>
</div>
<div id="后验误差估计" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> 后验误差估计<a href="ch4_fem.html#后验误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>后验误差估计基于已计算的数值解，提供误差的实时评估。</p>
<div id="残差型误差估计" class="section level4 hasAnchor" number="4.5.3.1">
<h4><span class="header-section-number">4.5.3.1</span> 残差型误差估计<a href="ch4_fem.html#残差型误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>定义残差：
<span class="math display">\[R(u^h) = f + \nabla \cdot (k \nabla u^h) \quad \text{in } \Omega_e\]</span>
<span class="math display">\[r(u^h) = \llbracket k \nabla u^h \cdot \mathbf{n} \rrbracket \quad \text{on } \partial\Omega_e\]</span></p>
<p>其中 <span class="math inline">\(\llbracket \cdot \rrbracket\)</span> 表示跳跃。</p>
<p>误差估计子：
<span class="math display">\[\eta_e^2 = h_e^2 \|R(u^h)\|_{L^2(\Omega_e)}^2 + h_e \|r(u^h)\|_{L^2(\partial\Omega_e)}^2\]</span></p>
<p>总误差估计：
<span class="math display">\[\|u - u^h\|_{H^1} \leq C \left(\sum_{e} \eta_e^2\right)^{1/2}\]</span></p>
</div>
<div id="恢复型误差估计" class="section level4 hasAnchor" number="4.5.3.2">
<h4><span class="header-section-number">4.5.3.2</span> 恢复型误差估计<a href="ch4_fem.html#恢复型误差估计" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>基于超收敛现象，通过梯度恢复技术获得更精确的梯度：</p>
<p><span class="math display">\[\sigma^* = \mathcal{R}(\nabla u^h)\]</span></p>
<p>其中 <span class="math inline">\(\mathcal{R}\)</span> 是恢复算子（如ZZ恢复算子）。</p>
<p>误差估计：
<span class="math display">\[\|u - u^h\|_{H^1} \approx \|\sigma^* - \nabla u^h\|_{L^2}\]</span></p>
</div>
</div>
<div id="自适应网格细化" class="section level3 hasAnchor" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> 自适应网格细化<a href="ch4_fem.html#自适应网格细化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>基于后验误差估计的自适应策略：</p>
<div id="细化准则" class="section level4 hasAnchor" number="4.5.4.1">
<h4><span class="header-section-number">4.5.4.1</span> 细化准则<a href="ch4_fem.html#细化准则" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>等分布策略</strong>：
<span class="math display">\[\eta_e \leq \frac{\eta_{\text{total}}}{\sqrt{N_e}}\]</span></p>
<p><strong>固定比例策略</strong>：
细化误差最大的 <span class="math inline">\(\theta\)</span> 比例单元（通常 <span class="math inline">\(\theta = 0.3\)</span>）。</p>
<p><strong>标记策略</strong>：
- <strong>Dörfler标记</strong>：选择单元使其误差贡献占总误差的 <span class="math inline">\(\theta\)</span> 比例
- <strong>最大策略</strong>：细化误差超过最大误差 <span class="math inline">\(\theta\)</span> 倍的所有单元</p>
</div>
<div id="细化算法" class="section level4 hasAnchor" number="4.5.4.2">
<h4><span class="header-section-number">4.5.4.2</span> 细化算法<a href="ch4_fem.html#细化算法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>1. 求解当前网格上的有限元方程
2. 计算后验误差估计子 ηₑ
3. 如果 ‖η‖ &lt; TOL，停止
4. 标记需要细化的单元
5. 细化网格，转到步骤1</code></pre>
</div>
</div>
<div id="数值实验与验证" class="section level3 hasAnchor" number="4.5.5">
<h3><span class="header-section-number">4.5.5</span> 数值实验与验证<a href="ch4_fem.html#数值实验与验证" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="制造解方法" class="section level4 hasAnchor" number="4.5.5.1">
<h4><span class="header-section-number">4.5.5.1</span> 制造解方法<a href="ch4_fem.html#制造解方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>为验证收敛阶，使用制造解：
<span class="math display">\[u_{\text{exact}}(x,t) = \sin(\pi x) e^{-\pi^2 \alpha t}\]</span></p>
<p>对应的源项：
<span class="math display">\[f = \frac{\partial u_{\text{exact}}}{\partial t} - \alpha \frac{\partial^2 u_{\text{exact}}}{\partial x^2}\]</span></p>
</div>
<div id="收敛性测试" class="section level4 hasAnchor" number="4.5.5.2">
<h4><span class="header-section-number">4.5.5.2</span> 收敛性测试<a href="ch4_fem.html#收敛性测试" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对一系列网格 <span class="math inline">\(h_1 &gt; h_2 &gt; \cdots &gt; h_n\)</span>，计算：</p>
<p><strong>收敛阶</strong>：
<span class="math display">\[p = \frac{\log(E_1/E_2)}{\log(h_1/h_2)}\]</span></p>
<p>其中 <span class="math inline">\(E_i = \|u - u^{h_i}\|\)</span> 是第 <span class="math inline">\(i\)</span> 个网格上的误差。</p>
<p><strong>渐近有效指数</strong>：
<span class="math display">\[p_{\text{eff}} = \frac{\log(E_{i-1}/E_i)}{\log(h_{i-1}/h_i)}\]</span></p>
</div>
<div id="数值结果分析" class="section level4 hasAnchor" number="4.5.5.3">
<h4><span class="header-section-number">4.5.5.3</span> 数值结果分析<a href="ch4_fem.html#数值结果分析" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>理论预测与数值实验的对比：</p>
<table>
<thead>
<tr class="header">
<th>单元类型</th>
<th>理论收敛阶</th>
<th>数值收敛阶</th>
<th>验证状态</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>线性</td>
<td><span class="math inline">\(O(h^2)\)</span></td>
<td>1.98</td>
<td>✓</td>
</tr>
<tr class="even">
<td>二次</td>
<td><span class="math inline">\(O(h^3)\)</span></td>
<td>2.97</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>三次</td>
<td><span class="math inline">\(O(h^4)\)</span></td>
<td>3.95</td>
<td>✓</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="误差的物理解释" class="section level3 hasAnchor" number="4.5.6">
<h3><span class="header-section-number">4.5.6</span> 误差的物理解释<a href="ch4_fem.html#误差的物理解释" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="离散化误差的来源" class="section level4 hasAnchor" number="4.5.6.1">
<h4><span class="header-section-number">4.5.6.1</span> 离散化误差的来源<a href="ch4_fem.html#离散化误差的来源" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><strong>空间离散化误差</strong>：有限维空间逼近无限维空间</li>
<li><strong>时间离散化误差</strong>：时间积分格式的截断误差</li>
<li><strong>数值积分误差</strong>：高斯积分的误差</li>
<li><strong>舍入误差</strong>：计算机浮点运算误差</li>
</ol>
</div>
<div id="误差传播机制" class="section level4 hasAnchor" number="4.5.6.2">
<h4><span class="header-section-number">4.5.6.2</span> 误差传播机制<a href="ch4_fem.html#误差传播机制" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>局部误差</strong>：单个单元内的误差</li>
<li><strong>全局误差</strong>：误差在整个域内的传播</li>
<li><strong>累积效应</strong>：时间推进过程中误差的积累</li>
</ul>
</div>
</div>
<div id="收敛性改进技术" class="section level3 hasAnchor" number="4.5.7">
<h3><span class="header-section-number">4.5.7</span> 收敛性改进技术<a href="ch4_fem.html#收敛性改进技术" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="网格质量优化" class="section level4 hasAnchor" number="4.5.7.1">
<h4><span class="header-section-number">4.5.7.1</span> 网格质量优化<a href="ch4_fem.html#网格质量优化" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>网格规整化</strong>：避免过度畸变的单元</li>
<li><strong>梯度适应</strong>：在梯度大的区域加密网格</li>
<li><strong>边界层处理</strong>：边界附近的特殊处理</li>
</ul>
</div>
<div id="高精度技术" class="section level4 hasAnchor" number="4.5.7.2">
<h4><span class="header-section-number">4.5.7.2</span> 高精度技术<a href="ch4_fem.html#高精度技术" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong><span class="math inline">\(p\)</span> 型细化</strong>：提高形函数阶数</li>
<li><strong><span class="math inline">\(hp\)</span> 型细化</strong>：同时细化网格和提高阶数</li>
<li><strong>谱元方法</strong>：使用正交多项式基函数</li>
</ul>
</div>
</div>
</div>
<div id="有限元法与有限差分法的系统对比" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> 有限元法与有限差分法的系统对比<a href="ch4_fem.html#有限元法与有限差分法的系统对比" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="理论基础对比" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> 理论基础对比<a href="ch4_fem.html#理论基础对比" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<thead>
<tr class="header">
<th>方面</th>
<th>有限元法</th>
<th>有限差分法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>理论基础</td>
<td>变分原理，弱形式</td>
<td>Taylor展开，强形式</td>
</tr>
<tr class="even">
<td>数学框架</td>
<td>函数空间理论</td>
<td>差分算子理论</td>
</tr>
<tr class="odd">
<td>收敛性</td>
<td>Céa引理，最优逼近</td>
<td>一致性+稳定性</td>
</tr>
</tbody>
</table>
</div>
<div id="精度和稳定性对比" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> 精度和稳定性对比<a href="ch4_fem.html#精度和稳定性对比" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>精度特征</strong>：
- <strong>有限元法</strong>：具有最优收敛阶，<span class="math inline">\(L^2\)</span> 范数超收敛
- <strong>有限差分法</strong>：收敛阶取决于差分格式，通常较低</p>
<p><strong>稳定性特征</strong>：
- <strong>有限元法</strong>：隐式格式无条件稳定，质量矩阵确保稳定性
- <strong>有限差分法</strong>：显式格式有CFL限制，隐式格式稳定性较好</p>
</div>
<div id="计算效率对比" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> 计算效率对比<a href="ch4_fem.html#计算效率对比" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>内存需求</strong>：
- <strong>有限元法</strong>：需存储稀疏矩阵，内存需求 <span class="math inline">\(O(N \cdot \text{bandwidth})\)</span>
- <strong>有限差分法</strong>：只需存储网格点值，内存需求 <span class="math inline">\(O(N)\)</span></p>
<p><strong>计算复杂度</strong>：
- <strong>有限元法</strong>：矩阵组装 <span class="math inline">\(O(N)\)</span>，求解 <span class="math inline">\(O(N^{1.5})\)</span>（稀疏矩阵）
- <strong>有限差分法</strong>：显式格式 <span class="math inline">\(O(N)\)</span>，隐式格式 <span class="math inline">\(O(N^{1.5})\)</span></p>
</div>
<div id="适用性分析" class="section level3 hasAnchor" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> 适用性分析<a href="ch4_fem.html#适用性分析" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>几何适应性</strong>：
- <strong>有限元法</strong>：优秀，可处理任意几何形状
- <strong>有限差分法</strong>：受限，主要适用于规则几何</p>
<p><strong>边界条件处理</strong>：
- <strong>有限元法</strong>：自然边界条件易于处理
- <strong>有限差分法</strong>：所有边界条件需特殊处理</p>
<p><strong>多物理场耦合</strong>：
- <strong>有限元法</strong>：框架统一，易于扩展
- <strong>有限差分法</strong>：需要特殊技巧处理耦合</p>
</div>
</div>
<div id="高级有限元技术的深入探讨" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> 高级有限元技术的深入探讨<a href="ch4_fem.html#高级有限元技术的深入探讨" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="高阶形函数技术" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> 高阶形函数技术<a href="ch4_fem.html#高阶形函数技术" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>高阶形函数是提高有限元精度的重要手段，特别适用于解具有高正则性的问题。</p>
<div id="分层形函数系统" class="section level4 hasAnchor" number="4.7.1.1">
<h4><span class="header-section-number">4.7.1.1</span> 分层形函数系统<a href="ch4_fem.html#分层形函数系统" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>分层基函数的优势</strong>：
1. <strong>递归构造</strong>：高阶基函数基于低阶基函数构造
2. <strong>局部支撑</strong>：便于实现局部<span class="math inline">\(p\)</span>-细化
3. <strong>正交性</strong>：某些分层基函数具有正交性质</p>
<p><strong>一维分层基函数</strong>：
<span class="math display">\[\phi_0(\xi) = \frac{1-\xi}{2}, \quad \phi_1(\xi) = \frac{1+\xi}{2}\]</span>
<span class="math display">\[\phi_k(\xi) = \frac{1-\xi^2}{2} P_{k-1}(\xi), \quad k \geq 2\]</span></p>
<p>其中<span class="math inline">\(P_{k-1}\)</span>是Legendre多项式。</p>
</div>
<div id="谱元方法" class="section level4 hasAnchor" number="4.7.1.2">
<h4><span class="header-section-number">4.7.1.2</span> 谱元方法<a href="ch4_fem.html#谱元方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Gauss-Lobatto-Legendre (GLL) 节点</strong>：
选择GLL节点作为插值点，形函数为：
<span class="math display">\[N_i(\xi) = \frac{(1-\xi^2) P&#39;_N(\xi)}{N(N+1) P_N(\xi_i) (\xi - \xi_i)}\]</span></p>
<p>其中<span class="math inline">\(\xi_i\)</span>是第<span class="math inline">\(i\)</span>个GLL节点。</p>
<p><strong>指数收敛性</strong>：
对于光滑解，谱元方法具有指数收敛性：
<span class="math display">\[\|u - u^h\| \leq C e^{-\gamma N}\]</span></p>
</div>
</div>
<div id="自适应有限元技术" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> 自适应有限元技术<a href="ch4_fem.html#自适应有限元技术" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="h-型自适应" class="section level4 hasAnchor" number="4.7.2.1">
<h4><span class="header-section-number">4.7.2.1</span> <span class="math inline">\(h\)</span>-型自适应<a href="ch4_fem.html#h-型自适应" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>网格细化策略</strong>：
1. <strong>规则细化</strong>：将单元等分为子单元
2. <strong>不规则细化</strong>：只细化部分边或面
3. <strong>各向异性细化</strong>：根据解的各向异性特征细化</p>
<p><strong>挂节点处理</strong>：
在不规则网格中，挂节点的约束关系：
<span class="math display">\[u_h = \frac{1}{2}(u_i + u_j)\]</span></p>
<p>其中<span class="math inline">\(u_i\)</span>、<span class="math inline">\(u_j\)</span>是相邻节点的值。</p>
</div>
<div id="p-型自适应" class="section level4 hasAnchor" number="4.7.2.2">
<h4><span class="header-section-number">4.7.2.2</span> <span class="math inline">\(p\)</span>-型自适应<a href="ch4_fem.html#p-型自适应" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>阶数选择策略</strong>：
基于解的光滑性指示器：
<span class="math display">\[\sigma_e = \frac{\|\nabla^p u^h\|_{L^2(\Omega_e)}}{\|\nabla^{p-1} u^h\|_{L^2(\Omega_e)}}\]</span></p>
<ul>
<li>若<span class="math inline">\(\sigma_e\)</span>大，解在该单元内光滑，适合<span class="math inline">\(p\)</span>-细化</li>
<li>若<span class="math inline">\(\sigma_e\)</span>小，解在该单元内不光滑，适合<span class="math inline">\(h\)</span>-细化</li>
</ul>
</div>
<div id="hp-型自适应" class="section level4 hasAnchor" number="4.7.2.3">
<h4><span class="header-section-number">4.7.2.3</span> <span class="math inline">\(hp\)</span>-型自适应<a href="ch4_fem.html#hp-型自适应" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>最优策略</strong>：
结合<span class="math inline">\(h\)</span>-细化和<span class="math inline">\(p\)</span>-细化，达到指数收敛率：
<span class="math display">\[\|u - u^{hp}\| \leq C e^{-\gamma \sqrt[3]{N}}\]</span></p>
<p>其中<span class="math inline">\(N\)</span>是自由度数量。</p>
</div>
</div>
<div id="稳定化技术" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> 稳定化技术<a href="ch4_fem.html#稳定化技术" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="流线迁移扩散方程" class="section level4 hasAnchor" number="4.7.3.1">
<h4><span class="header-section-number">4.7.3.1</span> 流线迁移扩散方程<a href="ch4_fem.html#流线迁移扩散方程" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对于对流占优问题：
<span class="math display">\[-\epsilon \Delta u + \mathbf{b} \cdot \nabla u + cu = f\]</span></p>
<p>当<span class="math inline">\(\epsilon \ll |\mathbf{b}|\)</span>时，标准Galerkin法会产生数值振荡。</p>
</div>
<div id="supg稳定化" class="section level4 hasAnchor" number="4.7.3.2">
<h4><span class="header-section-number">4.7.3.2</span> SUPG稳定化<a href="ch4_fem.html#supg稳定化" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>流线迁移Petrov-Galerkin方法</strong>：
修改的弱形式：
<span class="math display">\[a(u^h, v^h) + \sum_e \tau_e \int_{\Omega_e} \mathcal{L}u^h \cdot (\mathbf{b} \cdot \nabla v^h) d\Omega = L(v^h) + \sum_e \tau_e \int_{\Omega_e} f \cdot (\mathbf{b} \cdot \nabla v^h) d\Omega\]</span></p>
<p>其中稳定化参数：
<span class="math display">\[\tau_e = \frac{h_e}{2|\mathbf{b}|} \coth(Pe_e) - \frac{1}{2|\mathbf{b}|}\]</span></p>
<p><span class="math inline">\(Pe_e = \frac{|\mathbf{b}|h_e}{2\epsilon}\)</span>是单元Peclet数。</p>
</div>
<div id="gls方法" class="section level4 hasAnchor" number="4.7.3.3">
<h4><span class="header-section-number">4.7.3.3</span> GLS方法<a href="ch4_fem.html#gls方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Galerkin最小二乘方法</strong>：
在所有方向上添加稳定化项：
<span class="math display">\[a(u^h, v^h) + \sum_e \tau_e \int_{\Omega_e} \mathcal{L}u^h \cdot \mathcal{L}v^h d\Omega = L(v^h) + \sum_e \tau_e \int_{\Omega_e} f \cdot \mathcal{L}v^h d\Omega\]</span></p>
</div>
</div>
<div id="多尺度有限元方法" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> 多尺度有限元方法<a href="ch4_fem.html#多尺度有限元方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="多尺度基函数构造" class="section level4 hasAnchor" number="4.7.4.1">
<h4><span class="header-section-number">4.7.4.1</span> 多尺度基函数构造<a href="ch4_fem.html#多尺度基函数构造" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对于具有多尺度系数的问题：
<span class="math display">\[-\nabla \cdot (a_\epsilon(x) \nabla u) = f\]</span></p>
<p>其中<span class="math inline">\(a_\epsilon(x)\)</span>是快速振荡的系数。</p>
<p><strong>多尺度基函数</strong>：
在每个粗网格单元<span class="math inline">\(K\)</span>上求解局部问题：
<span class="math display">\[-\nabla \cdot (a_\epsilon \nabla \phi_i^{ms}) = 0 \quad \text{in } K\]</span></p>
<p>配以适当的边界条件。</p>
</div>
<div id="变分多尺度方法" class="section level4 hasAnchor" number="4.7.4.2">
<h4><span class="header-section-number">4.7.4.2</span> 变分多尺度方法<a href="ch4_fem.html#变分多尺度方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>尺度分离</strong>：
将解分解为粗尺度和细尺度部分：
<span class="math display">\[u = u^h + u&#39;\]</span></p>
<p>其中<span class="math inline">\(u^h\)</span>是粗尺度解，<span class="math inline">\(u&#39;\)</span>是细尺度解。</p>
<p><strong>细尺度建模</strong>：
通过建模细尺度的影响来改进粗尺度解：
<span class="math display">\[a(u^h, v^h) + a&#39;(u&#39;, v^h) = (f, v^h)\]</span></p>
</div>
</div>
<div id="间断有限元方法" class="section level3 hasAnchor" number="4.7.5">
<h3><span class="header-section-number">4.7.5</span> 间断有限元方法<a href="ch4_fem.html#间断有限元方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="dg方法的基本思想" class="section level4 hasAnchor" number="4.7.5.1">
<h4><span class="header-section-number">4.7.5.1</span> DG方法的基本思想<a href="ch4_fem.html#dg方法的基本思想" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>弱连续性</strong>：
在单元内部使用标准的有限元方法，在单元边界上通过数值通量强制连续性。</p>
<p><strong>DG弱形式</strong>：
<span class="math display">\[\sum_e \int_{\Omega_e} \nabla u^h \cdot \nabla v^h dx - \sum_F \int_F \{\nabla u^h \cdot \mathbf{n}\} [v^h] ds + \sum_F \int_F \sigma [u^h] [v^h] ds = \sum_e \int_{\Omega_e} f v^h dx\]</span></p>
<p>其中<span class="math inline">\(\{·\}\)</span>表示平均，<span class="math inline">\([·]\)</span>表示跳跃，<span class="math inline">\(\sigma\)</span>是惩罚参数。</p>
</div>
<div id="内部惩罚方法" class="section level4 hasAnchor" number="4.7.5.2">
<h4><span class="header-section-number">4.7.5.2</span> 内部惩罚方法<a href="ch4_fem.html#内部惩罚方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>对称内部惩罚（SIPG）</strong>：
<span class="math display">\[\sigma = \frac{\alpha p^2}{h_F}\]</span></p>
<p>其中<span class="math inline">\(\alpha\)</span>是足够大的常数，<span class="math inline">\(p\)</span>是多项式阶数，<span class="math inline">\(h_F\)</span>是面的尺寸。</p>
</div>
</div>
<div id="混合有限元方法" class="section level3 hasAnchor" number="4.7.6">
<h3><span class="header-section-number">4.7.6</span> 混合有限元方法<a href="ch4_fem.html#混合有限元方法" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="raviart-thomas元素" class="section level4 hasAnchor" number="4.7.6.1">
<h4><span class="header-section-number">4.7.6.1</span> Raviart-Thomas元素<a href="ch4_fem.html#raviart-thomas元素" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对于混合形式：
<span class="math display">\[\mathbf{q} + k \nabla u = 0\]</span>
<span class="math display">\[\nabla \cdot \mathbf{q} = f\]</span></p>
<p>使用不同的函数空间：
- <span class="math inline">\(\mathbf{q} \in RT_k\)</span>（Raviart-Thomas空间）
- <span class="math inline">\(u \in P_k\)</span>（多项式空间）</p>
<p><strong>RT空间的性质</strong>：
1. <strong>法向连续性</strong>：<span class="math inline">\(\mathbf{q} \cdot \mathbf{n}\)</span>在单元边界上连续
2. <strong>散度保持</strong>：<span class="math inline">\(\nabla \cdot RT_k = P_k\)</span></p>
</div>
</div>
<div id="有限元方法的并行计算" class="section level3 hasAnchor" number="4.7.7">
<h3><span class="header-section-number">4.7.7</span> 有限元方法的并行计算<a href="ch4_fem.html#有限元方法的并行计算" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="区域分解方法" class="section level4 hasAnchor" number="4.7.7.1">
<h4><span class="header-section-number">4.7.7.1</span> 区域分解方法<a href="ch4_fem.html#区域分解方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Schwarz方法</strong>：
将计算域分解为重叠或非重叠的子域：
<span class="math display">\[\Omega = \bigcup_{i=1}^N \Omega_i\]</span></p>
<p>在每个子域上并行求解局部问题。</p>
</div>
<div id="多重网格方法" class="section level4 hasAnchor" number="4.7.7.2">
<h4><span class="header-section-number">4.7.7.2</span> 多重网格方法<a href="ch4_fem.html#多重网格方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>几何多重网格</strong>：
使用一系列从粗到细的网格：
<span class="math display">\[\Omega^1 \subset \Omega^2 \subset \cdots \subset \Omega^L\]</span></p>
<p>通过在不同网格层次间传递信息加速收敛。</p>
<p><strong>代数多重网格</strong>：
直接从系数矩阵构造粗网格算子，不依赖几何信息。</p>
</div>
</div>
<div id="高级技术的应用实例" class="section level3 hasAnchor" number="4.7.8">
<h3><span class="header-section-number">4.7.8</span> 高级技术的应用实例<a href="ch4_fem.html#高级技术的应用实例" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="地震波传播模拟" class="section level4 hasAnchor" number="4.7.8.1">
<h4><span class="header-section-number">4.7.8.1</span> 地震波传播模拟<a href="ch4_fem.html#地震波传播模拟" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>问题特点</strong>：
- 大规模计算域
- 多尺度现象（地表细节vs深部结构）
- 复杂几何边界</p>
<p><strong>技术选择</strong>：
- <span class="math inline">\(hp\)</span>-自适应：处理波前的尖锐特征
- 谱元方法：在光滑区域实现高精度
- 并行计算：处理大规模问题</p>
</div>
<div id="多孔介质流动" class="section level4 hasAnchor" number="4.7.8.2">
<h4><span class="header-section-number">4.7.8.2</span> 多孔介质流动<a href="ch4_fem.html#多孔介质流动" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>问题特点</strong>：
- 多尺度渗透率
- 对流占优传输
- 多相流耦合</p>
<p><strong>技术选择</strong>：
- 多尺度基函数：捕获细尺度渗透率变化
- SUPG稳定化：处理对流占优问题
- 混合有限元：确保质量守恒</p>
</div>
</div>
<div id="实现考虑" class="section level3 hasAnchor" number="4.7.9">
<h3><span class="header-section-number">4.7.9</span> 实现考虑<a href="ch4_fem.html#实现考虑" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="数据结构设计" class="section level4 hasAnchor" number="4.7.9.1">
<h4><span class="header-section-number">4.7.9.1</span> 数据结构设计<a href="ch4_fem.html#数据结构设计" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>自适应网格存储</strong>：
- 树状结构：便于细化和粗化
- 邻接信息：快速访问相邻单元
- 挂节点管理：处理不规则网格</p>
</div>
<div id="高效矩阵组装" class="section level4 hasAnchor" number="4.7.9.2">
<h4><span class="header-section-number">4.7.9.2</span> 高效矩阵组装<a href="ch4_fem.html#高效矩阵组装" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>单元矩阵缓存</strong>：
对于相同形状的单元，预计算并缓存单元矩阵。</p>
<p><strong>向量化计算</strong>：
利用现代CPU的向量指令集加速矩阵运算。</p>
</div>
</div>
<div id="软件实现框架" class="section level3 hasAnchor" number="4.7.10">
<h3><span class="header-section-number">4.7.10</span> 软件实现框架<a href="ch4_fem.html#软件实现框架" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="开源有限元库" class="section level4 hasAnchor" number="4.7.10.1">
<h4><span class="header-section-number">4.7.10.1</span> 开源有限元库<a href="ch4_fem.html#开源有限元库" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>deal.II</strong>：
- C++实现
- 支持<span class="math inline">\(hp\)</span>-自适应
- 丰富的教程和文档</p>
<p><strong>FEniCS</strong>：
- Python/C++混合
- 自动代码生成
- 强大的符号计算</p>
<p><strong>MFEM</strong>：
- 模块化设计
- 高性能计算优化
- 支持多种单元类型</p>
</div>
</div>
</div>
<div id="总结" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> 总结<a href="ch4_fem.html#总结" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>有限元法作为一种强大的数值分析方法，在地球科学中具有广泛的应用前景。通过本章的学习，读者应该掌握：</p>
<ol style="list-style-type: decimal">
<li><strong>理论基础</strong>：理解变分原理和弱形式的概念</li>
<li><strong>数学推导</strong>：掌握形函数和单元矩阵的构造方法</li>
<li><strong>编程实现</strong>：能够使用R语言实现简单的有限元程序</li>
<li><strong>方法对比</strong>：了解有限元法与有限差分法的优缺点</li>
<li><strong>应用前景</strong>：认识有限元法在地球科学中的潜在应用</li>
</ol>
<p>有限元法的优势在于其灵活性和精度，特别适合处理复杂几何和多物理场耦合问题。随着计算技术的发展，有限元法将在地球科学数值模拟中发挥越来越重要的作用。</p>
<div id="本章要点回顾" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> 本章要点回顾<a href="ch4_fem.html#本章要点回顾" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="理论基础" class="section level4 hasAnchor" number="4.8.1.1">
<h4><span class="header-section-number">4.8.1.1</span> 理论基础<a href="ch4_fem.html#理论基础" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>变分原理</strong>：将偏微分方程转化为变分问题</li>
<li><strong>弱形式</strong>：通过分部积分降低导数阶数</li>
<li><strong>形函数</strong>：定义单元内插值关系</li>
</ul>
</div>
<div id="数学方法" class="section level4 hasAnchor" number="4.8.1.2">
<h4><span class="header-section-number">4.8.1.2</span> 数学方法<a href="ch4_fem.html#数学方法" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>有限元离散化</strong>：空间域划分为有限个单元</li>
<li><strong>矩阵组装</strong>：构造质量矩阵和刚度矩阵</li>
<li><strong>边界条件处理</strong>：施加Dirichlet边界条件</li>
</ul>
</div>
<div id="编程实现" class="section level4 hasAnchor" number="4.8.1.3">
<h4><span class="header-section-number">4.8.1.3</span> 编程实现<a href="ch4_fem.html#编程实现" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>基本有限元法</strong>：线性形函数，均匀网格</li>
<li><strong>高级技术</strong>：高阶形函数，自适应网格</li>
<li><strong>性能优化</strong>：稀疏矩阵，高效求解器</li>
</ul>
</div>
<div id="应用案例" class="section level4 hasAnchor" number="4.8.1.4">
<h4><span class="header-section-number">4.8.1.4</span> 应用案例<a href="ch4_fem.html#应用案例" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>一维热传导</strong>：铁棍温度分布演化</li>
<li><strong>CLAMS方法</strong>：系统化的建模流程</li>
<li><strong>结果可视化</strong>：温度分布和网格对比</li>
</ul>
</div>
</div>
<div id="扩展阅读建议" class="section level3 hasAnchor" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> 扩展阅读建议<a href="ch4_fem.html#扩展阅读建议" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><strong>理论深化</strong>：学习更高级的有限元理论，如混合有限元法、间断有限元法等</li>
<li><strong>应用拓展</strong>：探索有限元法在地球科学其他领域的应用，如流体力学、结构力学等</li>
<li><strong>软件工具</strong>：熟悉专业的有限元软件，如COMSOL、ANSYS等</li>
<li><strong>并行计算</strong>：学习大规模有限元问题的并行求解技术</li>
</ol>
</div>
<div id="实践练习" class="section level3 hasAnchor" number="4.8.3">
<h3><span class="header-section-number">4.8.3</span> 实践练习<a href="ch4_fem.html#实践练习" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><strong>修改参数</strong>：尝试不同的网格密度、时间步长等参数，观察对结果的影响</li>
<li><strong>边界条件</strong>：实现其他类型的边界条件，如Neumann边界条件</li>
<li><strong>物理模型</strong>：将热传导模型扩展到其他物理过程，如扩散、对流等</li>
<li><strong>网格生成</strong>：实现非均匀网格的生成和有限元求解</li>
</ol>
<p>通过本章的学习和实践，读者应该能够理解有限元法的基本原理，掌握其实现方法，并能够将其应用到实际的地球科学问题中。</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch3_fdm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch5_fvm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["数值地球.pdf", "数值地球.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
