[["index.html", "SHUD水文模型 (ver 2.0) 理论、方法和案例 前言", " SHUD水文模型 (ver 2.0) 理论、方法和案例 Lele Shu (shulele@lzb.ac.cn) 2024-11-25 前言 本书涵盖了SHUD模型的发展、基本理论、技术细节、应用案例。 在介绍模型本身的同时，本书还旨在将以水为媒介的自然过程在水文和地球工作中展示。 本书描述内容根据SHUD模型版本迭代，当前版本为v2.0 2023版。 更新周期约6个月。 SHUD模型 “云气西行，云云然冬夏不辍；水泉东流，日夜不休；上不竭，下不满；小为大，重为轻；圜道也。” ——吕不韦 《吕氏春秋》, 公元前239年(?) “上善若水，水善利万物而不争” ——老子《道德家》，公元前四世纪 科学技术是人工的演化。理论物理学家的理论验证需要等待宇宙现象的发生。科学家穷其一生也无法验证某些理论——因为自然现象的发生概率非常低。所以，人工实验就可以大幅度提高这种现象的发生概率。 ——陈平，2019 "],["overview.html", "Chapter 1 绪论 1.1 水文模型 1.2 数值水文模型 1.3 SHUD模型 1.4 SHUD模型的特点 1.5 参考文献", " Chapter 1 绪论 1.1 水文模型 科学模型是集合人类对自然规律的认识，并通过已知变量计算时空上未知变量的数学方法。人类无法通过观测手段获取任意时间、任意地点、所有关心的水文变量，仅可获取特定时间和地点内有限的变量，这归咎于观测手段的局限性以及观测手段时空覆盖能力的限制，更重要的是人类缺乏观测未来的手段，因此人类需要一种手段：依据有限时空内的观测，体现和验证对自然运动规律的认知，并以此推算无限的空间（无观测区域）和时间（过去与未来）上所关心的变量（Beven, 2012; Savenije, 2010）。 水文模型集合了人类对水循环机理的理解，利用数学公式表达水的时空运动规律，既可以结合观测数据来验证理论的可靠性与适宜性，也可预测未来可能的发展趋势；即实现理解自然与预测自然的目的（任立良等, 2011；Peel和McMahon, 2020；Duffy，2017; Vallis, 2016; Wagener等, 2010; Fatichi等, 2016）。水文模型是高效且经济的科学试验工具，不仅能够结合现场观测数据来验证科学理论、指导科学观测网络布局（Li等，2018a；Blöschl等，2019; Beven, 2012），也在实践中对农业生产、水资源管理、污染物控制、社会经济发展关键决策有不可或缺的支撑作用（任立良等,1996；徐宗学, 2010；汤秋鸿等, 2019; Fatichi等, 2016；Zheng等，2010；Yu等，2020；Li等,2018b）。 图1: 流域中水文循环基本框架，包含了高寒冰冻圈要素、地表水、地下水以及河流水文过程。 在流域尺度的水文模型需要表达诸多个物理过程（图1）：落（降雨-截留）、入（入渗）、穿（土壤和岩石等孔隙介质中水沿各个方向的饱和与非饱和流动）、蒸（蒸腾、蒸发）、流（径流）；总结为“落-入-穿-蒸-流”五个过程。 其中还需考虑人类活动、不同的土地利用和土地覆盖对于水文过程的影响。在高寒地区，冰川、冻土和积雪要素导致的水分相变过程更为复杂，且相变影响原有的山坡水文过程（杨大文等, 2018；王磊等，2014）。 水文过程在微观的时空尺度上，表现出极高的复杂性和异质性特征；由于小尺度复杂性的平均效应，在宏观尺度上水文过程的复杂度反而较低，因此大尺度水文模型的水流过程描述更为概念化，其水流过程和计算的复杂度也较低（Peel和McMahon, 2020; Blöschl等, 1995, Grayson等, 1992; Wood等,1988; Savenije, 2001; Sivapalan 2003a）。 尽管水文模型数量众多，但新的水文模型依然层出不穷；这表明现有水文模型尚无法满足复杂多变的水问题研究和工程应用。Peel和McMahon（2020）对比总结了279个降雨径流模型，并引述Clark等（2011）评论：“模型数量之多表明，流域尺度上，环境动态过程的科学理解依旧不充分，可能归咎于现阶段在测量和表达自然系统异质性上的困难”。 水文模型发展上存在对于“正确道路”的争论（Clark等，2017; Sivapalan，2003a, 2003b; Semenova和Beven，2015），主要关注点在：（1）水文过程的合理参数化；（2）数据限制；（3）不确定性和（4）计算资源限制。水文模型发展存在着相互矛盾、相互竞争的两种需求，即降低模型复杂度的要求与精细表达水文物理过程的要求，这两个需求下水文模型分为概念性和物理性、自上而下与自下而上的模型分类（任立良等，1996；Vallis 等，2016, Clark等，2017；Sivapalan等，2003a，2017；Novotny，2018; Wagener等, 2004; Franchini和Pacciani, 1991; Saveniji, 2010）。 自上而下（Top-down）建模思路由长期、大尺度的流域水文响应作为出发点，逐步深入，对小尺度具体物理过程进行复杂化和细化模拟。流域计算单元被概念化为想象的存储空间——即“水桶模型”，计算单元上的驱动要素（降雨、气温、辐射等）与流域响应（通常为径流）表达为简单经验关系、线性/非线性关系、多元共线拟合关系。基于水桶概念的水文模型关注地表产汇流过程如何在河流断面上形成径流过程线，简化水在坡面和河道内的流动过程以及地表-地下水之间的双向交互，对产汇流和基流过程描述都具有明显的概念化特征。然而，自然流域内地表水和地下水交互频繁，交互界面的水流动方向和强度随水力梯度关系而变化（王文科等，2007, Maxwell等，2005，2016; Sulis等, 2012; Winter, 1999; Mukherjee等, 2018; Krause等, 2014; Levine和Salvucci, 1999）。 自下而上（Bottom-up）建模思路，从微观的计算单元和最基础物理公式出发，集合所有计算单元的水文过程，形成对整体流域长时间大范围的水文响应；这类模型也被称为基于过程或者基于物理的模型。其计算单元是流域上表达空间异质性所需的小尺度、可任意分割的地块；由（质量、能量、动量）守恒定理构建基础控制方程，利用微观尺度的物理方程（如达西定律、理查兹方程、圣维南方程、对流—扩散方程等）描述水文过程，采用数学或数值方法在高时空分辨率上计算水和能量在三维空间的存储、运动与转换过程，通过集合微观物理过程反应整体流域尺度的水文响应。需要强调的是构建这类水文模型基础的物质/能量守恒与水热传输定理（如达西定律）等能够脱离单个模型而独立存在，且能够被物理实验证实，因此其参数也具有明确物理意义，可直接使用测量的参数值（Li等，2018a；Beven 1989; Ntona等, 2022；Fatichi等, 2016）。 Hrachowitz和Clark（2017）总结了流域水文模型的空间和物理过程特征（图2），其背景坐标系是“分辨率—物理过程复杂度”构成的二维连续空间，横坐标反映了水文模型中最小水文计算单元的数量，即模型对流域空间异质性表达的精细程度；纵坐标表示物理过程的复杂程度。图2中，SWAT和VIC为代表的传统水文模型偏于左下方（空间分辨率低、以子流域/水文响应单元为最小计算单元，水流物理过程相对简单），属于自上而下模型。图2右上角的17-23模型是典型的地表-地下过程耦合的数值水文模型，具有极高的空间分辨率和更高数量级的计算单元数量，更精细地表达水文的物理过程和空间异质性；其产流机制随时间空间变化，突破了传统水文模型中固化的饱和/超渗产流机制。 图 2：常用水文模型在空间分辨率-过程复杂度中的位置示意图（修改自Hrachowitz和Clark, 2017）（空间分辨率轴线显示了各个模型HCU数量和相关尺度，过程复杂度轴表示一个HCU内过程的数量，阴影表示从水桶模型（白色）过渡到时空连续模型（灰色），红点表示分辨率-过程复杂性的两个端点。） 地表-地下过程耦合的数值水文模型（Integrated Surface-Subsurface Hydrological Model with a Numeric Method）的物理过程描述更接近自然界水的运动，也更准确反映人类活动影响，并且易于耦合其他（水热耦合、污染物传输、植被生态等）物理过程，成为近几十年来水文模型新兴且重要的发展方向，也获得广泛关注（束龙仓等，2022；胡立堂等，2007；王蕊等，2008; Ntona等, 2022; Maxwell等2014; Paniconi和Putti 2015; Hrachowitz和Clark, 2017; Peel和McMahon, 2020）。2000年以来，全球水文研究者新发展了20多个重要的数值水文模型。 1.2 数值水文模型 地表-地下过程耦合的数值水文模型起始于20世纪70年代, Freeze和Harlan（1969）提出了基于水动力偏微分物理方程的模拟方法和统一地表—地下水文过程的模型蓝图（Freeze和Harlan, 1969; Cooley 1971）, 但由于当时计算技术的客观限制，直到上世纪80年代SHE（Abbott等, 1986）模型出现，数值水文模型才崭露头角。 数值水文模型既有别于数值方法求解的地下水模型（如ModFlow（McDonald和Harbaugh, 1984; Niswonger等, 2011）），也不同于地表-地下水过程概念化的传统水文模型。地下水模型常采用数值方法，但关注点在地表以下数十米至数百米的空间，其中包括地层、裂隙水等过程，超出水文模型所关注的“降雨-径流”范畴；同时地表水过程简化为地下水运动的边界条件。传统水文模型中地下水模块不具有实际含义的地下深度，而利用概念化的水桶模型反映地下水补给-存储-释放过程，例如新安江模型（赵人俊和王佩兰, 1988）、VIC（Liang等, 1994）和WRF-Hydro模型（Gochis等, 2013）的释水曲线（Savenije, 2001）。 数值水文模型（图3），属于分布式水文模型中的一个特殊类别，将地表-地下水文物理过程利用数值方法紧密耦合起来。数值方法本质上是对离散（非连续）时空单元中水头分布和变化的近似数值解的描述，从理论的解析解到数值解虽然损失了精度，但解析解通常无法求得，而数值方法可给出误差可接受的近似解。 图3：地表-地下过程耦合的数值水文模型在整体水文模型谱系中的位置。图中蓝色斜体文字是该类别代表性模型。图中模型分别为：新安江（赵人俊和王佩兰, 1988），Unit Hydrograph（Sherman， 1932）, HBV（Bergström，1992）, FLEX（Gharari等,2014）, Topmodel（Beven和Kirkby, 1979），SWAT（Arnold等, 1998），VIC（Liang等, 1994）, PRMS（Leavesley等，1983）, WRF-Hydro（Gochis等, 2013），WEP（Jia等,2001），GBHM（Yang等，1998），GSFlow（Markstrom等, 2008）, GSFLOW-SWMM(Tian等，2015)，SWAT-MODFLOW（Park等,1996）, FEFLOW-3D（Hu等，2020）, SHUD（Shu等, 2020）, PIHM（Qu和Duffy,2007）, PARFLOW（Kollet和Maxwell, 2006）, PAWS（Shen和Phanikumar, 2010）, HydroGeoSphere（Aquanty Inc. 2013），CATHY（Bixio等, 2002; Camporese等 2010）. 1.2.1 数学模型 数值模型使用物质和能量守恒公式作为控制方程（Governing equation）显式地描述流域的地表水和地下水储量与流量关系，通常使用某种形式的理查兹方程（公式2）和圣维南方程（公式3）来分别计算地下和地上水流过程（Freeze和Harlan, 1969; Haque等, 2021; Maxwell等, 2016; Farthing和Ogden, 2017; Singh, 2018）。各种数值水文模型的核心控制方程基本相同，但其简化程度和求解方案不同，分别对地表、地下水的不同过程采取一维、二维和三维的不同简化方法。 流域水文的基本控制方程可写为： \\[\\frac{\\partial h}{\\partial t}=\\nabla \\cdot(v h)-\\frac{Q_e}{A}+\\frac{Q_{s u}}{A}\\] \\[Q=\\frac{1}{n} A R^{2 / 3} s^{1 / 2}\\] \\[S_w(h) \\frac{\\partial h}{\\partial t}=\\nabla \\cdot \\boldsymbol{q}+\\frac{Q_e}{V}+\\frac{Q_{s s}}{V}\\] \\[q=-k_e(h) \\nabla(h+z)\\] 公式（1）和（3）分别是地表水和地下水的控制方程。其中， h为地下水水头高度、非饱和层的含水量、或地表水高度[L]； t为时间[T]； v为地表水水平平均流速[\\(LT^(-1)\\)]； Q_e为地表与地下交互流量[\\(L^3 T^(-1)\\)]，从地表至地下流量为正； Q_su为地表水的源汇项或者边界条件[\\(L^3 T^(-1)\\)]，可包括降雨、灌溉、蒸散发等过程； A为控制单元的垂直投影面积[\\(L^2\\)]； n为曼宁系数[\\(TL^(-1/3)\\)]，R为水力半径，即过水面积与湿周之比[\\(L\\)]，S_f为摩擦坡度[\\(LL^(-1)\\)]。S_w (h)是储水系数[\\(L^3 L^(-3) L^(-1)\\)]，即单位水头下降时单位体积内可释放的水量，包含了地下水的储水系数[\\(L^(-1)\\)]和非饱和土壤层的含水量[\\(LL^(-1)\\)]; q为地下水径流量[\\(L^3 L^(-2) T^(-1)\\)]，是水头高度或含水量的函数，采用达西定律或理查兹方程（公式4）计算； Q_ss为地下水或土壤水的源汇项或者边界条件[\\(L^3 T^(-1)\\)]，实际计算中可包含单位面积地下水渗漏、注入、抽取以及蒸散发等流量； V为控制单元的体积[\\(L^3\\)]； K_e (h)为有效水力传导度[\\(LT^(-1)\\)]，是土壤含水量或基质势的函数； z为距离某一基准面的垂直距离[\\(L\\)]； v公式中q和v的计算分别依据曼宁公式（公式2）和理查兹方程（公式2）。 流域尺度的地表—地下过程耦合计算基于水头连续性和地表—地下间水量交换\\(Q_e\\)。公式（3）是地下水水量平衡公式的出发点，左边是单位水头/水位线变化引起的控制体水量变化，右边是达西定律/理查兹公式计算的渗流量、地表-地下交互量、源汇项之间的差值。 流域水文还需要对地表过程，即积雪融化和蒸散发进行模拟，实际模型计算时归入源汇项。冰川、积雪和蒸散发通常作为模块与地表和地下水文过程进行松散耦合，即计算的时间步长不同，或者无需迭代计算。土地利用、农业活动等过程在模型中以改变水力学参数的形式展现其对水文和陆面过程的影响。 数值方法的边界条件通常分为Dirichlet和Neumann两类。Dirichlet边界条件（Dirichlet Boundary Condition, DBC）是常/偏微分方程的第一类边界条件，也称为固定边界条件，其指定了空间某点的固定值。例如，在地下水流动问题中，Dirichlet边界条件限定固定地下水水头高度。纽曼边界条件（Neumann boundary condition, NBC） 也被称为常/偏微分方程的“第二类边界条件”，其给定空间特定位置上目标变量的一阶导数。在地下水流动问题中，给定某点处固定流量，如注水或者取水流量。作为三维的数值水文模型，两类边界条件都可以施加在空间任意位置的任意方向上。数值水文模型中存在常见的边界条件或者假设，其中包括： 流域底部不透水边界，属于NBC，其流量为零。此假设适用于大部分流域的水文研究。当需要体现深层地下水对模拟系统影响时，可以设定系统非零底部边界条件，实现与深层地下水的交互。 封闭的流域边界，即流域在坡面单元的地表和地下水的水平方向上不接受来自外部的水量，也不向外部流失水量——边界上的HCU与域外的流量为零。当模拟对象边界是流域边界，且地表水和地下水的流域边界一致时，此假设完全成立。当模拟域为流域一部分（例如河漫滩研究）时，则需要专门设定DBC或者NBC，来确保域内水量平衡。但实际应用中边界条件难以通过观测获取，因此替代办法是扩大模拟域——扩大模拟域直至零流量的流域边界。在重点研究区采用精细网格，研究区边界至流域边界范围采用较粗网格，即可以保证研究区边界条件合理，同时避免边界的观测数据的掣肘。 流域顶部边界。流域上层边界，流域顶部的边界条件实际上为降雨和灌溉，作为NBC施加在流域上。数值水文模型通常将蒸散发也作为NBC作用于地表和地下，但是蒸散发作为边界条件不是外部输入，而是根据气象驱动和土壤温湿度计算而来。 河流出口边界。河流出口是流域唯一的水平方向水量出口，因此水文模型都符合质量守恒定律或水量平衡公式：\\(\\Delta S = P - ET -Q\\)，\\(\\Delta S\\)为流域水储量，\\(P\\)为降雨量，\\(ET\\)为蒸发量，\\(Q\\)为径流量。 1.2.2 数值方法求解 从控制方程（公式1和3）可知目标变量h是随时间t和空间变化的函数，因此数值方法需要在时间和空间上对目标对象进行离散化。三维流域空间进行水平和垂直离散化，是数值模型必经步骤。好的空间离散化方案不仅要满足研究区域的模拟精度、满足边界条件限制，同时要减少计算单元数量以降低对计算资源的依赖性。水平空间离散化方案，通常分为结构化和非结构化方案，模型对比一节将仔细讨论。垂直方向上，主要是针对土壤层进行划分，由地表划分至底部不透水边界；垂直方向的离散化方案非常灵活，存在距离等差、等比或者任意划分，也可以通过饱和或非饱和层进行划分。 数值方法可分为显式求解（Explicit method）与隐式求解（Implicit method）：当下一时刻变量由前一时刻变量直接计算得到的，称为显式求解法；当下一时刻变量由一系列公式、矩阵或者迭代算法计算得到，称为隐式求解法。相同时空分辨率条件下，显式求解法的计算速度显著高于隐式求解法，但是隐式求解法可以保证计算的稳定性，因此可采用较大时间步长进行计算，而显式求解法必须受制于CFL条件。CFL条件是保证数值方法收敛性和稳定性的必要条件（非充分条件），以Courant，Fredrichs和Lewy共同命名（Courant等 1928）。 CFL条件即数值方法的时间步长要足够小，方能够保证计算精度，否则结果不收敛或者不稳定。 时间离散化即模型时间步长。时间步长和空间分辨率的组合关系，对于数值方法求解的稳定性和收敛性都有显著影响。CFL条件是限制因素。为保证数值方法稳定性，空间分辨率越高，则要求时间分辨率也越高，时间分辨率与空间分辨率的（一次或多次）幂存在正比关系。 1.3 SHUD模型 水文非结构域模拟器(Simulator for Hydrologic Unstructured Domains, SHUD - 音“数得”) 是一个多过程、多尺度、数值方法、地表-地下全耦合、分布式水文模型(Shu, Ullrich, and Duffy 2020)。模型使用了有限体积法(Finite volume method, FVM)求解水文常微分方程。 rSHUD 是一款以R库开发的开源GIS和水文分析的工具集，用于支持SHUD和其他类似水文模拟。依托强大的R库，rSHUD的功能可分为：空间数据处理与分析，全球开放地理数据获取，SHUD数据前处理，SHUD数据后处理，水文数据分析，二维/三维数据可视化等。 SHUD和rSHUD共同组成了SHUD模拟系统。SHUD模型系统的网站为https://www.shud.xyz。用户可通过SHUD网站关注SHUD模型的发展、更新、应用和近期新闻，也可以通过网站获取源代码。 1.3.1 站在巨人的肩上 首先，SHUD模型基于Christopher Duffy教授在1996年提出的“两态集成平衡”(two-state integral-balance)概念模型(Duffy 1996)，以及PIHM(Penn State Integrated Hydrologic Model)模型Bhatt (2012)的设计和应用经验。“两态集成平衡”理论将土壤水层分为未饱和和饱和层，并使用局部平衡公式计算水流。 SHUD和PIHM都是多尺度、多过程、数值方法、地表-地下全耦合、分布式水文模型。 继承和PIHM中“两态集成平衡”概念模型思想，并吸收PIHM应用中的经验，舒乐乐(2020)全新开发了SHUD模型。SHUD的源代码全部为新代码，防止代码继承而引入旧漏洞，并且在模型中的流域拓扑结构、数据结构、算法、公式应用、迭代过程、输入输出等方面有较大改进（文后会详细列举）。因此，SHUD由PIHM发展而来，但与PIHM已经在概念、结构、计算和格式上完全不兼容，应作为另一个独立模型看待。 1.3.2 PIHM模型简史 Duffy于1996年构建了计算土壤水和地下水动态的“二态集成平衡”模型(Duffy 1996)；该模型中，垂直方向分为饱和与非饱和层，局地水量平衡公式集成计算水的交换。“二态集成平衡”模型在简化水文动态的同时，保留了自然中时空尺度对产流的响应。 之后Brandes 和Duffy 等 (Brandes, Duffy, and Cusumano 1998) 继承了“二态集成平衡”模型并使用FEMWATER实现了数值方法计算山坡-河流尺度上水双向交互。 2004年，曲轶众(Qu 2004)在算法中加入了蒸散发过程和河道计算，并发布了Penn State Integrated Hydrologic Model (PIHM)——PIHM的1.0版本，是PIHM发展中最重要的里程碑，从此PIHM成为流域模拟的通用研究工具应用在不同尺度的流域中。 此后， Kumar， Bhartt和Duffy (Mukesh Kumar 2009; Mukesh Kumar, Duffy, and Salvage 2009)) 相继开发了PIHM v2.0和PIHMgis。 PIHM v2.0增强了模型中陆面过程和土地利用影响水文过程的计算过程。Gopal Bhartt 开发了生成PIHM输入、读取输出和分析结果的软件PIHMgis。PIHMgis分别出现了PIHMgis v2.3和v3.0两个常用版本，PIHMgis v2.3使用了QGIS内核，因此在部分平台上更新困难。 PIHMgis v3.0的支持性更好，可支持Mac或Windows操作系统。(Leonard and Duffy 2013) 开发了HydroTerre平台，为PIHM和其他水文模型提供基础的空间和时间数据。 PIHMgis和HydroTerre的出现极大地推动了PIHM模型在全美和全球的应用。 受益于PIHM模型的诸多优势，PIHM家族出现了若干耦合模型。 例如，Flux-PIHM将NOAH陆面过程模型与PIHM模型耦合，更精确地计算陆面与大气的能量交换、 蒸散发和积雪 (Shi, Baldwin, et al. 2015; Shi et al. 2014)。张宇等(Zhang, Slingerland, and Duffy 2016) 开发了LE-PIHM, 模型万年尺度由水文过程造就的地形地貌变化。 RT-PIHM 和 RT-Flux-PIHM(Bao 2016; Bao et al. 2017)实现了化学反应与PIHM水文过程的耦合。由石宇宁领导的研究正试图将各种PIHM相关模型作为模块统一建立多模块PIHM系统（Multi-Module PIHM， MM-PIHM， https://github.com/PSUmodeling/MM-PIHM）。 除此之外，仍有多个与PIHM耦合的研究正在进行，如与湖泊、农业、经济的耦合研究。 在PIHM模型快速发展的同时，Kumar(Mukesh Kumar 2009)，在PIHM v2.0基础上设计了 Finite volume-based Integrated Hydrologic Modeling (FIHM)模型，使用二阶精度和三维流动模拟水文过程。 下图展示了PIHM模型的发展和分支： Figure 1: PIHM和SHUD模型的发展和分支。 PIHMgis和rSHUD分别是支持PIHM和SHUD的数据前后处理工具。 PIHMgis使用C++写成，rSHUD使用R. 1.3.3 重要时间线 2005 PIHM v1.0 曲轶众 (Qu and Duffy 2007; Qu 2004)在宾州州立大学博士期间，于其博士论文中基于“两态集成平衡”理论，开发并验证了PIHM模型。 此版本作为PIHM v1.0出现，成为PIHM模型的核心。 2009 PIHMgis Gopal Bhartt博士 (Bhatt 2012) 使用C++和Qt库建立了PIHMgis工具。PIHMgis在Qgis平台上实现了空间数据前处理、模型运行、结果数据分析的功能，有效地降低了初学者的使用门槛，极大地推动了模型的应用。 2015 MM-PIHM Yuning Shi博士领导和开发了MM-PIHM (Multi-Module PIHM)模型平台——集成并融合了PIHM家族的若干耦合模块。 诸如RT-PIHM, LE-PIHM, flux-PIHM, BGC-PIHM等等。 得益于科学家们的周密合作，MM-PIHM的多学科耦合实践很好地证明和实现了PIHM最初作为科学社区模型的理念。 2020 SHUD 舒乐乐博士继承了PIHM的理念和经验，开发了SHUD模型(Shu, Ullrich, and Duffy 2020)，并开发了支持SHUD模型数据前后处理、空间数据分析、模型自动校准、结果可视化的全套工具集。SHUD建模系统支持可重复、高效、全自动部署于全球大部分流域。 2022 SHUD v.2.0 SHUD研究组https://shud.xyz/并加入了湖泊模块吗，进一步完善了SHUD模型代码。v2.0的代码与v1.0并不完全兼容，且输入输出文件的格式有较大改进。本文内容以SHUD内容都是基于SHUD最新版本。 1.3.4 SHUD与PIHM的区别 SHUD模型是PIHM的一个继承者，继承了1996年由Duffy提出的二相耦合概念模型，并且继承了部分PIHM 1.0和2.0当中的成熟经验。之后作者修改了模型中部分过程、计算和实现语言，SHUD模型已经与PIHM模型不再兼容，因此使用新名称对模型进行命名。 SHUD与PIHM的区别： SHUD使用C++面向对象编程，将计算封装起来，避免内存泄露等PIHM常见问题。 SHUD使用了不同的坡面与河道的交互。PIHM中河道与两个三角形坡面相邻，带来了四个问题：1） 河道的长度极大的影响和模型的计算单元数量，用户不得不在简单河道和计算单元数量之间做权衡。2） 平原地区的河道绵延曲折，导致大量微小三角形单元和非结构三角形，使得模型计算容易突破库容常数而使得模型变慢。3）容易出现局部积水点（sink），个别积水点就可以极大地拖慢整个流域的求解速度。 4）为解决以上问题，模型用户需要反复手动对河流形状进行修改，降低了模型的可重复性和效率。SHUD的河道覆盖在三角形单元之上，坡面和河道水量交换给予河道水位和地下水、地表水的坡度计算，整体计算效率显著提升。 SHUD模型中计算入渗、地下水补给和河流交互的公式与PIHM不同。公式的采用基于经验和模型设计时的需求。未来将会就此进行模型对比，展示两个模型的差异。 SHUD模型确保了计算中的水量平衡。 在技术层面SHUD模型： 支持CVODE 5.0及以上版本 支持OpenMP并行计算 采用和与PIHM不同的数据结构和算法 支持可读性强地输入和输出文件 统一的时间序列数据操作 指定步长输出模型状态，作为后续模型运行的初始条件。 自动检查模型的输入数据和参数的有效性 加入模型调试选项，监控每一步长内的非法值和内存操作。 1.4 SHUD模型的特点 SHUD模型是一个物理性分布式水文模型，精确描述流域水文物理过程。物理性模型可用于无观测流域的模拟研究。 SHUD表达了流域中的空间异质性。水文空间异质性的表达有利于耦合模型研究，例如详细描述了水从山坡回流的路径，有利于生物化学、污染物运动、地貌变迁、湖泊生态等等方面的耦合研究。 SHUD是全耦合模型，在每一时间不步长所有水文状态量都要满足基本求解器的收敛性要求，保证了水文便利在空间上的连续性、一致性和收敛性。 SHUD模型使用CVODE 5.0+(Hindmarsh et al., 2005) 作为常微分方程求解器。 CVODE由劳伦斯利弗莫尔国家实验室开发和维护。 SHUD可使用灵活的时间和空间步长，适应多种尺度的模拟需求。 SHUD支持高空间时间分辨率的洪水模拟，也支持长时间序列的气候和土地利用变化研究。 SHUD是开源模型，任何人（非商业用途）都可使用、修改此模型。 1.5 参考文献 当利用SHUD模型从事科研工作时，请依次合理引用以下三篇文章： L. Shu, P. A. Ullrich, C. J. Duffy, Simulator for Hydrologic Unstructured Domains (SHUD v1.0): numerical modeling of watershed hydrology with the finite volume method. Geosci. Model Dev. 13, 2743–2762 (2020). Y. Qu, C. J. Duffy, A semidiscrete finite volume formulation for multiprocess watershed simulation. Water Resour. Res. 43, 1–18 (2007). C. J. Duffy, A Two-State Integral-Balance Model for Soil Moisture and Groundwater Dynamics in Complex Terrain. Water Resour. Res. 32, 2421–2434 (1996). 以下为时间排序的SHUD相关研究文章： Shu, Ullrich, and Duffy (2020) Shu, Ullrich, et al. (2024) Shu, Li, et al. (2024) Shu, Chen, et al. (2024) 舒乐乐 et al. (2024) Chang et al. (2024) Qu (2004) Qu and Duffy (2007) Li (2008) M. Kumar, Duffy, and Reed (2004) Mukesh Kumar, Bhatt, and Duffy (2009) Yu et al. (2015) Yu et al. (2014) Li and Duffy (2011) Shi, Baldwin, et al. (2015) Shi, Davis, et al. (2015) Bhatt, Kumar, and Duffy (2014) References "],["theory.html", "Chapter 2 理论与公式 2.1 流域水循环 2.2 建模思路 2.3 气象驱动 2.4 能量过程 2.5 模型结构及原理", " Chapter 2 理论与公式 本章节尚未完成，有关内容可以参考我们已经发表的文献，有详细阐述。 也可以从源代码中解读。 2.1 流域水循环 流域中水文循环基本框架，包含了高寒冰冻圈要素、地表水、地下水以及河流水文过程。 2.2 建模思路 2.2.1 水量平衡 水量平衡(或称为物质守恒)是水文模型的基础，可以简单总结为，流域系统内水储量变化要等于输入系统的水量与从系统重输出的水量之差，即\\[\\Delta S = Q_{in} - Q_{out}\\]， 式中，\\(\\Delta S\\)为计算单位的水储量，\\(Q_{in}\\)为输入水量之和，\\(Q_{out}\\)为输出水量之和。在不同的流域单元数，都遵守这个基本物质守恒原理，但具体的输入输出量的含义、方向、量级都有不同表现。 2.2.1.1 流域水量平衡 在流域尺度最简单的水量平衡总结为： \\[\\begin{equation} \\Delta S = P - E - Q \\label{#eq:basin} \\end{equation}\\] 式中，\\(\\Delta S\\)为计算单位的水储量，\\(P\\)为计算单元中的降水量，\\(E\\)为蒸散发总量, \\(Q\\)则为从流域河流的出口流出的径流总量。 这个流域水量平衡公式貌似简单，但它有很多变幻形式，往往是初学者难以掌握或者容易出错的地方。 有四个要点： 时间尺度 包含组分 变量单位 假设条件 尽管无论何时(??)都是适用的，但是在不同条件下，其所具有的含义不同。例如，\\(\\Delta S\\)所包含的意义。 在年尺度或多年尺度上，我们关心的储量变化是冰川体积、土壤含水量、地下水（冰）储量、湖泊储水量、河道储水量。 但在较小的时间尺度上（日、月），我们需要需要考虑植被储水量、积雪、人类活动中的取用水量等。在小时尺度上，则需要考虑地表积水、植被截留等。小时间尺度上所关心的变量在长时间尺度上往往可以忽略不计，或者因为长时间的平均效应而趋近于0。例如，积雪。在日和月尺度上，一部分降水在冬季以降雪的形式出现，在地表形成积雪，这些积雪将在几个月的夏季进入融化状态。冬季积雪储量处于增加状态，在夏季则逐渐融化释放，在下一个冬季来临之前基本全部融化。在月的尺度上看，积雪储量始终都在变化，是不可忽略的因素。而在多年尺度上，积雪在一部分时间里积累、另一部分时间里面融化，积雪总储量不会增加。如果积雪多年不融化，则其将发展为冰川的形成过程，则属于是另外一个过程。 \\(\\ref{eq:2-2}\\)中的单位可以是深度单位，也可以是速率单位。比如常用的立方米、毫米、毫米/年。实际的语言表达则需要注意。 当使用毫米单位时，隐含了时间信息。 例如，一个流域30年统计表明年降雨量500毫米，蒸发量200毫米，径流量300毫米。则公式写为： \\(\\Delta S \\mathrm{(0 ~mm)} = P\\mathrm{(500 ~mm)} - E\\mathrm{(200 ~mm)} - Q \\mathrm{(300 ~mm)}\\)。 公式表达了在年尺度的平均水量平衡，500，200， 300等数都是一年时间范围内的平均水量。当所有变量都乘以流域面积时，上面公式的单位则表达体积水量(立方米)，表达含义相同。 公式也可以表达为\\(\\Delta S \\mathrm{(0 ~mm/a)} = P\\mathrm{(500 ~mm/a)} - E\\mathrm{(200 ~mm/a)} - Q \\mathrm{(300 ~mm/a)}\\)，则显式的表达了年尺度的统计特征。 同时，以上水量平衡也可以表达为 \\[\\Delta S \\mathrm{(0\\times30 ~mm)} = P\\mathrm{(500\\times30 ~mm)} - E\\mathrm{(200\\times30 ~mm)} - Q \\mathrm{(300\\times30 ~mm)}\\] \\[\\Delta S \\mathrm{(0 ~mm)} = P\\mathrm{(15000 ~mm)} - E\\mathrm{(6000 ~mm)} - Q \\mathrm{(9000 ~mm)}\\] 则其表达的是30年时间范围的的总水量平衡。 2.2.2 边界条件 对于流域问题，基本的边界条件假设为： 1. 流域为封闭边界，即，（除了出口径流外），没有外部水源从水平方向补给流域，流域也不存在水平方向上向外部输出过程。 2. 降水为垂直方向的外部物质输入。 3. 流域底部存在一个零通量（不透水）的基岩面。这一假设在绝大部分条件下成立；在某些已知深层基岩或深层地下水活动的情境下，可以灵活设置透水底部边界条件。 2.3 气象驱动 2.3.1 降雨 2.3.2 蒸散发 2.3.3 风廓线 (Wind profile) Equation 2.3 in (Abtew and Melesse 2012) \\[\\begin{equation} \\boldsymbol{u}_{x}=\\boldsymbol{u}_{m} \\frac{\\ln \\frac{z_{x}-d}{z_{0}}}{\\ln \\frac{z_{m}-d}{z_{0}}} \\end{equation}\\] \\(u_x\\) - 目标高度的风速 [\\(m s^{-1}\\)] \\(u_m\\) - 测量高度的风速 [\\(m s^{-1}\\)] \\(z_x\\) - 目标高度 [\\(m\\)] \\(z_m\\) - 测量高度 [\\(m\\)] \\(d\\) - 零平面 [\\(m\\)] \\(z0\\) - 粗糙度(Roughness height) [\\(m\\)] FAO56 植被覆盖的 开放水面和裸露土地的潜在蒸发(PET of bare soil and open water) \\[\\begin{equation} \\lambda E_{a}=c_{2} \\frac{e_{a}-e_{d}}{r_{a}} \\end{equation}\\] \\(E_a\\) 是同温蒸发率(Isothermal evaporation rate)。 \\[\\begin{equation} \\mathrm{E}_{\\mathrm{o}}=\\frac{\\Delta\\left(\\mathrm{R}_{\\mathrm{n}}-\\mathrm{G}\\right) / \\lambda+\\gamma \\mathrm{E}_{\\mathrm{a}}}{\\Delta+\\gamma} \\end{equation}\\] 2.4 能量过程 ** *能量过程的计算仅在陆面-水文耦合的L-SHUD模型中启用 ** 2.4.1 辐射 \\(\\vec{L}=L \\uparrow-L_{a t m} \\downarrow\\) \\(T_{r a d}=\\left(\\frac{L \\uparrow}{\\sigma}\\right)^{1 / 4}\\) \\(L \\uparrow=\\left(1-\\varepsilon_g\\right) L_{a t m} \\downarrow+\\varepsilon_g \\sigma\\left(T_g^n\\right)^4+4 \\varepsilon_g \\sigma\\left(T_g^n\\right)^3\\left(T_g^{n+1}-T_g^n\\right)\\) 2.4.2 地表能量平衡 \\(R_n + L_w = H_l + H_s + G\\) \\(R_n\\)： 短波辐射(input) \\(L_w\\)： 长波辐射(input) \\(H_l\\)： 潜热 \\(H_s\\)： 感热 \\(G\\)： 土壤热通量 \\(H=-\\rho_{a t m} C_p \\frac{\\left(\\theta_{a t m}-\\theta_s\\right)}{r_{a h}}\\) \\(e_{a t m}=\\frac{q_{a t m} P_{\\mathrm{atm }}}{0.622+0.378 q_{\\mathrm{atm }}}\\) \\(\\rho_{\\mathrm{atm }}=\\frac{P_{a t m}-0.378 e_{a t m}}{R_{d a} T_{a t m}}\\) 在陆面模型中，地表辐射能量平衡的计算涉及到多个物理过程和参数。以下是一些基本的计算公式： 地表反照率（Albedo, \\(a\\)）: \\[ a = \\frac{R_{\\text{reflected}}}{R_{\\text{incoming}}} \\] 其中，\\(R_{\\text{reflected}}\\) 是反射的太阳辐射，\\(R_{\\text{incoming}}\\) 是入射的太阳辐射。 吸收的太阳辐射（\\(R_{\\text{absorbed}}\\)）: \\[ R_{\\text{absorbed}} = R_{\\text{incoming}} - R_{\\text{reflected}} \\] 地表发射的长波辐射（\\(L_{\\text{emitted}}\\)）: \\[ L_{\\text{emitted}} = \\epsilon \\sigma T^4 \\] 其中，\\(\\epsilon\\) 是地表的发射率，\\(\\sigma\\) 是斯特藩-玻尔兹曼常数（约为 \\(5.67 \\times 10^{-8}\\) W m^-2 K^-4），\\(T\\) 是地表温度。 大气发射的长波辐射（\\(L_{\\text{atm}}\\)）: \\[ L_{\\text{atm}} = \\epsilon_{\\text{atm}} \\sigma T_{\\text{atm}}^4 \\] 其中，\\(\\epsilon_{\\text{atm}}\\) 是大气的发射率，\\(T_{\\text{atm}}\\) 是大气温度。 净长波辐射（\\(L_{\\text{net}}\\)）: \\[ L_{\\text{net}} = L_{\\text{emitted}} - L_{\\text{atm}} \\] 净辐射（\\(R_{\\text{net}}\\)）: \\[ R_{\\text{net}} = R_{\\text{absorbed}} - L_{\\text{net}} \\] 感热通量（\\(Q_{\\text{H}}\\)） 和 潜热通量（\\(Q_{\\text{E}}\\)）: 这些通量通常与地表能量平衡的其他组成部分一起计算，它们与地表温度、湿度和风速有关。 土壤热通量（\\(G\\)）: \\[ G = \\text{导热项} + \\text{对流项} + \\text{辐射项} \\] 土壤热通量是土壤内部热量传递的量，通常通过数值方法求解。 能量平衡闭合: \\[ R_{\\text{net}} + Q_{\\text{H}} + Q_{\\text{E}} + G = 0 \\] 这个方程确保了能量的守恒。 请注意，这些公式是简化的表示，实际的模型可能会包含更多的细节和复杂性，例如考虑不同波长的辐射、不同地表类型的反照率变化、云层的影响等。此外，模型中还可能使用经验公式或参数化方案来近似某些过程。如果你需要更详细的信息或者特定于CLM 5.0模型的公式，你可能需要查阅该模型的文档或源代码。 2.5 模型结构及原理 SHUD已广泛应用于不同水文气候和多种尺度的水文过程模拟，时间尺度从小时至百年，空间尺度从1平方米至100,000平方公里，涵盖北美洲、亚洲和非洲等多个流域的湖泊、洪水和水资源研究等（Shu et al., 2020; Gil et al., 2021; 舒乐乐 等，2022）。基于Freeze和Harlan的“基于物理的水文响应模型蓝图”（Freeze &amp; Harlan, 1969），SHUD模型利用理查兹方程（公式\\(\\ref{eq:2-1}\\)）计算地下水流动，利用曼宁公式（公式\\(\\ref{eq:2-4}\\)）计算地表水流动，利用圣维南方程（公式\\(\\ref{eq:2-2}\\)）描述计算地表水质量守恒，利用（公式\\(\\ref{eq:2-3}\\)）描述地下水质量守恒（舒乐乐 等，2022，2024）。SHUD在前期数据准备阶段随机划分计算单元，能够精细描述研究区地形土壤及气象等要素分布特征和描述流域的水文物理过程，实现对区域乃至全局水文响应的综合模拟，源代码和详细说明书可通过项目网站（https://www.shud.xyz）或GitHub页面（https://github.com/shud-system/shud）获得。 \\[\\begin{equation} q=-k_e(h) \\nabla(h+z)\\tag{2-1} \\label{eq:2-1} \\end{equation}\\] \\[\\begin{equation} \\frac{\\partial h}{\\partial t}=\\nabla \\cdot(v h)-\\frac{Q_e}{A}+\\frac{Q_{s u}}{A}c\\tag{2-2} \\label{eq:2-2} \\end{equation}\\] \\[\\begin{equation} S_w(h) \\frac{\\partial h}{\\partial t}=\\nabla \\cdot q+\\frac{Q_e}{V}+\\frac{Q_{s s}}{v}\\tag{2-3} \\label{eq:2-3} \\end{equation}\\] \\[\\begin{equation} v=n^{-1} R^{\\frac{2}{3}} S_f^{\\frac{1}{2}}\\tag{2-4} \\label{eq:2-4} \\end{equation}\\] 其中， q为流量，单位为\\(L^3L^{-2}T^{-1}\\)； h为水头高度，单位为\\(L\\)； \\(k_e(h)\\)为水力传导度，是土壤含水量或者基质势的函数，单位为\\(LT^{-1}\\)； z为高程，单位为\\(L\\)；v为流速，单位为\\(LT^{-1}\\)；t为时间，单位为\\(T\\)； A为控制单元垂直投影面积，单位为\\(L^2\\)； \\(Q_e\\)为地表与地下水交互流量，单位为\\(L^3 T^{-1}\\)； \\(Q_{su}\\)为地表水的源汇项，单位为\\(L^3 T^{-1}\\)； \\(S_w(h)\\)为储水系数，其物理含义为其物理意义为含水层的水头降低/升高一个单位时，单位体积的含水层释放/吸收的水量，单位为\\(L^3 L^{-3}L^{-1}\\)； V为控制单元体积，单位为\\(L^3\\)， \\(Q_{ss}\\)为地下水或土壤水的源汇项，单位\\(L^3 T^{-1}\\)； n为曼宁系数，单位为\\(TL^{-1/3}\\)； R为水力半径，单位为\\(L\\)； \\(S_f\\)为摩擦坡度，单位为\\(LL^{-1}\\)。 SHUD是典型地表－地下耦合的数值方法分布式水文模型，其与其他模型相比所具有的优势也是本研究选择该模型进行研究最主要的原因。地表－地下全过程耦合的分布式水文模型作为分布式模型中一个特殊类别，相较于传统分布式水文模型，实现了利用数值方法将地表－地下水文过程的物理耦合，可以更好地刻画复杂地形地貌水文过程，也能更好表达流域空间异质性（舒乐乐 等，2022）。物理性分布式水文模型在表达空间异质和刻画水文过程中优于概念模型和集总式模型（舒乐乐 等，2022）。 时空连续性是数值方法模型相比于传统水文模型的显著优势。在时间离散方面，SHUD采用有限体积法求解流域水文学的常微分方程，包括地表水流、非饱和层和饱和层流动以及河道水流过程，以获得空间上的水储量和流量。空间网格可以分为非结构如不规则的三角形和结构化如正方形，SHUD模型使用非结构化三角形网格。SHUD模型保证了水文变量的连续性、一致性和收敛性，也保证了模型局地和全局的水量平衡。数值方法一个典型特征是地表和地下耦合，圣维南方程跟理查兹方程要耦合起来，SHUD模型使用一阶变量交换，主要指地表地下水的交互之间的变量交换。SHUD模型耦合方式为全局隐式，地表水储量的水头高度与地下水和土壤水水头高度在同一个方程中。河道与坡面单元关系有相邻和交叉的方式，SHUD模型使用交叉方法，优势在于网格的密度与河流的绵延程度及分割长度等河流单元的分辨率无关，使得每个单元和固定相交的某个河道单元进行水量交互。空间离散上，坡面和河流分别使用非结构性三角形网格和梯形河道单元描述，垂直方向包括地表层、非饱和层和饱和层。因为在较大尺度上，非饱和层水平流动水量远小于垂直方向流量，因此部分模型忽略壤中流计算或者实质上将其隐含在地表和地下水水平流动中（Shu et al., 2020）。 图2-4 SHUD模型的水平空间结构（a）、河流网络拓扑关系（b）和垂直分层关系（c）（引自舒乐乐 等，2022）Figure 2-4 The lateral spatial structure(a), river topology(b) and vertical layers(c) 本文只介绍 SHUD模型的基本原理，其原理图如图2-3所示，具体细节及更新可以参考（Shu et al., 2020, 2024a,2024b）以及其后续发展的文章。模型模拟的过程包括植被截流、融雪积累/消融、蒸散发、入渗、地下水补给、地表坡面流、地下水基流和河道双向流动等。 2.5.1 植被冠层截留 植被冠层截留：指暂时保存在植物表面及枝干的部分降水，即被植被拦截的降水量。在降水初期或降水量较小时，几乎全部降水被植被截留；达到最大截留量之后，降水全部下落至地面。在SHUD模型中，将截流过程类比为水桶模型，水桶的最大蓄水量即为最大截留量。若现有截留量小于等于0，当降水小于最大截留量，则截留量等于降水；当降水大于最大截留量，则截留量为最大截留量；若现有截留量大于0但小于最大截留量，则截留量为最大截留量与现有截留量之差或当前降水中的较小值；若当前截留量大于等于最大截留量时，拦截能力为0，即此时及之后的所有降水全部穿过植被到达地表。最大截留量计算公式如下： \\[\\begin{equation} S_{i c}^*=C_{i c} L A I \\end{equation}\\] 其中： \\(C_{ic}\\)为截留系数，单位为m，默认值为0.2 \\(kgm^{-2}\\)（Dickinson, 1984）； LAI为叶面积指数（leaf area index），单位为\\(m^2m^{-2}\\)；\\(S_{ic}^*\\)为最大截留量，单位为m。 截留量计算公式如下： \\[\\begin{equation} \\mathrm{q}_{\\mathrm{ic}}=\\begin{array}{lr} \\min \\left[\\frac{\\mathrm{s}_{\\mathrm{ic}}^*}{\\Delta \\mathrm{t}}, \\mathrm{P}\\right] &amp; \\mathrm{S}_{\\mathrm{ic}} \\leq 0 \\\\ \\min \\left[\\frac{\\left.\\mathrm{~S}_{\\mathrm{ic}}^*-\\mathrm{S}_{\\mathrm{ic}}\\right)}{\\Delta \\mathrm{t}}, \\mathrm{P}\\right] &amp; 0&lt;\\mathrm{S}_{\\mathrm{ic}}&lt;\\mathrm{S}_{\\mathrm{ic}}^* \\\\ 0 &amp; \\mathrm{~S}_{\\mathrm{ic}} \\geq \\mathrm{S}_{\\mathrm{ic}}^* \\end{array} \\end{equation}\\] 其中： \\(S_{ic}\\)为现有截留量，单位为m； \\(q_{ic}\\)为截留量，即冠层截流后保存于植物表面的部分降水，单位为\\(md^{-1}\\); \\(P\\)为降水量，单位为\\(md^{-1}\\)。 冠层截留水量平衡方程描述冠层截留水储量随时间变化的过程，即冠层水储量等于截留量减去冠层截流水的蒸发量。其中，截留量是降水量减去穿透冠层到达地表的降水量，即被植被截留的部分；冠层截流水的蒸发量是指截留在植被上的水分通过蒸发释放到大气中的过程。其公式如下： \\[\\begin{equation} \\frac{d S_{i c}}{d t}=q_{i c}-E_{i c} \\end{equation}\\] 其中： \\(E_{ic}\\)为冠层截流水的蒸发量，单位为\\(m^3m^{-2}d^{-1}\\)。 2.5.2 蒸散发 蒸散发：是流域水分流失的主要途径，包含陆地上通过蒸发和植被蒸腾向上流失的水分之和，是全球和流域水文循环中的重要环节。潜在蒸散发：指水量充足条件下蒸散发量，采用联合国粮农组织FAO（Food and Agriculture Organization of the United Nations）推荐使用的彭曼-蒙斯特公式PM（Penman-Monteith）计算，计算公式如下： \\[\\begin{equation} \\mathrm{E}_0=\\frac{1}{\\lambda} \\frac{\\Delta\\left(\\mathrm{R}_{\\mathrm{n}}-\\mathrm{G}\\right)+\\rho_{\\mathrm{a}} \\mathrm{c}_{\\mathrm{p}} \\frac{\\left(\\mathrm{e}_{\\mathrm{s}}-\\mathrm{e}_{\\mathrm{a}}\\right)}{\\mathrm{r}_{\\mathrm{a}}}}{\\Delta+\\gamma\\left(1+\\frac{\\mathrm{r}_{\\mathrm{s}}}{\\mathrm{r}_{\\mathrm{a}}}\\right)} \\end{equation}\\] 其中， \\(E_0\\)为使用PM公式计算的潜在蒸散发，单位为\\(kgm^{-2}s^{-1}\\)； \\(\\lambda\\)为蒸散发潜热，单位为\\(MJkg^{-1}\\)； \\(\\Delta\\)为饱和水汽压对应温度曲线的斜率，单位为\\(kPaK^{-1}\\)； \\(Rn\\)为净辐射，单位为\\(MJm^{-2}s^{-1}\\)；G为地面热量损失，单位为\\(MJm^{-2}s^{-1}\\)； \\(\\rho_a\\)为空气密度，单位为\\(kgm^{-3}\\)； \\(c_p\\)为空气比热容量，单位为\\(MJkg^{-1}K^{-1}\\)； \\(e_s\\)为气温下的空气饱和水汽压，单位为\\(kPa\\)； \\(e_a\\)为气温下的空气水汽压，单位为\\(kPa\\)； \\(r_a\\)为总体空气动力学扩散阻抗，单位为\\(sm^{-1}\\)； \\(r_s\\)为总体冠层扩散阻抗，单位为\\(sm^{-1}\\)； \\(\\gamma\\)为湿度常数，单位为kPa。 实际蒸散发是由截留蒸发\\(E_c\\)、土壤直接蒸发\\(E_s\\)和植被蒸腾\\(E_t\\)三部分组成的水分蒸发。\\(E_c\\)为截留蒸发为冠层水储量对应的潜在蒸散发的最大值。计算公式如下： \\[\\begin{equation} \\mathrm{E}_{\\mathrm{c}}=\\max \\left[\\mathrm{S}_{\\mathrm{ic}} / \\Delta \\mathrm{t}, \\mathrm{E}_0\\right] \\end{equation}\\] 土壤直接蒸发\\(E_s\\)为土壤表面直接蒸发的水分量，植被蒸腾\\(E_t\\)为指植物通过根部吸收土壤中的水分，经过植物体内的蒸腾过程释放到大气中的水分量，两者之和为地表实际蒸发。\\(E_s\\)由积水蒸发\\(E_{sp}\\)和土壤水分蒸发\\(E_{sm}\\)组成。计算过程中，首先考虑积水的蒸发，当积水量满足蒸发时，只消耗地表积水；否则\\(E_s\\)则由全部地表积水和土壤水分组成；当地表无积水时\\(E_s\\)只由土壤水分组成。计算公式如下： \\[\\begin{array}{rlr}E_{s p}=E_{s} &amp; E_{s m}=0 &amp; y_{s f}&gt;E_{s} \\times \\Delta t \\\\\\left\\{E_{s p}=y_{s f} / d_{t}\\right. &amp; E_{s m}=E_{s}-E_{s p} &amp; y_{s f}&lt;E_{s} \\times \\Delta t \\\\E_{s p}=0 &amp; E_{s m}=E_{s} &amp; y_{s f} \\leq 0\\end{array}\\] 其中，\\(y_{sf}\\)为地表积水，单位为m。 潜在蒸散量（PET）是使用PM公式计算的，而实际蒸散量（AET）是通过将PET乘以土壤水分胁迫系数得出的，该系数由土壤含水量和地下水位深度决定。 \\[\\begin{equation} E_s=E_0 \\beta_s\\left(1-\\alpha_{i m p}\\right)\\left(1-\\alpha_{\\text {veg }}\\right) \\end{equation}\\] 其中， \\(\\beta_s\\)为土壤水分胁迫系数； \\(\\alpha_{imp}\\)为不透水面积分数； \\(a_{veg}\\)为植被覆盖度。 \\(E_t\\)由来自土壤水和地下水两部分组成，当地下水位高于根深时，植被蒸腾使用地下水，蒸腾时对应的土壤水分胁迫\\(β_s\\)为1，因为此时植物根系可以获取充足的水分，蒸腾对土壤水分的利用没有限制。 \\[\\begin{equation} E_t=E_0 \\beta_s\\left(1-\\alpha_{i m p}\\right) \\alpha_{v e g} \\end{equation}\\] 。土壤水分胁迫是指土壤中水分供应不足导致植物受到水分限制的状态，此时植物生长及其蒸腾都受水分多少的影响。\\(β_s\\)是水文模型中考虑的重要参数之一，综合考虑\\(ɑ_{imp}\\)和\\(β_s\\)有助于更全面展现土壤蒸发和植被蒸腾的过程，计算公式如下： \\[\\begin{equation} \\beta_{\\mathrm{s}}=\\frac{\\theta-\\theta_{\\mathrm{r}}}{\\theta_{\\mathrm{fc}}-\\theta_{\\mathrm{r}}} \\end{equation}\\] 其中， \\(\\theta\\)为土壤含水量； \\(\\theta_{fc}\\)为田间持水量； \\(\\theta_r\\)为剩余土壤含水量。 2.5.3 积雪 积雪采用度日模型：在温带或山地气候地区，降雪积累和融化是一个重要的地表过程，也是土壤水分和补给的重要来源。融化积雪产生的水量直接补给地表水。在SHUD模型中采用度日模型（degree-day model）（Finsterwalder et al., 1887）来模拟积雪的融化过程，假设融雪量与空气温度及临界温度之差成正比，可以更精准模拟积雪融化过程及其对径流的影响。通过积温来估算积雪融化量，\\(m_f\\)为融雪因子，单位为\\(ms^{-1}℃^{-1}\\)，\\(T\\)为空气温度，\\(T_0\\)为融雪时对应的临界温度，一般按照经验取值。积雪融化速度计算公式如下： \\[\\begin{equation} q_{s n}=\\left(T-T_0\\right) \\times m_f \\end{equation}\\] 其中， \\(q_{sn}\\)为积雪融化速度，单位为\\(ms^{-1}\\)。 积雪对应的水量平衡方程可以表示降雪储量，降雪储量等于降雪量减去积雪升华和积雪融化量，计算公式如下： \\[\\begin{equation} \\frac{d S_{s n}}{d t}=P_{s n}-q_{s n} \\end{equation}\\] 其中， \\(S_{sn}\\)为积雪储量，单位为\\(m\\)； \\(P_{sn}\\)为降雪量，单位为\\(ms^{-1}\\)。 2.5.4 地表水 地表坡面流近似视为二维浅水流动，使用扩散波（曼宁公式）进行计算，计算公式如下： \\[\\begin{equation} Q_s^j=\\frac{L_j}{n} \\overline{y_{s f}}^\\frac{5}{3} S_0^{\\frac{1}{2}} \\end{equation}\\] 其中， \\(Q_s^j\\)为三角形沿方向j的坡面漫流，单位为\\(m^3s^{-1}\\)； \\(L_j\\)为单元j边长度，单位为m；n为曼宁系数，单位为\\(sm^{-1/3}\\)； \\(S_0\\)为地表坡度。 \\[\\begin{equation} \\overline{y_{s f}}= \\begin{cases}y_{s f} &amp; z_{s f}+y_{s f} \\geq z_{s f}^j+y_{s f}^j \\\\ y_{s f}^j &amp; z_{s f}+y_{s f}&lt;z_{s f}^j+y_{s f}^j\\end{cases} \\end{equation}\\] 其中， - \\(y_{sf}\\)为计算坡面流的有效水头高度，由两个单元之间的坡度决定，单位为m，计算公式如下： 地表水对应的水量平衡由变化水储量由净降水量\\(P_n\\)、入渗量\\(q_i\\)、地表积水蒸发量\\(E_{sp}\\)、地表水流动量共同决定。对应的公式如下： \\[\\begin{equation} \\frac{d y_{s f}}{d t}=P_n-E_{s p}-q_i-\\sum_{j=1}^3 \\frac{Q_s^j}{A_c} \\end{equation}\\] 其中， \\(y_{sf}\\)为单元格的地表积水高度，单位为m； \\(P_n\\)为到达地面的净降水量，单位为\\(ms^{-1}\\) ；\\(E_{sp}\\)为地表水面蒸发量，单位为\\(ms_{-1}\\)； \\(q_i\\)为入渗量，单位为\\(ms^{-1}\\)； \\(A_c\\)为三角形坡面单元面积，单位为\\(m^2\\)。 其中净降水量\\(P_n\\)为考虑降水P、植被截留\\(S_{ic}\\)和积雪融化\\(Q_{sn}\\)后到达地面的降水量； \\[\\begin{equation} P_n=P-S_{i c}+q_{s c} \\end{equation}\\] 其中入渗量由理查兹方程计算，入渗发生在表层土壤，入渗速率由积水高度和土壤湿度共同决定。计算公式如下： \\[\\begin{equation} q_i=K_{e i}(\\Theta)\\left(1+\\frac{y_s}{D_{i n f}}\\right) \\end{equation}\\] 其中， \\(q_i\\)为入渗速率，向下为正方向，单位为\\(ms^{-1}\\)； \\(K_{ei}\\)为有效渗透水力传导度，单位为\\(ms^{-1}\\)；为相对饱和比； \\(D_{inf}\\)为下渗发生的地表土层厚度。 \\(y_s/△t\\)将积水、灌溉和降水结合起来，共同决定表层土壤的水力梯度。表层土壤的水力梯度可以通过单位时间内的水分量（\\(y_s\\)）除以时间间隔（△t）来计算，水分量包括来自积水、灌溉和降水的影响。 \\[\\begin{equation} \\mathrm{K}_{\\mathrm{ei}}(\\Theta)= \\begin{cases}\\mathrm{K}_{\\mathrm{r}}(\\Theta) \\mathrm{k}_{\\mathrm{x}}\\left(1-\\alpha_{\\mathrm{h}}\\right)+\\alpha_{\\mathrm{h}} \\mathrm{k}_{\\mathrm{m}} \\Theta &amp; \\mathrm{y}_{\\mathrm{s}} / \\Delta \\mathrm{t} \\geq \\mathrm{K}_{\\max } \\\\ \\mathrm{K}_{\\mathrm{r}}(\\Theta)\\left(1-\\alpha_{\\mathrm{h}}\\right) &amp; \\mathrm{y}_{\\mathrm{s}} / \\Delta \\mathrm{t}&lt;\\mathrm{K}_{\\max }\\end{cases} \\end{equation}\\] 其中， \\(K_{ei}\\)为有效渗透水力传导度，单位为\\(ms^{-1}\\)； \\(K_r\\)为相对水力传导度，是饱和比的函数； \\(k_x\\)为表层土的饱和水力传导度，单位为\\(ms^{-1}\\)； \\(ɑ_h\\)为水平大孔隙面积比； \\(k_m\\)为土壤大孔隙饱和水力传导度，单位为\\(ms^{-1}\\)。 \\[\\begin{equation} \\mathrm{K}_{\\mathrm{r}}(\\Theta)=\\Theta^{\\frac{1}{2}}\\left(-1+\\left(1-\\Theta^{\\frac{\\beta}{\\beta-1}}\\right)^{\\frac{\\beta-1}{\\beta}}\\right)^2 \\end{equation}\\] 其中，\\(K_r\\)为相对水力传导度，是饱和比的函数；β为van Genuchten土壤参数。 \\(K_{max}\\)由土壤基质和大孔隙共同决定。当单位时间内的水分量（\\(y_s\\)）除以时间间隔（Δt）小于最大入渗量（\\(K_{max}\\)），入渗受土壤基质控制，入渗速率受土壤孔隙结构和土壤水分渗透能力的影响；而当\\(y_s/Δt\\)大于最大入渗量（\\(K_{max}\\)）时，表示入渗速度快于\\(K_{max}\\)，表明土壤已饱和，水分无法迅速渗透至地下，这时入渗由土壤基质和大孔隙共同决定。大孔隙通常能够提高土壤水的渗透能力，对于加快水分的入渗速度具有重要作用。SHUD模型入渗考虑了大孔隙效应，可以在强降水条件下加快入渗速度。考虑土壤中大孔隙的影响，模型能更准确地预测和模拟土壤入渗的过程，尤其在强降水条件下，大孔隙效应的考虑对于准确模拟水文过程非常重要。 \\[\\begin{equation} \\mathrm{K}_{\\max }=\\mathrm{k}_{\\mathrm{x}}\\left(1-\\alpha_{\\mathrm{h}}\\right)+\\alpha_{\\mathrm{h}} \\mathrm{k}_{\\mathrm{m}} \\end{equation}\\] 其中， \\(K_{max}\\)是有效土壤水力传导度，由土壤基质和大孔隙特性共同决定的入渗能力； \\(k_x\\)为表层土的饱和水力传导度，单位为\\(ms^{-1}\\)； \\(ɑ_h\\)为水平大孔隙面积分数，\\(k_m\\)为土壤大孔隙饱和水力传导度，单位为\\(ms^{-1}\\)。 2.5.5 2.3.5 土壤水 非饱和土壤水流动视为一维垂直流动，忽略非饱和层的水平流动，使用理查兹公式计算非饱和土壤水运动。土壤水对应的水量平衡方程描述了土壤水储量由入渗、补给和土壤蒸发蒸腾量共同决定。 \\[\\begin{equation}\\mathrm{s_y\\frac{dy_{us}}{dt}=q_i-q_r-E_{sm}}\\end{equation}\\] 其中， \\(s_y\\)为储水系数； \\(y_{us}\\)为非饱和水储量； \\(q_i\\)为入渗量； \\(q_r\\)为地下水补给量 ；\\(E_{sm}\\)为土壤蒸发蒸腾量。 土壤水分含量与田间持水量的比值是描述土壤水分状况的重要指标，通常用来控制补给速率和水文过程中的水分运动。 \\[\\begin{equation}\\mathrm{q_r=K_{er}~(\\frac{\\theta-\\theta_r}{\\theta_{fc}-\\theta_r})}\\end{equation}\\] 其中， \\(q_r\\)为地下水补给速率，向下为正方向，单位为\\(ms^{-1}\\)； \\(K_{er}\\)有效补给水力传导度，单位为\\(ms^{-1}\\)； θ为土壤含水量； \\(θ_{fc}\\)为田间持水量； \\(θ_r\\)为剩余土壤含水量。 \\[\\begin{equation}\\mathrm{K_{er}=\\frac{D_{us}+y_{gw}}{D_{us}/k_x+y_{gw}/k_v}}\\end{equation}\\] 其中， \\(K_{er}\\)有效补给水力传导度，单位为\\(ms^{-1}\\)； \\(D_{us}\\)为非饱和层厚度，单位为m； \\(y_{gw}\\)为地下水位（不透水基岩之上），单位为m； \\(k_x\\)为表层土的饱和水力传导度，单位为\\(ms^{-1}\\)； \\(k_v\\)为饱和层的饱和垂直水力传导度，单位为\\(ms^{-1}\\)。 2.5.6 地下水 达西定律描述了地下水渗流速率与水头梯度之间的关系，而Dupuit假设则认为地下水是水平均匀流动的。结合达西定律和Dupuit假设计算饱和地下水的水平流动。水量平衡方程描述了地下水储量由地下水补给量、植被由饱和层进行的蒸腾量和地下水基流共同决定。 \\[\\begin{equation} s_y \\frac{d y_{g w}}{d t}=q_r-E_{t g}-\\sum_{i=1}^3 \\frac{\\mathrm{o}_g^j}{A_c} \\end{equation}\\] 其中， \\(y_{gw}\\)为计算单元地下水水头（不透水基岩以上） ；\\(q_r\\)为地下水补给速率，向下为正方向，单位为\\(ms^{-1}\\)； \\(E_{tg}\\)来自饱和层的蒸腾速率，单位为\\(ms^{-1}\\)； \\(Q_{gj}\\)为三角形沿方向j的地下水流动，单位为\\(m^3s_{-1}\\)。 水平地下水通量\\(Q_{jg}\\)由达西定律和Dupuit–Forchheimer假设确定。两个单元之间的梯度为[(\\(y_{gw}\\)+\\(z_b\\))−(\\(y_{gw}^j\\)+\\(z_b^j}\\))]\\(d_j^{-1}\\)。沿地下水流的横截面积等于\\(L_j\\)×\\(y_{gw}\\)。 \\[\\begin{equation} Q_g^j=\\bar{K} \\cdot \\frac{\\left(y_{g w}+z_b\\right)+\\left(y_{g w}^j+z_b^j\\right)}{d_j} \\cdot\\left(L_j\\right) y_{g w}^{-} \\end{equation}\\] 其中， \\(z_b\\)为不透水基岩的高度； \\(y_{gw}^j\\)为j方向上计算单元地下水水头； \\(z_b^j\\)为j方向上不透水基岩的高度； \\(L_j\\)为单元格边j的长度，单位为m。 \\(z_b\\)为不透水基岩高程； \\(Z_j^b\\)是其第j个相邻单元的基准面高程， \\(d_j\\)为两个相邻单元质心之间的距离。 考虑不同单元之间的水力传导度，可以更准确地描述地下水流动方向和速率。地下水流的有效水力传导度是两个单元上有效水平水力传导度的平均值。 \\[\\begin{equation} \\overline{\\mathrm{K}}=\\left(\\mathrm{K}_{\\mathrm{eg}}+\\mathrm{K}_{\\mathrm{cg}}^{\\mathrm{j}}\\right) \\cdot 0.5 \\end{equation}\\] 其中， \\(K_{eg}\\)为有效水平水力传导度，单位为\\(ms^{-1}\\)。 有效水平水力传导度（\\(K_{eg}\\)）是描述地下水系统中水传导能力的重要参数，是地下水位和大孔隙特征的函数。当地下水位低于大孔隙水位时，\\(K_{eg}\\)等于饱和水力传导度；当地下水位高于大孔隙水位时，考虑到土壤剖面中大孔隙的水力传导度和面积分数，有效水力传导度随地下水位的升高而增大。地下水位到达地表后，有效水力传导度达到最大值，\\(K_{eg}\\)随着地下水位和土壤剖面特征的变化而变化，反映了地下水对于土壤水分运动和水文过程的不同影响。每个单元的有效水平水力传导度的计算公式如下： \\[\\begin{equation} \\begin{array}{ll} k_g &amp; z_m&gt;z_{g w} \\\\ K_{e g}(\\Theta)=\\left\\{\\frac{z_{g w}-z_m}{y_{g w}}\\left(k_m \\alpha_v+\\left(1-\\alpha_v\\right) k_g\\right)+k_g\\right. &amp; z_m&lt;z_{g w} \\end{array} \\end{equation}\\] 其中， \\(z_m\\)为大孔隙距基准面的高度，单位为m； \\(z_gw\\)为地下水位的高度，单位为m； \\(α_v\\)是垂直区域大孔隙分数。 \\[\\begin{equation} z_{\\mathrm{gw}}=y_{\\mathrm{gm}}+\\mathrm{z}_{\\mathrm{cb}} \\end{equation}\\] 2.5.7 河道水 下游河道流量\\(Q_{dn}\\)使用一维扩散波方程简化为明渠曼宁（Manning）方程来计算，基于一维流动的假设计算河道中水流的运动规律，公式如下： \\[\\begin{equation} Q_{d n}=\\frac{A_{c s}}{\\bar{n}}\\left(\\frac{A_{c s}}{P}\\right)^{\\frac{2}{3}} \\bar{S}_0^{\\frac{1}{2}} \\end{equation}\\] 其中, \\(Q_{dn}\\)为向下游河道的体积通量，单位为\\(m^3s^{-1}\\)； \\(A_{cs}\\)为河段的横截面积，单位为\\(m^2\\)；为平均曼宁系数，单位为\\(sm^{-1/3}\\)； P为河段及其下游河段的平均湿周长； \\(\\bar{S}_0\\)为河段及其下游河段的平均坡度。 在描述河流水文过程时，采用了三角形棱柱体元素来划分河流为多个河段，并考虑地表和地下水之间的交换以 及河段的水文过程。每个河段可以被视为一个水文单元，其水文过程可以通过质量平衡公式描述。每个河道中的质量平衡由四部分组成：与河道相交的单元产生的地表流，与单元相交的横向地下水通量，上游河道的纵向水流和流向下游河道的流量。上游通量等于多个上游河段之和。河道中的水平衡方程忽略了蒸发和降水，因为流域中的开放水域面积相对较小，且开放水域面积已包含在水文单元的计算中。河道水对应的水量平衡方程如下： \\[\\begin{equation} \\frac{d y_{\\text {riv }}}{d t}=\\frac{1}{A_r}\\left(\\sum_{j=1}^{j=N_c} Q_{s r}^j+\\sum_{j=1}^{j=N_c} Q_{g r}^j+\\sum_{j=1}^{j=N_u} Q_{u p}^j+Q_{d n}\\right) \\end{equation}\\] 其中， \\(Q_{sr}^j\\)为j方向上河流和坡面计算单元之间通过坡面流的体积通量，单位为\\(m^3s^{-1}\\)； \\(Q_{gr}^j\\)为河流与计算单元之间通过地下水流动的体积通量，单位为\\(m^3s^{-1}\\)； \\(Q_{up}^j\\)为第j个上游河段的体积通量，单位为\\(m^3s^{-1}\\)； \\(Q_{dn}\\)为流向下游河道的体积通量，单位为\\(m^3s^{-1}\\)；\\(N_c\\)为与河道相交的三角形数量； \\(N_u\\)为上游河道数量。 河流段和坡面单元之间的地下水交换用如下公式描述。 \\[\\begin{equation} Q_{s r}=L_s C_w b_s \\sqrt{2 g\\left|b_s\\right|} \\end{equation}\\] 其中， \\(Q_{sr}\\)为河流和坡面之间坡面流的体积通量，单位为\\(m^3s^{-1}\\)； \\(L_s\\)为覆盖计算单元的河段长度，单位为m； \\(C_w\\)为排放系数，单位为m； \\(b_s\\)为河段与坡面单元间坡面流的有效高度，单位为m； \\[\\begin{equation} H_{\\mathrm{riv}}=y_{\\mathrm{riv}}+z_{\\mathrm{rb}} \\end{equation}\\] \\[\\begin{equation} \\mathrm{H}_{\\mathrm{csf}}=\\mathrm{y}_{\\mathrm{rsf}}+\\mathrm{z}_{\\mathrm{cs}} \\end{equation}\\] 这种地形因素对于地表水文过程和水文特征的理解至关重要，陆地表面或河岸的相对高度控制着陆地表面和河段之间的水交换方向。 \\[\\begin{equation} \\begin{aligned} H_{\\text {riv }}-H_{\\text {csf }} &amp; H_{\\text {riv }}&gt;z_{\\text {bank }} \\text { 且 } H_{\\text {csf }}&gt;z_{\\text {bank }} \\\\ b_s=\\left\\{\\begin{array}{ll} H_{\\text { riv }} \\end{array}-z_{\\text {bank }}\\right. &amp; H_{\\text {riv }}&gt;z_{\\text {bank }} \\text { 且 } H_{\\text {csf }}&lt;z_{\\text {bank }} \\\\ H_{\\text {csf }}-z_{\\text {bank }} &amp; H_{\\text {riv }}&lt;z_{\\text {bank }} \\text { 且 } H_{\\text {csf }}&lt;z_{\\text {bank }} \\end{aligned} \\end{equation}\\] 其中， \\(H_{riv}\\)为河道水头，单位为m； \\(y_{riv}\\)为河道水位，单位为m； \\(z_{rb}\\)为河床高程，单位为m； \\(H_{csf}\\)为地表水头，单位为m； \\(y_{sf}\\)为计算单元地表水储量，单位为m； \\(z_{cs}\\)为，单位为m； \\(b_s\\)为河段与坡面单元间坡面流的有效高度，单位为m； \\(H_{riv}\\)为河道水头，单位为m； \\(H_{csf}\\)为地表水头，单位为m； \\(b_{ank}\\)为河岸或者堤防相对基准面的高程，单位为m； \\[\\begin{equation} \\mathrm{Q}_{\\mathrm{gr}}=\\mathrm{L}_{\\mathrm{s}} \\mathrm{~b}_{\\mathrm{g}} \\mathrm{~K}_{\\mathrm{gr}} \\frac{\\mathrm{H}_{\\mathrm{riv}}-\\mathrm{H}_{\\mathrm{cgw}}}{\\mathrm{~d}_{\\mathrm{rb}}} \\end{equation}\\] 其中， \\(Q_{gr}\\)为河流和计算单元之间的通过地下水流动的体积通量，单位为\\(m^3s^{-1}\\)； \\(L_s\\)为覆盖计算单元的河段长度，单位为m；\\(b_g\\)为河段与坡面单元间地下水有效水头高度，单位为m； \\(K_{gr}\\)为计算坡面与河道地下水交换的水力传导度，单位为\\(ms^{-1}\\)； \\(H_{riv}\\)为河道水头，单位为m； \\(H_{cgw}\\)为计算单元地下水水头，单位为m；\\(d_{rb}\\)为用于计算流向河流基流的河床厚度，单位为m； \\[\\begin{equation} H_{c g w}=y_{g w}+z_{c b} \\end{equation}\\] 其中， \\(H_{cgw}\\)为计算单元地下水水头，单位为m； \\(y_{gw}\\)为地下水位（在不透水基岩之上），单位为m； \\(z_{cb}\\)为基岩高程，单位为m。 \\[\\begin{equation} b_g= \\begin{cases}y_{\\text {riv }} &amp; H_{c g w}&lt;z_{r b} \\\\ \\frac{1}{2}\\left(y_{r i v}+H_{c g w}-z_{r b}\\right) &amp; H_{c g w}&gt;z_{r b}\\end{cases} \\end{equation}\\] 其中， \\(b_g\\)为河段与坡面单元间地下水流动有效高度，单位为m； \\(y_{riv}\\)为河道水位，单位为m； \\(H_{cgw}\\)为计算单元地下水水头，单位为m； \\(z_{rb}\\)为河床高程，单位为m。 \\[\\begin{equation} \\mathrm{K}_{\\mathrm{gr}}=\\frac{1}{2}\\left(\\mathrm{~K}_{\\mathrm{rb}}+\\mathrm{K}_{\\mathrm{eg}}\\right) \\end{equation}\\] 其中， \\(K_{gr}\\)为计算坡面与河道地下水交换的水力传导度，单位为\\(ms^{-1}\\)； \\(K_{rb}\\)为河床饱和水力传导度，单位为\\(ms^{-1}\\)； \\(K_{eg}\\)为有效水平水力传导度，单位为\\(ms^{-1}\\)。 SHUD模型使用有限体积法（Finite Volume，FV），采用Newton-Krylov迭代方法求解非线性方程组，具体来说通过利用牛顿迭代法求解非线性系统，并结合Krylov子空间方法来高效地逼近线性方程组的解，从而求出每次牛顿迭代的改进向量。计算过程中，基于某一时刻地表水储量、土壤水储量、地下水储量和河道水储量状态值和变化率，计算下一时刻这四个值的状态值，通过这四个时刻变化量的大小判断是否收敛以及是否进入下一时刻计算流程；随后结合上文描述的水文过程计算地表、土壤、地下和河道的储量、通量和流量（Shu et al., 2020; 舒乐乐 等，2022）。 References "],["modeling.html", "Chapter 3 SHUD模型软件与数据 3.1 安装 SHUD and rSHUD 3.2 模型输入数据 3.3 结果输出文件", " Chapter 3 SHUD模型软件与数据 3.1 安装 SHUD and rSHUD 本章介绍SHUD模型和rSHUD的安装过程，以及必要的开发库的安装。 3.1.1 SUNDIALS/CVODE SHUD模型的求解需要SUNDIAL中CVODE库的支持。 SUNDIALS（SUite of Nonlinear and Differential/ALgebraic equation Solvers）由六个求解器组成；其中的 CVODE 是一个用于求解刚性和非刚性常微分方程系统（初始值问题）的数值求解器，数学表达为： \\(y&#39; = f(t,y)\\). CVODE支持可变阶精度、可变步长数值方法。CVODE字母组合含义为“C版本的可变系数常微分方程求解器(Variable-Coefficient Ordinary Differential Equation Solver)” 。使用SHUD模型只需要CVODE支持，因此无需安装SUNDIALS所有求解器，只需要安装CVODE即可。 因为SUNDIALS/CVODE持续更新中，代码和函数定义等等变化较大，因此SHUD模型通常仅支持CVODE较新版本，并非所有版本都可支持。 SUNDIALS/CVODE的安装方法有两种：（1）自行下载安装包； （2）使用SHUD源代码的安装脚本。 3.1.1.1 使用脚本安装CVODE 源代码文件夹中的configure.sh文件是自动安装CVODE的脚本——可以自动从github上下载CVODE最新源代码并通过cmake编译并安装在用户目录下。 3.1.1.2 自行下载并安装CVODE SUNDIALS/CVODE 代码的下载地址为：https://computation.llnl.gov/projects/sundials/sundials-software。 CVODE 5.x安装步骤： 进入命令行界面，并解压下载好的cvode压缩包。 在CVODE的根目录下新建文件夹 builddir， 并进入该文件夹。 mkdir builddir cd builddir/ 测试 ccmake. 如果没有 cmake请安装。 ccmake 运行ccmake配置安装环境。 ccmake ../sundials/cvode-5.0.0 Screenshot of Step 1 in ccmake 首先出现的是空白配置页面。按c开始配置。 Screen short of Step 2 in ccmake 上图为默认的配置信息图片上的四处配置信息需要注意，值需要改为下面的值。OPENMP值需要您的系统支持OpenMP，因此在确认您的系统支持OpenMP的情况下打开。 BUILD_CVODE = ON CMAKE_INSTALL_PREFIX = ~/sundials EXAMPLES_INSTALL_PATH = ~/sundials/examples 以上值修改完成后，按c确认配置。 Screenshot of Step 3 in ccmake ccmake开始自动配置安装参数。当配置完成后，按g生成配置文件并退出。 然后使用make编译并安装： make make install 3.1.2 编译SHUD 编译信息保存在文件Makefile，其中关键的编译参数: SUNDIALS_DIR的保存路径（非常关键）. 默认值为 ~/sundials，如果您已经安装到此路径，即可保持默认值。 OpenMP的路径。当您的系统支持OpenMP时，可根据实际安装路径配置。 SRC_DIR路径。默认值为 SRC_DIR = .，即当前源码所在路径。 BUILT_DIR路径，默认值为BUILT_DIR = . ，即当前源码所在路径。 配置好Makefile文件即可编译，使用以下命令进行编译： make clean make shud 更多可选的编译参数： make all - 清理旧的编译文件，并编译SHUD和SHUD_omp文件。 make help - 展示编译的帮助信息。 make shud - 编译shud模型的可执行文件。 make shud_omp - 编译OpenMP支持的并行版本，编译后的可执行文件名为shud_omp。 3.1.2.1 OpenMP（可选） 当需要并行计算时，需要安装OpenMP。以下为Mac OS上安装的参数： brew install llvm clang brew install libomp compile flags for OpenMP: -Xpreprocessor -fopenmp -lomp Library/Include paths: -L/usr/local/opt/libomp/lib -I/usr/local/opt/libomp/include 3.1.2.2 运行 SHUD 可执行文件 运行SHUD模型，请在命令行内执行一下命令： ./shud &lt;projectname&gt; 命令的参数模式： ./shud [-0] [-p projectfile] [-c calibrationfile] [-o output] [-n Num_Threads] &lt;project_name&gt; -0 空计算。读取输入文件并写出结果文件，但是内部没有计算。仅仅用于验证输入文件格式的可靠性和可用性。 &lt;project name&gt; 项目名称。所有的项目文件必须以此开头。 [-p projectfile] 指定的项目配置文件，文件中包含了所有输入文件的地址。 [-c calibrationfile] 指定的参数校准文件（.cfg.calib), 默认的文件为input/xx/xx.cfg.calib。 [-o output_folder] 制定的结果文件输出地址。默认的输出地址为output/projname.out。 [-n Num_Threads] 并行计算的线程数量。此参数仅在并行计算打开时可用。 当shud 程序正常运行时，屏幕输出应该如下图所示： 3.1.3 rSHUD rSHUD是一个标准R包，但尚未向CRAN提交，因此需要通过github以源码方式安装。在R环境中执行以下命令即可自动安装rSHUD。 关于rSHUD的内容，请参阅@Shu2024gmd. 如果您的电脑上尚未在R环境中安装devtools，请先安装。 install.packages(&#39;devtools&#39;) 然后通过devtools从github上安装rSHUD。 devtools::install_github(&#39;SHUD-System/rSHUD&#39;) rSHUD依赖的R工具包包括： Rcpp reshape2 ggplot2 gridExtra grid fields xts hydroGOF zoo raster (&gt;= 2.1.0) sp rgeos RTriangle rgdal (&gt;= 1.1.0) proj4 abind utils lubridate geometry methods ncdf4 GGally doParallel 3.2 模型输入数据 本节从原始数据要求到输入文件内涵，向用户详细介绍模型输入数据。 3.2.1 原始数据 类型 数据名 必要性 要求(格式、步长、数量） 说明 空间数据 流域边界 高 矢量 连续、封闭、唯一多边形； 空间数据 河流网络 高 矢量 河流具有方向性；河流无向下分叉； 空间数据 高程 高 0 单位：米 空间数据 土地利用分类 中 矢量/栅格 \\(n_{lc}\\)个分类 空间数据 土壤分类 中 矢量/栅格 \\(n_s\\)个分类 空间数据 气象站点 中 矢量/栅格 \\(n_{fc}\\)个站点 参数 土地利用 中 \\(n_{lc}\\) 组 土地利用的水力学参数 参数 土壤 中 \\(n_s\\)组 土壤性质：Silt百分比、Clay百分比、有机质含量、Bulk Density 时间序列数据 气象驱动 高 小时～日 降雨、气温、湿度、辐射、风速、气压 时间序列数据 叶面积指数(LAI) 中 小时～月 每类土地利用一个LAI时间序列 时间序列数据 融化系数 低 小时～月 一个时间序列 时间序列数据 观测数据 高 小时～月 通常为径流数据、地下水、蒸散发等 3.2.1.1 数据实例 南苏丹Pongo流域原始数据实例：流域边界（绿色实线），河流（红色实线）、DEM(背景)和气象站点覆盖范围（黑色虚线）。气象数据站点为GLDAS数据，因此为$ 0.25 x 0.25 $度覆盖范围。 (a) Percentage of silt (b) Percentage of Clay (c) Organic mater (Organic Carbon) (d) Bulk density 南苏丹Pongo流域土壤数据：Silt百分比，Clay百分比，有机物含量，Bulk Density。数据来源：ISRIC_SoilGrids。 南苏丹Pongo流域土地利用信息。土地利用数据来自USGS GLC数据。 FLDAS数据的覆盖范围，即气象站点位置信息。 FLDAS的气象驱动数据。 3.2.2 模型输入文件 输入文件列表 File Category 备注 Header # of column .mesh sp 三角形单元定义 是 .att sp 单元属性表 是 .riv sp 河流 是 .rivseg sp 三角形单元与河道单元拓扑信息 是 .calib cfg 物理参数校准文件 是 .para cfg 模型运行设置参数文件 是 .ic cfg 模型初始条件 是 .geol para 地下水层的水力学参数 是 .soil para 浅层土壤的水力学参数 是 .lc para 土地利用的水力学和能量参数 是 .forc tsd 气象驱动数据文件的列表 是 .csv tsd 气象驱动时间序列数据 是 .lai tsd 叶面积指数 是 .obs tsd 用于校准观测时间序列数据 是 .mf tsd 融雪参数时间序列数据 是 .rl tsd 计算潜在蒸散发的粗糙度时间序列数据 是 gis/domain Shapefile 三角形单元的矢量文件 x x gis/river Shapefile 河段的矢量文件 x x gis/seg Shapefile 被三角形分割的河段矢量文件 x x The screenshot of input files for SHUD 在文件夹 gis 和 fig 中的文件与SHUD模拟无关，然后在数据分析和可视化中有很大作用，因此保留在输入文件当中。 3.2.3 空间数据 3.2.3.1 .sp.mesh 文件 .mesh 文件中有两个表格，第一个表格为三角形的组成和拓扑关系；第二个表格为组成三角形的节点坐标信息。 表格 1 (三角形单元的几何定义) 表头 值1 值2 行数 ( \\(N_{cell}\\)) 列数 (\\(8\\)) 表 列 含义 取值范围 单位 备注 ID 单元序号 \\(i\\) 1 ~ \\(N_{cell}\\) - Node1 三角形单元第1角点\\(i\\) 1 ~ \\(N_{node}\\) - Node2 三角形单元第2角点 \\(i\\) 1 ~ \\(N_{node}\\) - Node3 三角形单元第3角点 \\(i\\) 1 ~ \\(N_{node}\\) - Nabr1 三角形单元第1邻居序号\\(i\\) 1 ~ \\(N_{cell}\\) - Nabr2 三角形单元第2邻居序号\\(i\\) 1 ~ \\(N_{cell}\\) - Nabr3 三角形单元第3邻居序号\\(i\\) 1 ~ \\(N_{cell}\\) - Zmax 三角形单元z中心点地表高程 -9999 ~ +inf \\(m\\) Block 2 (三角形的三个角点的信息) 表头: 值1 值2 行数( \\(N_{node}\\)) 列数 (\\(5\\)) Table 列 含义 取值范围 单位 备注 ID 点序号 \\(i\\) 1 ~ \\(N_{cell}\\) - X x坐标 \\(i\\) 1 ~ \\(N_{node}\\) - Y y坐标 \\(i\\) 1 ~ \\(N_{node}\\) - AqDepth 含水层厚度(地表至不透水层距离)\\(i\\) 0 ~ +inf \\(m\\) Elevation 点的高程（z坐标） \\(i\\) -9999 ~ +inf \\(m\\) 3.2.3.2 .sp.att文件 Example of .sp.att file 表头 值1 值2 行数( \\(N_{cell}\\)) 列数 (\\(7\\)) Table 列 含义 取值范围 单位 备注 ID 单元序号\\(i\\) 1 ~ \\(N_{cell}\\) - SOIL 土壤类型序号 1 ~ \\(N_{soil}\\) - GEOL 类型序号 1 ~ \\(N_{geol}\\) - LC 类型序号 1 ~ \\(N_{lc}\\) - \\(N_{lc}\\) = \\(N_{lai}\\) FORC 气象站点序号 1 ~ \\(N_{forc}\\) - MF 融雪指数序号 1 ~ \\(N_{mf}\\) - BC 边界条件序号 1 ~ \\(N_{bc}\\) - SS 源汇序号 1 ~ \\(N_{bc}\\) - 3.2.3.3 .sp.riv文件 Example of .sp.riv file 表头 值1 值2 行数( \\(N_{riv}\\)) 列数 (\\(5\\)) 表 列 含义 取值范围 单位 备注 ID 河段序号\\(i\\) 1 ~ \\(N_{river}\\) - DOWN 下游河段序号 1 ~ \\(N_{river}\\) - Negative vlaue indicates outlet Type 河流参数序号 1 ~ \\(N_{rivertype}\\) - Slope 河床底坡度 -10 ~ 10 \\(m/m\\) Height/Length Length 河段长度 \\(i\\) 0 ~ inf \\(m\\) 3.2.3.4 .sp.rivseg文件 Example of .sp.rivseg file 表头 值1 值2 行数( \\(N_{segment}\\)) 列数 (\\(4\\)) Table 列 含义 取值范围 单位 备注 ID 片段序号 \\(i\\) 1 ~ \\(N_{segment}\\) - iRiv 所属河段序号 1 ~ \\(N_{river}\\) - iEle 相交单元序号 1 ~ \\(N_{cell}\\) - Length 片段长度 \\(i\\) 0 ~ inf \\(m\\) 3.2.4 水力学参数 3.2.4.1 .para.soil 土壤表层的水力学参数 3.2.4.2 .para.geol 地下水层的水力学参数 3.2.4.3 .para.lc 与土地利用有关的参数 3.2.5 模型配置文件 3.2.5.1 .cfg.para文件 Example of .cfg.para file Table 列 含义 取值范围 单位 推荐值 VERBOSE 输出冗余信息 - - 0 INIT_MODE 初始条件模式 0~3 - 3 (0=Relief condition, 1=Dry condition, 2=Default guess, 3=Warm start) ASCII_OUTPUT 是否输出文本格式结果 1/0 - 0 Binary_OUTPUT 是否输出二进制格式结果 1/0 - 1 CRYOSPHERE 冰冻圈模块是否开启 1/0 - 0 SPINUPDAY 模型预热天数 0 ~ inf \\(day\\) 0 SCR_INTV 屏幕输出间隔 0 ~ \\(N_{threads}\\) \\(min\\) 1440 ABSTOL CVODE绝对容差 1e-6 ~ 0.1 - 0.0001 RELTOL CVODE相对容差 1e-6 ~ 0.1 - 0.0001 INIT_SOLVER_STEP 初始迭代步长 - \\(min\\) 1 MAX_SOLVER_STEP 最大迭代步长 1~60 \\(min\\) 10 ET_STEP 正散发计算步长 1~360 \\(min\\) 60 START 模型开始时间（天数） 0 ~ inf \\(day\\) 0 END 模型结束时间（天数） - \\(day\\) - dt_ye_snow 储量输出步长，积雪 0 ~ inf \\(min\\) 1440 dt_ye_surf 储量输出步长，地表水 0 ~ inf \\(min\\) 1440 dt_ye_unsat 储量输出步长，未饱和层 0 ~ inf \\(min\\) 1440 dt_ye_gw 储量输出步长，地下水层 0 ~ inf \\(min\\) 1440 dt_Qe_surf 单元流量输出步长，地表水 0 ~ inf \\(min\\) 1440 dt_Qe_sub 单元流量输出步长， 地下水 0 ~ inf \\(min\\) 1440 dt_qe_et0 单元流量输出步长，截流蒸发 0 ~ inf \\(min\\) 1440 dt_qe_et1 单元流量输出步长，蒸腾 0 ~ inf \\(min\\) 1440 dt_qe_et2 单元流量输出步长，蒸发 0 ~ inf \\(min\\) 1440 dt_qe_etp 单元流量输出步长，潜在蒸散发 0 ~ inf \\(min\\) 1440 dt_qe_prcp 单元流量输出步长，降雨 0 ~ inf \\(min\\) 1440 dt_qe_infil 单元流量输出步长，下渗 0 ~ inf \\(min\\) 1440 dt_qe_rech 单元流量输出步长，地下水补给 0 ~ inf \\(min\\) 1440 dt_yr_stage 河段储量输出步长，河道 0 ~ inf \\(min\\) 1440 dt_Qr_down 河段流量输出步长，向下游 0 ~ inf \\(min\\) 1440 dt_Qr_surf 河段流量输出步长，向坡面 0 ~ inf \\(min\\) 1440 dt_Qr_sub 河段流量输出步长，向地下水 0 ~ inf \\(min\\) 1440 dt_Qr_up 河段流量输出步长，向上游 0 ~ inf \\(min\\) 1440 dt_Lake 湖泊相关变量的输出步长 0 ~ inf \\(min\\) 1440 注： INIT_MODE: 0 = 含水层完全饱和作为初始条件, 1 = 含水层完全干涸, 2 = 未饱和层水量为含水层40%，饱和层水储量为含水层的40%, 3 = 读取.cfg.ic作为初始条件 3.2.5.2 .cfg.calib文件 Example of .cfg.calib file Table 列 含义 取值范围 单位 备注 GEOL_KSATH 水平水力传导度，地下水层 ? - GEOL_KSATV 垂直水力传导度，地下水层 ? - GEOL_KMACSATH 大孔隙水平水力传导度，地下水层 ? - GEOL_DMAC 大孔隙深度，地下水层 - GEOL_THETAS 地下水层孔隙度，地下水层 - GEOL_THETAR 土壤残留含水量，地下水层 - GEOL_MACVF 大孔隙面积比，地下水层 - SOIL_KINF 饱和水力传导度，未饱和层 ? - SOIL_KMACSATV 大孔隙垂向水力传导度，未饱和层 ? - SOIL_DINF 下渗深度参数，未饱和层 ? - SOIL_ALPHA \\(\\alpha\\)值，van Genuchten公式 - SOIL_BETA \\(\\beta\\)值，van Genuchten公式 - SOIL_MACHF 大孔隙面积比，未饱和层 - LC_VEGFRAC 植被覆盖度 - LC_ALBEDO 反照率 - LC_ROUGH 地表曼宁粗糙度 - LC_SOILDGD 土壤劣化系数 - LC_IMPAF 不透水面积比 - LC_ISMAX 最大截流系数 - AQ_DEPTH+ 含水层深度 \\(m\\) TS_PRCP 降雨 - TS_SFCTMP+ 温度 \\(C\\) ET_ETP 潜在蒸散发 - ET_IC 冠层截流 - ET_TR 植被蒸腾 - ET_SOIL 直接蒸发 - RIV_ROUGH 河道曼宁粗糙度 - RIV_KH 河床水力传导度 - RIV_DPTH+ 河道深度 \\(m\\) RIV_WDTH+ 河道宽度 \\(m\\) RIV_SINU 河道绵延度 - RIV_CWR 谢才(Chezy)公式系数\\(C_{wr}\\) - RIV_BSLOPE+ 河床坡度 \\(m/m\\) IC_GW+ 地下水水位初始条件 \\(m\\) IC_RIV+ 河道水量初始条件 \\(m\\) 注： 表格中+代表该值的含义为该值与模型参数相加得到新参数。即\\(\\theta ^* = \\theta + \\zeta\\), \\(\\theta\\)为参数， \\(\\zeta\\)为校准调节值。 除+以外的所有值，都是与参数相乘关系。即\\(\\theta ^* = \\theta \\times \\zeta\\)。 3.2.5.3 .cfg.ic文件 Example of .cfg.ic file 表1 (三角单元初始条件) 表头 值1 值2 行数( \\(N_{cell}\\)) 列数 (\\(6\\)) Table 列 含义 取值范围 单位 备注 ID 单元序号\\(i\\) 1 ~ \\(N_{cell}\\) - Canopy 冠层截流 \\(i\\) 0 ~ inf \\(m\\) Snow 积雪 \\(i\\) 0 ~ inf \\(m\\) Surface 地表水 \\(i\\) 0 ~ inf \\(m\\) Unsat 未饱和层水 \\(i\\) 0 ~ inf \\(m\\) GW 地下水 \\(i\\) 0 ~ inf \\(m\\) 表2 (河段初始条件) 表头: 值1 值2 行数( \\(N_{riv}\\)) 列数 (\\(2\\)) Table 列 含义 取值范围 单位 备注 ID 河段序号 \\(i\\) 1 ~ \\(N_{riv}\\) - Stage 河段水位 \\(i\\) 0 ~ inf \\(m\\) 表3 (湖泊初始条件) 表头: 值1 值2 行数( \\(N_{lake}\\)) 列数 (\\(2\\)) Table 列 含义 取值范围 单位 备注 ID 湖泊序号 \\(i\\) 1 ~ \\(N_{lake}\\) - Stage 湖泊水位 \\(i\\) 0 ~ inf \\(m\\) 3.2.6 时间序列数据 3.2.6.1 .tsd.forc文件 Example of .tsd.forc file Line 1: 气象站点数量 | 开始日期 (YYYYMMDD) Line 2: 驱动数据文件所在文件夹 Line 3~N: 时间序列数据文件名 Example of .csv forcing file 表头: 值1 值2 ( \\(0\\)) 列数 (\\(6\\)) Table 列 含义 取值范围 单位 备注 Day 日数 0 ~ \\(N_{day}\\) \\(day\\) PRCP 降雨 0 ~ 500 \\(mm/day\\) 降雨强度超过阈值模型会警告，但不妨碍运行 TEMP 气温 -100 ~ 70 \\(C\\) RH 相对湿度 0 ~ 1 \\(-\\) wind 风速 0 ~ inf \\(m/s\\) 非负 Rn 太阳净辐射 ? \\(W/m^2\\) 最大值为太阳常数 Press 气压 ? \\(Pa\\) 可缺省 3.2.6.2 .tsd.lai文件 Example of .tsd.lai file 表头: 值1 值2 值3 天数 ( \\(N_{time}\\)) 列数 (\\(N_{lc}\\)) 开始日期 (YYYYMMDD) Table 列 含义 取值范围 单位 备注 第一列 时间 0 ~ \\(N_{time}\\) \\(day\\) 第2列 叶面积指数1 0 ~ inf \\(m^2/m^2\\) 第i列 叶面积指数\\(i-1\\) 0 ~ inf \\(m^2/m^2\\) … … … … 3.2.6.3 .tsd.mf文件 Example of .tsd.mf file 融雪度日模型(Degree-Day Model)的系数。 表头: 值1 值2 值3 天数 ( \\(N_{time}\\)) 列数 (\\(N_{mf}\\)) 开始日期 (YYYYMMDD) Table 列 含义 取值范围 单位 备注 第一列 时间 0 ~ \\(N_{time}\\) \\(day\\) 第2列 融雪因子1 0 ~ inf - 第i列 融雪因子\\(i-1\\) 0 ~ inf - … … … … 3.2.6.4 .tsd.obs文件 Example of .tsd.obs file 表头: 值1 值2 值3 天数 ( \\(N_{time}\\)) 列数 (\\(N_{obs}\\)) 开始日期 (YYYYMMDD) Table 列 含义 取值范围 单位 备注 第一列 时间 0 ~ \\(N_{time}\\) \\(day\\) 第2列 观测1 ? ? 第i列 观测 \\(i-1\\) ? ? … … … … 3.3 结果输出文件 3.3.1 文件名格式 为了方便结果的分类和用户理解，作者规则化定义了输出文件的文件名；用户通过文件名即可读懂文件所包含的变量类型、所属单元和读写格式。输出文件的文件名格式： [项目名].[识别码].[格式] 或者： [Project Name].[Identifier].[format] [项目名]（[Project Name]） 是用户给模拟定的名称，通常为流域的名字简写。例如：黄河流域，可以写成hh或者huanghe. [格式] （[format]）可以使用csv或者dat. csv为规则文本格式，可使用任意文本编辑器或者WPS表格打开。dat二进制格式，文件占用硬盘空间较小 [识别码] （[Identifier]） 定义了输出结果内涵。识别码基本结构为 [模型单元][变量类型][变量名]（[Model cell][Variable Type][Variable Name]）。 [Model cell] 是ele （element，模型三角单元）, riv （river，河段） or lak （lake，湖泊）. 变量类型包括 y, v and q，分别代表状态变量 （单位\\(L\\)）, 单位流量或速度（单位\\(L^3 L^{-2} T^{-1}\\)）和体积流量（in \\(L^3 T^{-1}\\)）——\\(L\\)为长度单位，\\(T\\)为时间单位。 下表为SHUD输出文件列表： 识别码 单元 类型 变量名 含义 单位 .eleyic. ele y ic 储量，冠层截流 \\(m\\) .eleysnow. ele y snow 储量，雪水当量 \\(m\\) .eleysurf. ele y surf 储量，地表水 \\(m\\) .eleyunsat. ele y unsat 储量，未饱和层 \\(m\\) .eleygw. ele y gw 储量，地下水水位 \\(m\\) .elevetp. ele v etp 通量，潜在蒸散发 \\(\\frac{m^3}{m^2 d}\\) .eleveta. ele v eta 通量，实际蒸散发 \\(\\frac{m^3}{m^2 d}\\) .elevetic. ele v etic 通量，冠层截流蒸发 \\(\\frac{m^3}{m^2 d}\\) .elevettr. ele v ettr 通量，植被蒸腾 \\(\\frac{m^3}{m^2 d}\\) .elevetev. ele v etev 通量，直接蒸发 \\(\\frac{m^3}{m^2 d}\\) .elevprcp. ele v prcp 通量，降雨 \\(\\frac{m^3}{m^2 d}\\) .elevnetprcp. ele v netprcp 通量，净降雨量 \\(\\frac{m^3}{m^2 d}\\) .elevinfil. ele v infil 通量，下渗 \\(\\frac{m^3}{m^2 d}\\) .elevexfil. ele v infil 通量，出渗（反下渗） \\(\\frac{m^3}{m^2 d}\\) .elevrech. ele v rech 通量，地下水补给 \\(\\frac{m^3}{m^2 d}\\) .eleqsurf. ele q surf 流量，地表径流（坡面流） \\(m^3/d\\) .eleqsub. ele q sub 流量， 地下水水平流动 \\(m^3/d\\) .rivystage. riv y stage 储量，河段水位 \\(m\\) .rivqup. riv q up 流量，向上游 \\(m^3/d\\) .rivqdown. riv q down 流量，向下游 \\(m^3/d\\) .rivqsurf. riv q surf 净流量，坡面向外 \\(m^3/d\\) .rivqsurf1. riv q surf 流量，方向1 \\(m^3/d\\) .rivqsurf2. riv q surf 流量，方向2 \\(m^3/d\\) .rivqsurf3. riv q surf 流量，方向3 \\(m^3/d\\) .rivqsub. riv q sub 净流量，地下水向外 \\(m^3/d\\) .rivqsub1. riv q sub 流量，方向1 \\(m^3/d\\) .rivqsub2. riv q sub 流量，方向2 \\(m^3/d\\) .rivqsub3. riv q sub 流量，方向3 \\(m^3/d\\) 3.3.2 文本格式输出文件（.csv） N - 输出文件列数（不含时间列） m - 步长总数 StartTime - 开始时间 （YYYYMMDD or YYYYMMDD.hhmmss） N StartTime \\(T_1\\) \\(v_{1 \\cdot 1}\\) \\(v_{1 \\cdot 2}\\) … \\(v_{1 \\cdot N}\\) \\(T_2\\) \\(v_{2 \\cdot 1}\\) \\(v_{2 \\cdot 2}\\) … \\(v_{2 \\cdot N}\\) \\(T_3\\) \\(v_{3 \\cdot 1}\\) \\(v_{3 \\cdot 2}\\) … \\(v_{3 \\cdot N}\\) … … … … … \\(T_{m}\\) \\(v_{m \\cdot 1}\\) \\(v_{m \\cdot 2}\\) … \\(v_{m \\cdot N}\\) 3.3.3 二进制输出文件（.dat） 二进制文件输出的结果核心矩阵与文本格式一致，但是使用了不同的存储结构。二进制文件格式紧凑，读写效率高，占用较小磁盘空间，因此作为SHUD模型的默认输出方式。 二进制文件格式不仅可被各类计算机语言（C/C++, Basic, Fortran，……）快速读取，并且也能在R、python、 Matlab、 Mathmetica等交互式语言中高效读取，如果读取有障碍，请联系模型作者获取帮助。 表格中，重要的变量是数据列数\\(N_x\\)。 \\(N_x\\)代表输出变量的列数，即该变量的输出计算单元数。 \\(0 &lt; N_x \\le N_{max}\\), 例如模型有\\(N_{cell}\\)个三角形单元，则.eleygw的地下水输出文件中\\(N_{max} = N_{cell}\\)；模型的河流径流结果中\\(N_{max} = N_{riv}\\)。 二进制输出文件现有v1.0, v2.0和v2.1三种格式，三种输出结果的格式见下表： v 1.0 （\\(N_x = N_{max}\\)） 内容 字节数 类型 示例 数据列数 8 double 100 起始时间 8 double 20220101.120000 数据矩阵 8 double 1440, 1,2,…; 2880,2,4,… v 2.0（\\(N_x = N_{max}\\)） 内容 字节数 类型 示例 文件描述 1024 char groundwater export, bla bla bla 起始时间 8 double 20220101.120000 数据列数 8 double 100 数据矩阵 8 double 1440, 1,2,…; 2880,2,4,… v 2.1 以上版本（\\(0 &lt; N_x \\le N_{max}\\)） 内容 字节数 类型 示例 版本号 8 double 2.0 文件描述 2048 char groundwater export, bla bla bla 起始时间 8 double 20220101.120000 数据列数 8 double 100 索引ID 8 double 1,3,5,…; 数据矩阵 8 double 1440, 1,2,…; 2880,2,4,… v2.1版本输出文件的逻辑和内存结构 注：double为计算机的双精度数据格式，默认长度为8个比特位 数据为\\(m \\times N_x\\)的二维矩阵。 矩阵中的值全部为8字节double型。 \\(m\\)为结果输出的最终时间长度，\\(m=100\\)表明模型共输出100个时间步长的数据，则数据矩阵的行数为100。 \\(N_x\\)为输出结果的数量。 在v2.1之后的版本中，模型可灵活输出指定序号的结果，因此在v2.1结果中，结果矩阵的列数并不一定等于模拟单元的数量；例如模拟三角形单元数为1000(\\(N_{max} = 1000\\))，模型配置中指定值输出偶数序号的结果，则\\(N_x = 500\\)，索引ID则为\\(i_{o} = 2,4,6,...,998,1000\\)。 \\(i\\)为矩阵列序号，取值范围：\\(0 \\le i \\le N_{x}\\)，第一列(\\(i=0\\))为时间，\\(i=1~N_x\\)则为输出结果值。 \\(j\\)为时间序号，取值范围：$0 j m $。 \\(N_{h}\\)为文件头的长度，换算为8字节double型的数量。 数据矩阵的存储方式见下表： 文件存储位置 矩阵行号(\\(j=\\)) 数据列序号(\\(i=\\)) 值 值含义 \\(N_{h} + 1\\) 1 0 \\(T_1\\) \\(N_{h} + 2\\) 1 1 \\(v_{1 \\cdot 1}\\) \\(N_{h} + 3\\) 1 2 \\(v_{1 \\cdot 2}\\) … 1 … … \\(N_{h} +N_x\\) 1 \\(N_x\\) \\(v_{1 \\cdot N_x}\\) \\(N_{h} +（N_x+1） * (2-1) + i\\) 2 0 \\(T_2\\) \\(N_{h} +（N_x+1） * (2-1) + i\\) 2 1 \\(v_{2 \\cdot 1}\\) \\(N_{h} +（N_x+1） * (2-1) + i\\) 2 2 \\(v_{2 \\cdot 2}\\) \\(N_{h} +（N_x+1） * (2-1) + i\\) 2 … … \\(N_{h} +（N_x+1） * (2-1) + i\\) 2 \\(N_x\\) \\(v_{2 \\cdot N_x}\\) \\(N_{h} +（N_x+1） * (3-1) + i\\) 3 0 \\(T_3\\) \\(N_{h} +（N_x+1） * (3-1) + i\\) 3 1 \\(v_{3 \\cdot 1}\\) \\(N_{h} +（N_x+1） * (3-1) + i\\) 3 2 \\(v_{3 \\cdot 2}\\) \\(N_{h} +（N_x+1） * (3-1) + i\\) 3 … … \\(N_{h} +（N_x+1） * (3-1) + i\\) 3 \\(N_x\\) \\(v_{3 \\cdot N_x}\\) \\(N_{h} +（N_x+1） * (j-1) + i\\) \\(j\\) … … \\(N_{h} +（N_x+1） * (j-1) + i\\) \\(j\\) … … \\(N_{h} +（N_x+1） * (j-1) + i\\) \\(j\\) … … \\(N_{h} +（N_x+1） * (j-1) + i\\) \\(j\\) … … … … … … \\(N_{h} +（N_x+1） * （m-1） + i\\) m 0 \\(T_{m}\\) \\(N_{h} +（N_x+1） * （m-1） + i\\) m 1 \\(v_{m \\cdot 1}\\) \\(N_{h} +（N_x+1） * （m-1） + i\\) m 2 \\(v_{m \\cdot 2}\\) \\(N_{h} +（N_x+1） * （m-1） + i\\) m … … \\(N_{h} +（N_x+1） * （m-1） + i\\) m \\(N_x\\) \\(v_{m \\cdot N_x}\\) "],["autoshud.html", "Chapter 4 自动化建模 4.1 简介 4.2 建模思路 4.3 建模步骤 4.4 可移植性", " Chapter 4 自动化建模 4.1 简介 autoshud是一个用于快速、可重现和自动部署水文模型的工具，它可以帮助用户从全球数据源截取必要的数据，如高程、土壤、土地利用等，并将其通过空间 计算和分析，制作为SHUD模型运行所需的输入文件；并完成模型模拟，并进行初步数据分析的一系列工具的集合。 autoshud可以利用开放的数据库和空间数据自身特征，自动构建和运行适合不同流域和目标的水文模型，从而提高水文模拟的效率和可重现性。 AutoSHUD工具的价值不仅在提升SHUD模型模拟的效率和灵活性，同时也开创了水文模型自动化、标准化建模的基本范式。 简单来说，autoshud是一个可以自动构建和运行SHUD水文模型的软件。 范式一词指的是科学家在进行科学研究时所持有的世界观和方法论，是一种科学思维和实践的模式。 《科学革命的结构》的作者托马斯·库恩(Thomas Kuhn)认为，范式是一种公认的模型或模式，它为某种科学研究传统提供了范例。这些范例包括定律、理论、应用和仪器设备等。库恩认为，范式反映了科学家集团对本体论、认识论和方法论的基本承诺，是他们共同接受的一组假说、理论、准则和方法的总和，也是他们心理上形成的共同信念。 在水文学或水文模型领域，我们想探索以下几个基本问题： 真正影响水文过程的地面要素是什么？地形、地貌、河网拓扑关系、土壤质地、地质背景、土地利用、水利工程？ 哪些数据或变量能反映这些地面要素？数据如何标准化或规则化？ 不同水文模型有哪些相同、相似或可移植的过程和方法？ 水文模型的部署、模拟和结果分析是否具有可重复性？即在相同参数条件下，不同建模者能否得到一致的结果？ 数据处理、建模和结果分析过程如何减少建模者自身的认知和经验的影响，使之更客观？ 4.2 建模思路 AutoSHUD是一自动化SHUD模型部署为案例，探索高效、可重复水文模型部署的基本范式。 上图是AutoSHUD研究所总结的水文建模基本步骤，包括：数据获取、数据前处理、建模、模拟和结果分析。这五个步骤适用于不同的水文模型，但各个模型对这些步骤的要求不同。例如，新安江模型、HBV和FLEX等简单模型，对前三个步骤的需求较低；而基于物理过程的分布式水文模型，特别是数值方法水文模型，对所有步骤都有很高的要求，并且难以让初学者快速掌握。 快速、可重复的水文建模流程中分为5个步骤，但需要注意的是这5个步骤与AutoSHUD程序中的5个步骤并不完全一致。 本研究中水文建模范式第一步是定义和获取关键地理数据，这一步在AutoSHUD的程序中不存在——因为数据已获取并存储于指定位置，是AutuSHUD程序运行的必要条件。因此在AutoSHUD的代码中，Step1和Step2实际上都是数据前处理过程，并不包含数据获取。换句话说，AutoSHUD的代码实际上是从上图第二步开始的。 4.3 建模步骤 4.3.1 建模参数 所有建模参数保存在一个ASCII 文本文件中，其中不仅包含了各种时空数据的保存路径，也包括了建模者的建模要求——或称为建模参数。 建模参数文件是一个\\(N \\times 2\\)的表格。\\(N\\)为参数数量。某些参数为可缺省参数(表格中加入*变量)。 变量名 取值类型 说明 示例 prjname Text 项目名称 jh startyear Text 模拟开始年份 1986 endyear Number 模拟结束年份 2000 dir.out Number 工作路径 ~/RunJH dout.forc Text 气象驱动数据输出路径 ~/forcing_jh fsp.crs* Shapfile 投影参数文件，须PCS。 ~/rawData/wbd_pcs.shp fsp.wbd Shapfile 模拟的流域边界 ~/rawData/wbd.shp fsp.stm Shapfile 河流文件 ~/rawData/river.shp fr.dem GeoTiff DEM文件 ~/rawData/dem.tif fsp.lake* Shapfile 湖泊文件 ~/rawData/Lake.shp Forcing Number 驱动数据类别 0.5 fsp.forc Shapfile 气象站点覆盖数据 ~/rawData/metero.shp dir.ldas Text 气象再分析数据存储路径 ~/CMFD/Data_03hr_010deg Soil Number 土壤数据类别 0.1 dir.soil Text 土壤数据存储路径 /repo/Soil/HWSD_RASTER fa.soil Text 土壤属性数据路径 /repo/Soil/HWSD/hwsd.csv fa.geol Text 地质属性数据路径 /repo/Soil/HWSD/hwsd.csv fn.soil GeoTiff 土壤分类数据路径 ~/RunJH/GISdatahwsd.tif fn.geol GeoTiff 地质分类数据路径 ~/RunJH/GISdatahwsd.tif Landuse Number 土地利用数据类别 0.1 fn.landuse GeoTiff 土地利用数据路径 /repo/USGS_LCI/LCType.tif tab.landuse Text 土地利用属性表路径 /repo/USGS_LCI/LCType.tif NumCells Number 最小建模单元数 1000 MaxArea Number 最大建模单元面积 (km2) 5 AqDepth Number 默认含水层厚度(m) 10 MinAngle* Number 最小三角形夹角(degree) 30 tol.wb Number 流域边界简化阈值(m) 500 tol.rivlen Number 河流最长分段阈值(m) 500 RivWidth Number 一阶河流的截面底部宽度(m) 4 RivDepth Number 一阶河流的截面深度(m) 3 DistBuffer Number 数据处理缓冲区(m) 2000 flowpath Number 是否重新计算河流流向关系（速度较慢） 0 QuickMode* Number 是否快速模型，快速模型会跳过若干步骤，建立最简单模型 0 MAX_SOLVER_STEP* Number SHUD模型迭代求解的最大时间不长 6 CRYOSPHERE* Number 是否开启冰冻圈模块 1 STARTDAY* Number 开始日(天) 1 ENDDAY* Number 结束日(天) 365 详细取值说明 Forcing取值： -1 Dummy. No data provided. 0 LDAS mode: 0.1 CLDAS, 0.2 FLDAS, 0.3 GLDAS 0.4 NLDAS 0.5 CMFD 0.6 CMIP6 1 Local data: 1.1 Points of metereo-station 1.2 Polygon of coverage Soil/Geol取值: 0-glocal soil data. 0.1 HWSD, 0.2 ISRIC 1-local map + soil texture table. 1.1 Raster, 1.2 Spatial polygon. Landuse取值 0-global 0.1 USGS LCI 1-local data with attribute table. 1.1 Raster, 1.2 Spatial Polygon AutoSHUD中GetReady.R脚本负责读取建模参数文件，并且加载其中文件和变量值。 4.3.2 Step1. 数据子集提取与数据规则化 这一步的目的是从指定的文件中，以指定的研究区(fsp.wbd)为边界的数据自己，并对基础的空间数据将进行重投影和规则化。 步骤： 读取建模参数加载必要工具库。 处理建模边界，包括：去孔洞、投影、生成缓冲区等。 处理DEM数据，包括：剪切(从原始数据中提取研究区范围内数据)，栅格数据重投影为PCS。 河网数据处理，包括：数据重投影、河道线段简化、去除重复点、去除重复线段、河流流向一致性检查/修复等。 湖泊数据处理，包括：数据重投影、去除孔洞、边界简化等 绘图，对以上数据处理过程中的原始空间数据和结果数据进行绘图，方便用户检查和确认数据对象和处理结果。 4.3.3 Step2. 水文参数和气象数据生成 这一步的主要任务处理包含有水文物理参数的原始数据和气象数据进行处理，包括土壤、地质、土地利用和气象时间序列数据。 步骤： 土壤/地质数据，包括：土壤/地质分类数据子集提取、重投影、分类数据属性表提取、根据土壤/地质的属性利用Pedo-Transfer Function计算水力学参数(水平/垂直水力传导度、饱和含水量等)等。 土地利用数据处理，包括：土地利用分类数据的子集提取、重投影、建立土地利用属性的水力学参数表（粗糙度、植被根系深度、土壤劣化系数、不透水面比例等）。 气象驱动数据处理，包括气象站点（或再分析数据格点）覆盖范围计算、从NetCDF数据中提取研究区数据并保存RDS二进制格式、数据单位转换、保存气象时间序列数据。 4.3.4 Step3. 建模 基于已经进行过预处理的时空数据，构建SHUD水文模型。尽管当前AutoSHUD程序的Step3仅服务于SHUUD模型，但作为一种水文建模的范式，这一步的数据处理过程可根据模型不同而做适应性修改，以适应其他物理性分布式水文模型。 步骤： 读取建模参数，生成可用的建模参数，包括最大计算单元面积、流域边界简化阈值、河流简化阈值、模拟天数、计算单元数量等。 缓冲区制备。 湖泊文件处理。 流域单元划分，即由流域边界、湖泊边界、加密区域等空间数据，生成不规则三角网。 并计算单元个体的面积、单元数量等。 河网数据处理，包括河流分级、流向验证等。 生成泰森多边形的气象站点覆盖矢量数据。 空间数据匹配，将土壤分类、地质分类、土地利用分类、气象站点代号等与三角形单元做空间匹配，生成空间属性.att文件(.sp.att)。 从DEM等提取河道信息，包括坡度，起始点等；设置河道截面积信息(.sp.riv)。 将三角形单元与河流段进行切割，生成河流与三角形交互的河流片段(.sp.rivseg)。 生成三角形网、河流段、河流片段的shapefile文件。 生成模型初始条件(.cfg.ic)。 生成模型运行参数文件(.cfg.para)。 利用Pendo-Transfer Function计算水利参数，生成土壤和地质层的水力学参数(.para.soil, .para.geol)。 生成土地利用参数表(.para.lc) 将模型输入的数据及参数写入指定文件。 自动绘制建模过程中的图件。 4.3.5 Step4. 模拟 这一步获取模型最新源代码，对源码进行编译，然后后运行模型。 步骤： 读取建模参数 从github获取最新模型源代码。 编译模型。 运行模型，开展研究区水文模拟。 写出模型运行的日志文件。 4.3.6 Step5. 模拟结果后处理 模型结果后处理主要的任务是读取模型输入和输出文件，针对特定问题进行的水文分析和可视化。 步骤： 读取建模参数和模型输入/输出路径。 配置模型分析环境，关键变量是项目名称、输入数据路径和输出数据路径。 由输入数据计算模型和研究区的基础特征数据，包括计算单元面积、总面积、等效分辨率、流域出口的河流代号。 读取输出结果数据。 计算流域逐月/逐年的水量平衡关系，绘制水量平衡时间序列图。 计算地下水多年平均值，绘制地下水埋藏深度的空间分布图。 读取出口径流数据，绘制径流时线图。 根据空间数据（地下水、土壤水、蒸发等）生成批量空间地图，制作变量随时间变化的动画。 4.4 可移植性 "],["calibration.html", "Chapter 5 模型校准 5.1 参数敏感性 5.2 手动模型校准 5.3 CMA-ES自动化模型校准", " Chapter 5 模型校准 本章节正式施工中～～～ SHUD模型校准的关键文件是.cfg.calib文件，该文件是开放了30个左右的模型参数，通过调节模型参数，可以使得模型模拟结果接近观测，实现长期或短期水文模拟。 .cfg.calib文件中包含了土壤、地质、土地利用、蒸散发、河流形状、含水层特征等等的参数。.cfg.calib文件中参数据修改直接影响模型中对应参数；例如，.cfg.calib文件中Soil_Ksat参数全局影响土壤入渗的水力传导度，其值为10，则.para.soil文件中Inf_Ksat值全部放大10倍。 5.1 参数敏感性 根据现有经验，最敏感参数为土壤水力传导度，alpha, beta, 默认土壤入渗深度，潜在蒸散发调节系数等。 5.2 手动模型校准 5.3 CMA-ES自动化模型校准 CMA-ES的自动化模型校准方案已经通过rSHUD中的函数实现，该方法可以实现自动化模型校准。 rSHUD中的CMAES方法，支持单线程和多线程运行，但是强烈推荐使用具有并行计算能力的计算平台完成。支持单计算多线程并行，也支持超算上的多节点多线程并行方案。 文件 备注 是否包含文件头 列数 .cfg.cmaes 配置CMA-ES的参数 无 - 文件.calib.cmaes中个参数含义 项目 含义 默认值 取值范围 单位 lambda 遗传算法中，每一代的采样数 48 - stopfitness 最优解阈值 （0为理想值） 0.3 - maxgen 最大迭代次数(繁殖代数) 48 - sigma 初始采样的范围 0.8 0~1 - updateic 是否更新模型初始条件 0 0/1 - walltime 最大模型运行时间 86400 0-inf second nspingup 模型预热天数 0 0-inf day 文件.calib.range中各参数含义： 行名: SHUD模型输入文件.cfg.calib的参数 列名: 项目 含义 默认值 取值范围 单位 On/off 开启或关闭 0 0/1 - log 是否采用指数取值 0 0/1 - min 最大值 - - - max 最小值 - - - "],["application.html", "Chapter 6 应用案例 6.1 V形流域 6.2 Vauclin水槽箱试验 6.3 美国加州Cache河流域 6.4 宁夏岩画村山洪 6.5 休斯顿城市内涝 6.6 南苏丹尼罗河上游", " Chapter 6 应用案例 SHUD作为通用的流域水文模型，可以快速部署与全球大部分流域，能为全球水文及相关研究提供快速可靠的模拟和预测，也可作为防灾减灾、农业估产、生态环境模拟等等方面提供可靠水文背景。 本章节通过全球6个流域展示SHUD模拟系统，向用户展示水文基础数据获取、模型构建、水文模拟、自动化校准、数据分析等研究流程。用户可通过实例了解模型的可靠性、可用性和效率，从初学者进阶为SHUD系统的开发者和合作者。 构建SHUD模型的建议 1. 检查数据格式和一致性，例如：空间数据投影是否和重叠区，气象数据的单位是否符合要求？时间序列数据值是否为时间平均值？模型运行是否有异常值提示？ 1. 使用“离线”模式运行（只运行模型的读取和写出，不实际计算），可以检查模型的输入输出是否正确。 1. 从“理想化”的驱动数据入手，（.cfg.para文件中FORC_debug=1）——启动简单驱动数据驱动模型，跳过可能的驱动数据错误。 1. 运行较短模拟时间，然后读取结果，并检验结果是否符合预期。 1. 如果以上过程都无误，即可带入全部数据运行模型。 6.1 V形流域 本案例源码和数据获取地址： Github: https://github.com/Model-Intercomparison-Datasets/V-Catchment V形流域（V-Catchment， VC）是一个可验证数值水文模型的理想化模型；此流域不仅有效测试了模型的地表径流、汇流、河川径流和水量平衡，也可验证数值方法的质量守恒，甚至模型的网格划分的无关性（Independancy）和收敛性（Convergence）。 VC模拟空间有两个倾斜的坡面和链接坡面的倾斜河道组成。 Description of the V-Catchmenet 两个坡面是\\(800 \\times 1000 m\\)，并且曼宁系数\\(n=0.015\\)的斜面. 居于坡面之间的河道宽度\\(20 m\\)宽，\\(1000 m\\)长，曼宁系数为\\(n=0.15\\). 从坡面顶到河道的坡度为0.05（沿\\(x\\)轴方向），同时，从河道起点到重点的坡度为0.02，（沿\\(y\\)轴方向）。坡面与河流都是完全不透水表面，即无下渗，无植被。 整个VC接收连续、均一降水，降雨强度\\(18 mm/hr\\)并持续90分钟，累计降雨量为\\(27mm\\)。理想假设无下渗和无蒸发，因此坡面的水量将完全流入河道，并从河道出口出离开此流域。因此模拟结果要满足坡面流出水量等于总降雨量，以及河道出流量等于总降雨量和坡面总流量，即质量守恒定律。 \\(\\sum P \\cdot A = \\sum Q_{slope} = \\sum Q_{river}\\) 6.1.1 Shen等(2010) 中的结果 文献中有多个模型研究重复了VC实验，其中Shen等(2010)输出了坡面向河道的流量，因此我们选用Shen等（2010）的结果进行对比。 Shen (2010) results 经过分析我们发现Shen等(2010)的坡面流量存疑。解释如下：基于质量守恒和连续性定律，总输入（降雨）必须等于总的输出（坡面净流量或者河道出流量），而Shen等(2010)的结果中坡面流量仅为河道流量和降雨的20分之一。这现象可能是作者绘图过程中的失误导致；因此我们的实验中数字化了Shen等(2010)的结果，但是将坡面流量放大到20倍——即满足质量守恒的量级，然后对比实验。 SHUD triangular model domain in V-Catchment 使用SHUD对VC进行模拟，结果如下图。坡面径流和河道出流量都满足质量守恒定律和连续性定理，也能很好验证对于Shen等(2010)结果的推测。 Comparizon of SHUD modeling results versus Shen (2010). 6.2 Vauclin水槽箱试验 本案例数据和源码获取地址： Github: https://github.com/Model-Intercomparison-Datasets/Vauclin1979. Vauclin试验(Vauclin, Khanji, and Vachaud 1979) 旨在评估降雨或灌溉下非饱和层中地下水位变化和土壤湿度。实验在一个长 \\(3\\) 米、深 \\(2\\) 米、宽 \\(0.05\\) 米的沙盒中进行（见图 \\(\\ref{fig:vauclin}\\)）。盒子里填充了均匀的沙子颗粒，并测量了水力参数：饱和水力传导率为 \\(35\\) cm/hr，孔隙度为 \\(0.33\\) m\\(^3\\)/m\\(^3\\)。沙盒的左侧和底部为不透水层，顶部和右侧为开口。水头恒定设置为 \\(0.65\\) 米。在顶部左侧的前 \\(50\\) 厘米施以恒定的灌溉量（\\(1.48\\) cm/hr），而顶部的其他部分被盖上以避免水分蒸发。 Experiment set-up in Vauclin (1979) Groundwater measurement and 2-D numeric simulation in Vauclin (1979) 实验的初始状态是右侧恒定水头下的平衡水位。也就是说，整个沙盒的饱和水位被稳定地保持在 \\(0.65\\) 米。当地下水位达到平衡时，于 \\(t=0\\) 开始进行灌溉。随后，测量了沙盒长度方向上多个位置处的地下水位，分别在实验进行的 2、4、6 和 8 个小时进行了测量。 除了 中指定的参数外，SHUD 还需要额外的信息，其中包括 van Genutchen 方程中的 \\(\\alpha\\) 和 \\(\\beta\\)，以及含水量 \\(\\theta_s\\)。因此，我们使用校准工具来估计这些参数的代表值。在模拟中使用校准是合理的，因为模型不可避免地简化了实际的水力过程。校准因此将参数推向代表性值，以逼近或拟合的自然过程。经过校准后，得到的数值分别为\\(\\theta_s= 0.32 m^3/m^3\\)，\\(\\alpha=6.0\\)，\\(\\beta=6.0\\)。与 和 中的模拟结果一样，存在模拟和实测数据之间的不匹配。 这种不匹配可能是由于：(1) 不饱和层和饱和层的含水层描述限制了模拟不透水带中的入渗和补给能力，或者 (2) 相对于这个实验的相对微观尺度，水力性质更复杂。 SHUD 模拟了所有四个测量点的地下水位（见图 \\(\\ref{fig:vauclin}\\)(b)）。模拟和 Vauclin 观测结果之间的最大偏差为 \\(5.5 cm\\)，\\(R^2\\) = \\(0.99\\)，与 中数值模拟的偏差 \\(5.2 cm\\) 相当。当校准考虑更多的土壤参数时，模拟偏差降至 \\(3 cm\\)。当然，SHUD 对不饱和带和饱和带的简化有利于计算效率，但也限制了模型在微观尺度问题上的适用性。 与 Vauclin 实验相比，通过模拟结果验证了入渗、补给和侧向地下水流的算法。对于不饱和层内更可靠的垂直流动，需要使用多层次模型，这是 SHUD 的下一个版本计划中的任务。 6.3 美国加州Cache河流域 本案例的源码获取地址： Github: https://github.com/Model-Intercomparison-Datasets/Cache-Creek. 数据非常大，如果需要原始数据，请联系作者 Lele Shu 6.3.1 Cache Creek Watershed Cache Creek Watershed (CCW)是美国加州萨克拉门托河上游的一个支流，面积196.4 \\(km^2\\)（下图），海拔高程450米至1800米，平均坡度38% \\(L/L\\)——如此陡峭地形是对数值方法水文模型的挑战。 Cache Creek流域位置和基本数据 根据2000-2017年间，NLDAS-2数据，流域内平均气温12.8 \\(^\\circ C\\)，年降雨量817 \\(mm\\)，然而降雨年内、年际分布不均，属于典型地中海气候——降雨集中在冬天、夏天温度高且 干旱无雨。 CCW的降雨与气温 6.3.2 SHUD 模拟和校准 我们在 CWW 中进行的模拟覆盖了 2000 年至 2007 年。由于该地区属于地中海气候，模拟从夏季开始，以确保在每年十月的开始之前有足够的时间。在我们的实验中，第一年（2000年6月1日至2001年6月30日）是平衡期，接下来的两年（2001年7月1日至2003年6月30日）是校准期，而2003年7月1日至2007年7月1日期间则用于验证。 CCW 的非结构域（图 \\(\\ref{fig:sh}\\) (d)）是在 GitHub 上的 R 包 rSHUD (rSHUD) 中建立的。三角形单元的数量为 \\(1147\\)，平均面积为 \\(0.17 km^2\\)。河网的总长度为 \\(126.5 km\\)，由 103 个河段组成，最高级别的河段为 4 级。通过对参数进行校准，使用 SHUD 模型在非并行配置下（在 Mac Pro 2013 Xeon 2.7GHz, 32GB RAM 上禁用 OpenMP），模拟 CWW 中的 17 年需要 5 小时。 6.3.3 结果 图 显示了在 USGS 11451100 测站的观测流量和模拟流量之间的比较。校准过程使用协方差矩阵自适应进化策略 (CMA-ES) 进行自动校准 。每个种群分配了 72 个个体，保持最佳个体作为下一代的种子，并进行有限的扰动。下一代的扰动是由上一代的协方差矩阵随机生成的。经过 23 代，校准工具确定了一个局部最优的参数组合。 我们使用 SHUD 模型计算的水文指标来演示地下水分布的空间分布情况（如图 \\(\\ref{fig:sh_gw}\\) 所示）。 图 \\(\\ref{fig:sh_gw}\\) 展示了验证期间的年平均地下水位。由于模型固定了一个 \\(30 m\\) 的含水层，结果仅表示该含水层内部的地下水情况。上图中绿色线的地下水位和海拔高度被提取并绘制在下图中。灰色的带状区域是 \\(30 m\\) 含水层，蓝色的线是地下水储量大于零的位置。带有右轴的绿色多边形是沿剖面线的地下水储量。地下水遵循地形走向，积聚在山谷内或相对平坦的区域。在 CCW 中，地下水非常深或者不会停留在陡峭的山坡上。 地下水空间分布图 模拟期间的水平衡 6.4 宁夏岩画村山洪 岩画上的太阳神(Source: wiki) 宁夏岩画村山洪模拟使用的三角形网格) 6.5 休斯顿城市内涝 2017年休斯顿飓风后的休斯顿城市 6.6 南苏丹尼罗河上游 References "],["sourcecode.html", "Chapter 7 源码和程序设计", " Chapter 7 源码和程序设计 源代码都可以从github上获取：https://github.com/SHUD-System/SHUD and https://github.com/SHUD-System/rSHUD。 "],["faq.html", "Chapter 8 常见问题 8.1 模型理论 8.2 模型安装/编译 8.3 rSHUD 8.4 数据 8.5 结果分析 8.6 模型校准 8.7 可视化 8.8 全球水文数据云", " Chapter 8 常见问题 8.1 模型理论 8.2 模型安装/编译 8.2.1 Linux/Mac OS 8.2.2 Windows 8.3 rSHUD rSHUD是在R环境中编译的SHUD模型数据前处理和后处理s工具。 8.3.1 rSHUD安装 请参考@ref{#rshud}一节内容。 8.4 数据 8.5 结果分析 8.6 模型校准 8.6.1 手动校准 8.6.2 自动化校准 8.7 可视化 8.8 全球水文数据云 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
